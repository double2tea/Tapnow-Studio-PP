# 用户原文需求记录

**更新规则**：新增内容必须包含完整时间戳（YYYY-MM-DD HH:MM），并保持倒序排列；无法确认时间的条目保留在文末；归档候选区放在文末，待二次确认后删除。
## 2026-02-06 07:58 3.8.5 发布前调整
```
1) 网格：光晕缩小 30%，浅色点 RGB(212,212,216)，黑色点 RGB(36,36,39)。
2) Lightbox 仍跳跃，怀疑失败/裂图历史组污染；要求更彻底的修复方案。
3) 修改后发布 3.8.5，更新所有文档并 commit + push（README/需求文档等）。
```
## 2026-02-06 07:36 rc-4 网格颜色与灯箱排查
```
1) 网格颗粒效果可以，颜色再浅一些。
2) 下载显示验收成功。
3) Lightbox 仍跳跃，怀疑失败/裂图历史组污染，起初正常后开始跳转。
```
## 2026-02-06 07:20 rc-4 网格合并与下载/灯箱修复
```
0) 网格：缩放时需要一次“合并成大格”的变化（避免多次变化），颜色更温和浅一些，并加一点晕染保证清晰。
1) 下载显示：2 个任务不要显示 66%/2/3，完成直接 100% 且不把保存当占位。
2) Lightbox 仍跳跃，要求必须推进解决。
```
## 2026-02-06 07:01 rc-4 网格太粗需缩小
```
1) 网格点太粗，要求缩到四分之一。
```
## 2026-02-06 06:56 rc-4 网格可见性要求
```
1) 网格需考虑颜色与合并渲染效果；放大/缩小/各种渲染下都必须明显可见。
2) 白底深灰、黑底银色、黄底深灰；最大缩放也需清晰可见。
```
## 2026-02-06 06:28 rc-4 继续反馈
```
1) 继续使用当前版本（不再升版本）。
2) 网点仍不明显，要求继续加粗加深。
3) 历史保存上限：输入正确值后 toast 需立刻消除；未超过 90% 也需立刻消除。
4) Lightbox 仍跳跃，要求找到污染根因并规划确保顺序正确的方法。
5) 智能看板新增镜头默认不锁定验收通过。
6) 历史面板吸顶验收通过。
7) 下载完成后保留显示 10 秒；显示内容按 “xx/XX%” 且不追加字符；进度条置于本地缓存提示条上方整行；“生成/历史”两行保留。
```
## 2026-02-06 05:34 rc-4 验收与新需求
```
1) 版本升到 rc-4；“验收成功不需要显示”。
2) 网点仍太细小，要求加粗加深。
3) 历史保存上限输入：先输入 5 不应立即报错，需 1s 反应时间；报错时长 5 分钟。
4) Lightbox：刷新后正常，滚动一阵后点击预览开始跳跃；要求分析污染根因与确保顺序正确的方法。
5) 智能看板新增镜头默认锁定取消。
6) 历史面板“本地缓存设置/队列”展开后固定顶部可操作。
7) 下载进度条改为“生成历史”下方横条；下载时右侧显示当前/总数与百分比；平时右侧显示历史数量与占比。
```
## 2026-02-06 04:49 rc-5 反馈
```
1) 上轮问题“暂时验收成功”。
2) 画布网点仍太淡，与参考差距大，要求继续加粗加深。
3) 保存资产暂时验收成功；新增：历史数量达到上限 90% 时弹出 toast 提示用户保存。
4) Lightbox 仍有跳跃问题（附日志）。
```
## 2026-02-06 04:21 rc4 反馈与新需求
```
1) 又出现无法 timeout、无法返图的问题，要求恢复到上一个版本开始修复。
2) 网点加粗加深颜色。
3) 打包保存资产失败（storage quota），要求历史上限翻倍并在基础设置中增加可配置项（放在“保存资产包”下方）。
4) Lightbox 跳跃问题仍在（已附日志）。
```
## 2026-02-06 03:39 rc4 反馈 + 继续修复
```
1) 分镜未找到镜头大部分解决，但出现新报错：LocalImageManager Save error（IDB connection is closing）。
2) 自定义参数下拉框问题已验证通过；403 与 antigravity base64 也验证完成。
3) Lightbox 仍会一次跳多项（附 history_down 日志）。
4) 追问：生成历史最大资产保存是否有上限？
```
## 2026-02-06 02:21 继续排障 + 新增缺陷确认
```
1) 403 与 antigravity base64 维持验收。
2) 分镜返图已显示，但控制台仍报“[Storyboard Sync] 未找到镜头”，要求继续排障并降噪/定位根因。
3) 新增：自定义参数下拉框自动缩回。
4) Lightbox 跳跃问题持续（按一次上下键仍跳多次）。
```
## 2026-02-06 02:08 403/base64 验收 + 新 bug
```
1) 403 与 antigravity base64 标记验收。
2) 分镜返图已显示但控制台仍报“未找到镜头”，要求继续排障。
3) 新增：自定义参数下拉框自动缩回。
4) Lightbox 跳跃问题持续（按一次下箭头跳多次）。
```
## 2026-02-06 00:56 左侧有图右侧无图仍复现
```
左侧有图右侧无图持续复现，控制台仍报 [Storyboard Sync] 未找到镜头（已提供日志）。
```
## 2026-02-05 23:50 左侧有图右侧无图 + 日志提示未找到镜头
```
左侧资产有图但分镜右侧无图；控制台持续报 [Storyboard Sync] 未找到镜头（nodeId/shotId 已给）。
```
## 2026-02-05 23:40 返图仍失败 + 需要根因方法
```
1) 返图仍未回填，右侧预览/分镜无法正确返图。
2) 最后一个分镜超时可触发，但返图仍不正常。
3) 要求给出可判断根因的办法（日志/手段），必要时统一取图逻辑。
```
## 2026-02-05 23:03 返图仍失败 + 最后镜头无限计时
```
1) 返图仍未回填（antigravity/jimeng）。
2) antigravity 最后一个镜头无限计时。
3) 补充 jimeng 文生图响应：data[].url 返回 4 张预览/响应一致。
```
## 2026-02-05 22:13 继续要求修复返图
```
强调 antigravity/jimeng 返图问题与 timeout 失效需尽快修复（与 403 无关）。
```
## 2026-02-05 21:49 403 暂时解决 + 返图/超时新问题
```
1) 403 刷屏有所缓解，标注“暂时解决”。
2) 提供负载/响应：gemini-3-pro-image 返回 data:image/jpeg;base64...
3) antigravity 仍无正确返图，最后一个分镜 timeout 失效。
4) jimeng timeout 失效且没有正确返图。
```
## 2026-02-05 21:36 403 刷屏日志
```
本地代理 /proxy 拉取 ComfyUI 127.0.0.1:8188/view 输出持续 403（附多条日志），要求先修复 403。
```
## 2026-02-05 20:50 3.8.5-rc3 继续验收反馈
```
1) 灯箱问题：点击一次上箭头跳转多个，数量不固定（见控制台日志）。
2) 智能分镜批量仍无返图；要求说明 timeout 数据位置。
3) 403 报错继续存在，认为无修复。
4) antigravity 反代图在本地缓存/非缓存均可取图已验证成功；但非缓存状态的图片显示模式不是“链接”，询问当前模式（无需修改）。
```
## 2026-02-05 20:16 流程要求
```
finish_task 跑了吗。每次结束必须跑，必须更新文档；@codex.md 作为规则加载。
```
## 2026-02-05 18:42 3.8.5-rc3 修复推进
```
已针对本轮 4 项问题推进修复与回填：
1) Lightbox 左右键加入节流，降低单次跳多张。
2) 分镜批量超时上限区分：图片 60s / 视频 300s。
3) 轮询遇 401/402/403 直接失败回填，避免 403 刷屏与队列卡死。
4) Base64 结果规范化并优先写入 IDB，降低 data:image ERR_INVALID_URL。
```
## 2026-02-05 18:04 3.8.5-rc2/rc3 验收失败
```
无一成功，全部失败。问题仍在：
1) 批量下载进度跑完后卡死，长时间不出下载。
2) Lightbox 跳跃问题依旧（单次按键跳多张）。
3) 智能分镜批量生成无返图，超时后才跳到下批（jimeng-api/antigravity）。
4) 本地缓存代理 403 刷屏持续。
5) antigravity/base64 刷新仍走 data:image... 并触发 ERR_INVALID_URL。
```
## 2026-02-04 00:10 workflows 脚本与本地日志
```
prepare_workflow_templates.bat 报错（.$($_.Name)），需改为可用版本；本地中间件启动后不再输出逐条日志需修复。
```
## 2026-02-03 12:58 工作流模板助手
```
补充测试说明：ComfyUI 4.0 导出入口在左上角；新增 workflows 批量脚本：
单 json 自动重命名 template.json + 根据 template.json 生成 meta.json。
```
## 2026-02-03 12:46 本地 ComfyUI 测试指引
```
要求输出本地 ComfyUI 兼容测试的完整步骤说明（md）。
```
## 2026-02-03 11:09 3.8.4-rc1 本地 ComfyUI 兼容
```
3.8.4-rc1
@local_comfyui_plan_consolidated.md + codex improve + runninghub*.md
优化 localserver/comfy-middleware，确保兼容本地 ComfyUI。
```
## 2026-02-02 17:20 更新文档与同步
```
要求更新 README、changelog、AG_STATE、需求池并同步远端。
```
## 2026-02-02 13:28 rc7 验收失败/新增功能
```
验收1：
1) 自定义参数显示不正确：只显示 param-xx 的值；提示名规则应只显示提示名（例如 宽1088 · 高2080）。
2) 四图刷新变单图问题依旧。

新问题/改良：
1) 更新模型配置说明书（input/异步/BizyAir APP），放根目录 model-template-readme.md；多并发绘图与本地 ComfyUI + RunningHub 作为 3.8.4 主要落实写入需求池；优化并迁移 local comfyui 文档到 api 目录。
2) 增加模型配置增量导入入口（添加模型旁），单模型导出按钮（编辑按钮左侧）。
3) 模型库增加复制按钮，复制为新模型并在名称后追加“复制”。
4) ChatImage 模型可在 Chat 与 Image 同时选择。
5) 双层模型显示应为“供应商 / 模型ID”。
6) 版本提升到 3.8.3，提交并同步远端。
7) 多图输入支持通过前置图片节点填充 BizyAir 的 LoadImage.image 字段。
```
## 2026-02-02 13:14 rc7 参数名显示/多图并发/BizyAir 刷新
```
模型显示成功，input 验收成功。
0) 参数名字不显示没有改（图一）。
1) 要求输出 ModelScope/NanoBanana/Antigravity Gemini-3-Pro-Image 多图并发方案并写入需求池（输出 md）。
2) BizyAir 返图原本四张，刷新后只剩一张，需要修复。
文档需同步更新（AG_STATE/feature_pool/原文池）。
```
## 2026-02-02 05:44 rc5 画布资产失败/历史已正常
```
1) 视频可打开、历史图片显示正常，但画布上的资产显示失败。
3) 刷新后左侧生成历史正常。
```
## 2026-02-02 05:21 rc5 历史视频/多图丢失/本地引用
```
1) 视频打不开，图片无显示。
2) 好像不再引用本地了。
3) 刷新后四张图变成单图，原本导入可显示的现在也显示不了；给出文件：D:\CodingPlayground\Tapnow\未命名项目_2026 -02 -01T10 -09 -12.7z
4) 继续。
```
## 2026-02-02 04:15 rc5 历史无法打开/缓存关闭仍读取/模型库补全
```
1) 左侧生成历史可见但无法打开，图片显示异常。
2) 缓存关闭时仍读取本地缓存，不应发生。
3) 刷新后的样式/错误无改善。
4) 开始补全模型库功能。
```
## 2026-02-02 03:54 rc5 历史/批量素材显示 blob:null
```
左侧生成历史与批量素材管理不再空白，但预览无法显示，控制台报 blob:null Security Error。
```
## 2026-02-02 03:38 rc5 历史仍空白/自动化要求
```
2) 刷新后生成历史依旧空白。
3) 启动失败需全流程自动化拦截与修复（含 agent），无需人工干预。
4) 下一轮开启，无论修复与否。
```
## 2026-02-02 03:31 rc5 刷新历史空白/自测自修复/Chrome
```
2) 刷新后生成历史变成空白，画布内容维持。
3) 说人话：现在能否自主测试、主动修复？
4) 下一轮集中修复 bug。
5) 已验证。
测试要求：使用 Chrome，不使用 Edge；路径 D:\Chrome-bin\chrome.exe。
```
## 2026-02-02 03:13 rc5 导入刷新空白/新建黑屏
```
2) 导入后刷新画面空白，需要修复。
3) 黑屏自发修复是否解决。
4) 模型库请求模板“全部落实”下个版本执行，但需持续提醒；当前集中修复其他 bug。
5) 点击新建空项目黑屏（日志：can't access property "x", qt is null）。
```
## 2026-02-02 02:55 rc5 黑屏仍出现（TDZ）
```
检测阻断未生效，仍黑屏：ReferenceError can't access lexical declaration before initialization（Vh）。
要求：构建时浏览器运行检测并抓错后主动修复/阻断，不要只在用户运行后才发现。
```
## 2026-02-01 23:10 rc5 资产导入/护栏/模板落实
```
1) 验证成功。
2) 导入资产后刷新裂图（blob:null），旧资产无法清空造成污染；LibreWolf 会崩溃；给出解决与“新建清空”入口。
3) 护栏能否在构建时自动发现/修复，而非仅运行后才发现。
4) 模型库请求模板要求必须完全落实，说明未落实原因并推进。
5) 导入本地缓存+需 fallback 原始 URL；项目名旁新增 + 号按钮，新建清空项目，若有内容提示保存。
```
## 2026-02-01 22:10 rc5 验收与补充
```
要求继续按标号逐条回复：
1) 灯箱日志报错：findHistoryNavIndex is not defined（需修复）。
2) 资产保留验证成功（验收通过）。
3) 黑屏机制是构建时检测还是需用户运行验证？
4) 检查 docs/improve/model_library_request_template_plan.md 是否完全落实。
5) 生图报错在本地缓存开启时出现，目前已未见（验收通过）；需调研保存后载入的资产如何缓存。
6) 返图成功（验收通过）。
```
## 2026-02-01 11:30 3.8.3-rc5 多项修复/检查
```
版本提升 rc5，逐条拆解与应对：
1) 对比 3.8.0，检查非 Jimeng 的 Sora2 是否被改动。
2) 输出模型库中 Jimeng Sora2 的配置说明（便于用户按步骤配置）。
3) Lightbox 修复困难先加日志，便于现场排查。
4) 资产包保存开关需生效：开=打包保存，关=旧方式；保存时显示进度。
5) 黑屏安全机制按规划落地。
6) 生图报错（png/webp/jpg）继续排查并给出修复/日志。
7) 返图不见与旧版本对比，确认可生成链路。
```
## 2026-01-30 17:10 rc4 需求补充（编号2/3/5/6/7/8）
```
2) Jimeng Sora2 图生视频失败：仅支持首帧模式、比例仅 16:9/9:16/Auto；需参考 jimeng-api 源码避免误传多帧与错误比例。
3) 历史上下键跳转异常、灯箱切换错误需继续修复放入 rc4。
5) 资产保存仅 JSON，需规划 ZIP 资产包方案（可拖拽导入，自动加载图片/视频）。
6) 规划黑屏安全机制与自动化检测（可挂 finish_task）。
7) 继续完善 docs/model_library_request_template_plan.md，确保功能完整。
8) 排查并修复本地缓存 HEAD 404 与字体请求警告等报错。
```

## 2026-01-30 13:48 rc4-2 验收问题与新增修复项
```
rc4-2 验收：Jimeng 文生视频失败、Sora2 图生视频失败；历史缓存仍在重复下载（新增“启用缓存时重新下载”开关默认 false 但仍触发）；保存资产文件过小，仅 input node 转 base64；灯箱预览切换出现 1/3、2/4、重复图；清日志导致 session 相关日志丢失需恢复；本地缓存 HEAD 404 需排查；要求输出 rc3/rc4 构建并继续修复。
```

## 2026-01-30 05:12 黑屏修复
```
黑屏需修复后构成 rc3 并继续 rc4；当前黑屏报错为 ReferenceError（变量在初始化前访问），要求避免类似问题。
```

## 2026-01-30 00:29 模型库请求模板完整规划输出
```
需要输出模型库可定制请求路径/请求头/请求体/请求格式的完整规划，支持覆盖与预览，强调可维护性与扩展性。
```

## 2026-01-29 21:41 3.8.3-rc2 重点修复与沟通规则
```
最重点修复：jimeng video 3 文生视频失败、jimeng sora2 图生失败（对比 3.8.0 排查差异并修复）。
后续回复需按当次需求逐条对应说明；若最重点修复未触达不提交审阅。
版本号升级为 3.8.3-rc2。
```

## 2026-01-29 16:56 Continue
```
Continue
```

## 2026-01-28 21:55 3.8.3-rc1 视频与历史缓存/键切换
`
文生视频(jimeng video 3)失败、jimeng sora2 图生失败，需对比 3.8.0 排查差异并修复。
历史上下键仍跳过分组，需稳定顺序切换。
本地缓存仍触发远端覆盖与 CORS，需优先本地并避免远端覆盖。
保存项目需可选保存历史资产（替换实验室性能模式开关）。
`


## 2026-01-28 12:30 3.8.2 历史拖拽本地缓存与统一代理通道
```
生成历史拖拽到画布仍使用原链接，即便已启用本地缓存；要求所有用图优先走本地缓存，再 fallback 原链接。
禁止为某域名写死永远走 proxy，是否代理由 provider/模型库配置决定。
所有用图/用视频入口（生图、生视频、聊天引用上传、参考生图、首尾帧、保存节点、缓存图片等）统一走“获取图片通道”。
```

## 2026-01-28 14:35 3.8.2 本地缓存仍触发 CORS + 视频生成无效 URL
```
本地缓存已启用且预览为本地，但仍有 CORS 与缓存保存失败日志，需要确认是否真正走本地/统一通道。
文生视频/图生视频报错：URL 变成 "http://localhost:5100 /v1/videos" / "/minimax/v1 / video_generation"（含空格，非有效 URL），需修复。
历史上下键切换组别跳过内容，不再顺序切换。
```

## 2026-01-28 16:25 3.8.2 缓存 CORS 与视频端点/历史键切换
```
缓存仍出现 CORS 与保存失败日志（muse-ai 直连）。
视频端点错误：/minimax/v1/video_generation 与 /v1/videos 被服务端拒绝，应对齐正确端点。
生成历史上下键切换组别仍跳过多项，需修复为顺序切换。
```

## 2026-01-28 12:08 3.8.2 缩略图占位文字与保存节点 CORS
```
占位文字：左上角多余文字删除，居中文字放大到同尺寸。
保存本地节点仍报 CORS，继续修复。
参考生图仍有 CORS 缓存失败日志。
```

## 2026-01-28 10:26 3.8.2 保存节点代理图片仍报 CORS
```
保存本地节点仍提示“没有可保存的文件”，代理图片 CORS 报错需修复。
同时出现 KaiTi/楷体 字体请求被浏览器阻止的提示。
```

## 2026-01-28 09:33 3.8.2 本地保存/缓存 CORS 与自动化测试规划
```
版本号维持 3.8.2。
黑屏修复成功，需要自动化测试规划（输出 md）。
保存到本地（保存节点）对代理图片仍报 CORS，toast 提示“没有可保存的文件”。
刷新缓存/参考生图过程中仍出现 CORS/缓存失败日志，需修复。
```

## 2026-01-28 08:18 3.8.2 黑屏修复
```
黑屏报错：ReferenceError: can't access lexical declaration 'cs' before initialization。
要求修复并避免再出现类似黑屏。
```

## 2026-01-28 03:36 统一资源获取渠道 + 缩略图 CORS 修复
```
二、全部重建缩略图 CORS 报错：重建缩略图必须走统一资源获取渠道，不可直接拉远程图。
三、统一渠道方案落地：缓存/下载/缩略图/引用图片统一走 resolveAsset 逻辑（有代理走代理）。
版本定作 3.8.2 正式版。
```

## 2026-01-28 02:42 JimengAPI 7z 替换
```
删除 1.8.4 两个 7z，并替换为：
JimengAPI_For_Mac_Users_260128_0231_v1.0.0_fixed.7z
JimengAPI_Release_Green_260128_0231_v1.0.0_fixed.7z
```

## 2026-01-28 01:11 3.8.2-rc3 去日志与同步
```
可以自动触发缓存了，console 日志不停增加，现在可以去掉日志。
Jimeng 参考图生图暂时无法测试，先搁置。
修改删除日志后版本为 rc3，更新 changelog 和 README 后提交并同步远端。
```

## 2026-01-27 23:08 3.8.2-rc2 黑屏修复优先
```
仅修复黑屏以便继续测试：
file:// 打开报错 ReferenceError: summary is not defined（刷新缓存日志导致）。
要求保持版本号不变，先修复黑屏。
```

## 2026-01-27 23:56 3.8.2-rc2 自动缓存仍未触发
```
1. 自动缓存不触发；更换文件夹后点击刷新缓存仅提示，不触发 /save-cache。
2. 需要继续改为可观测/可触发的缓存流程。
```

## 2026-01-27 22:39 3.8.2-rc2 继续反馈（自动缓存未触发）
```
1. 自动缓存不触发；更换目录后点击刷新缓存也不触发 /save-cache。
2. ModelScope 图片作参考图给 Jimeng 仍报 3018。
3. 需要增加 console 日志便于一次性排查。
```

## 2026-01-27 20:54 3.8.2-rc2 验收后继续修复
```
版本号 3.8.2-rc2：
验收通过：模型库提示名保存/文案修正/历史提示名显示；初次载入画布报错暂时消失。
重点修复：
1) 自动缓存无效；点击“刷新缓存”未触发 /save-cache；自动缓存不应依赖右键下载触发。
2) ModelScope 图片作为参考图给 Jimeng 仍报 3018。若开启本地缓存应优先用本地文件；未缓存时需按 provider 代理规则拉取并上传参考图。
3) 缓存与代理联动需符合“按 provider 是否启用代理决定是否走 /proxy”的规则。
日志输出继续放在 docs/debug/。
```

## 2026-01-27 16:20 3.8.2-rc1 缓存/提示名/ModelScope 引用问题
```
版本号 3.8.2-rc1：
1. 模型库默认参数（如 size）的提示名开关导出/导入后丢失；需确保所有默认参数提示名状态可保存。
2. 模型库文案统一：仅显示“映射提示名 / 启用 / 仅用于辅助选择”。
3. 生成历史中提示名仅显示提示名；自定义参数启用提示名也需显示。
重点修复：自动缓存与 ModelScope 图片引用问题。
 - 自动缓存/刷新缓存无反应，右键下载不应作为触发缓存的方式。
 - ModelScope 图片作为参考图给 Jimeng 报 permission denied(3018)。
 - 初次载入画布 Base64 转 Blob 报 Invalid base64 payload。
```

## 2026-01-27 12:40 3.8.1 归档包替换与缓存/CORS修复
```
确认删除两个 7z，增加两个新版本 7z，提交并同步远端。
3. 模型库的参数备注没有传到前端选项，需要修复。
5. 使用代理图片（modelscope）作为参考图放到其他 API 生图仍触发 CORS。
6. 无法自动缓存问题还存在：未自动触发缓存，打开图片仍为原链接，右键下载不再触发缓存。
```

## 2026-01-27 10:40 3.8.1 代理缓存补充与提示命名
```
2-b 信息补充：保存到本地节点（modelscope zimage，启用本地代理+缓存）仍报 CORS。
控制台：Cross-Origin Request Blocked... + [保存到本地] 读取资源失败。
画布提示“没有可保存的文件”，本地服务日志仅 /ping，未触发 /proxy 或 /save-cache。
原始 URL：https://muse-ai.oss-cn-hangzhou.aliyuncs.com/img/11f39f4e09e74a51979152eabe858604.png

切记：还有 2-a 右键下载继续报 CORS；1 添加其他字段提示命名（提示命名处增加折叠）；3 重点触发本地缓存自动化。
```

## 2026-01-26 22:04 3.8.1 验收追加与缓存问题
```
1. 默认尺寸/分辨率等需要支持自定义显示名。
2. 保存到本地节点对代理图片仍有 CORS，需按 provider 代理开关处理。
3. 新路径启用后自动缓存未触发，下载失败后才触发缓存，需修复自动触发链路。
4. 下载失败（file://）需减少 CORS 影响。
```

## 2026-01-24 17:53 3.8.1 缓存修复与参数重命名
```
1. 根据缓存问题梳理分析进行修复。
2. 重命名参数值功能未看到，补全。
3. 完成后 commit 并同步远端。
```

## 2026-01-24 04:39 3.8.1 模型库预览编辑与缓存补充
```
版本仍为 3.8.1，修完 bug 后再更新版本。
1. 浏览选择图片/视频保存路径后，输入框需同步更新；路径要生效。
2. 模型库参数值（如 size 选项）数量上限需至少 30（不是自定义参数条目数量）。
3. 参数预览旁边增加修改按钮 + “修改覆盖”复选框：允许直接编辑预览 JSON 并覆盖实际请求（变量仍需自动带入）。
4. 参数备注增加复选框，勾选后才允许填写备注。
5. 缓存/代理/保存问题需要继续整理到 MD（补充完善）。
```

## 2026-01-23 20:50 版本规则与黑屏修复
```
rc 版本号可自行增加，但正式版本号需我确认。
3.8.1 正式版黑屏不可用，要求修复并覆盖到 3.8.1。
最新构建物依旧黑屏，需归档到 3.8.1 后再修复。
```

## 2026-01-23 20:14 3.8.1 黑屏错误
```
Tapnow Studio-V3.8.1.html 打开黑屏，控制台报错：
ReferenceError: Cannot access '$s' before initialization
2.8.1 为笔误，实际为 3.8.1
```

## 2026-01-23 19:29 2.8.2 配色要求
```
确保所有按钮选项的配色一致都是黄色系的把灰色部分修改掉
```

## 2026-01-23 18:05 2.8.1 验收补充与缓存问题记录
```
验收：
1. 网格验收成功
2. 保存问题记录输出 md
3. 使用浏览按钮选择保存路径未生效，需修复
4. data:image... ERR_INVALID_URL 与 Base64 转 Blob 报错仍需梳理与收敛

本次版本号 2.8.1，改完 commit 但不推送远端
```

## 2026-01-23 16:08 2.8.1 版本补充与缓存代理规则
```
补充说明：缓存问题
“目前我看来问题很大在于获取机制没有和用户选择相匹配”
意思是说用户选择某个供应商是需要代理的则逻辑走代理获取图片，包括缓存
如果用户没有选择代理，不要自说自话去走代理

本次版本号 2.8.1，改完 commit 但不同步远端
1. 预览窗口内部图片展示区域从灰色改为浅黄色，选择图片按钮改为深灰色；智能分镜右侧预览画布交替浅黄/深黄
2. 检查保存 API 配置时模型库参数是否包含最新自定义参数，不足则补齐
3. 模型库自定义参数数量上限从 10 提升到至少 30
4. 模型库自定义参数需要 JSON / Python 请求预览
5. 模型库参数值需支持显示备注映射（如 1024x1024 显示为 1024x1024(1:1)，提交仍为 1024x1024）
6. 模型名显示最多 15 字节；悬浮提示应显示 provider
7. 浏览按钮选择保存路径未生效需修复
8. 缓存与 Base64 报错需梳理并输出 MD
```

## 2026-01-22 10:54 rc7 模型库污染/模型增殖/自动保存提示
```
除了以上内容外补充如下，版本rc7：
1. 使用模型处选择未引用模型库参数的模型被模型库参数污染
说明如下：
图一，展示了我们设置的模型库模型中把veo3模型设置了首尾帧
图二，展示了我们provider只引用了一个voo3模型库模型，另一个同名模型没有设置引用也就不应该有首尾帧
图三，展示了无论哪个模型被选中都无法显示HD（模型库）
图四，图五，展示了到选择模型页面两个模型都被选中，且无论选择哪一个都是有首尾帧复选框的 。这次这个模型库模型是后建立引用的。也就是说系统只认最后一个建立的模型，并不管是引用没有引用模型库都应用到了前端！

2. 模型库中创建完全同名的模型，但是参数不同，无法找到并正确引用！只有把上一个创建并引用冲突模型参数的新建供应商模型删除后另一个不同参数的模型库模型才能正确引用（后面经过多次尝试发现，并不是模型库的数据污染到了前面同名的模型的数据，而是系统只认可最后一个创建的模型，不管是模型库的模型还是默认模型，只要是最后创建的一个模型系统默认会把这个参数覆盖掉所有的其他的模型，它没有考虑到引用和没有引用模型库）

3. 图片6，复现了很久前出现过的鼠标移动到别的地方回来模型名字增殖一个，来回动来回增加。
4. 检查自动保存是否重复保存，自动保存永远保存一份，不要一直占用额外空间导致越来越大

Tapnow Studio-V3.8.1-rc6.html:454  保存历史记录失败（可能超出存储配额）: QuotaExceededError: Failed to execute 'setItem' on 'Storage': Setting the value of 'tapnow_history' exceeded the quota.
    at Tapnow Studio-V3.8.1-rc6.html:701:51321
    at l (Tapnow Studio-V3.8.1-rc6.html:701:10650)
console.error @ Tapnow Studio-V3.8.1-rc6.html:454
console.error @ Tapnow Studio-V3.8.1-rc6.html:701
(匿名) @ Tapnow Studio-V3.8.1-rc6.html:701
l @ Tapnow Studio-V3.8.1-rc6.html:701
setTimeout
(匿名) @ Tapnow Studio-V3.8.1-rc6.html:701
(匿名) @ Tapnow Studio-V3.8.1-rc6.html:701
xf @ Tapnow Studio-V3.8.1-rc6.html:47
Zl @ Tapnow Studio-V3.8.1-rc6.html:47
Ij @ Tapnow Studio-V3.8.1-rc6.html:47
Ra @ Tapnow Studio-V3.8.1-rc6.html:47
Ub @ Tapnow Studio-V3.8.1-rc6.html:47
ma @ Tapnow Studio-V3.8.1-rc6.html:45
(匿名) @ Tapnow Studio-V3.8.1-rc6.html:47
Tapnow Studio-V3.8.1-rc6.html:454 [AutoSave] 已写入 IndexedDB 23:28:01
Tapnow Studio-V3.8.1-rc6.html:454 [AutoSave] 已写入 IndexedDB 23:29:01
```

## 2026-01-22 12:39 rc7 验收补充/未通过问题
```
先提交远端同步，然后记录并修复未通过验收的bug
补充rc7验收：
1. 模型库污染验收通过（简单测试通过）
2. 同上，验收通过
3. 没有出现了，验收通过
4. 请告知此项目是否每次自动保存会增大储存空间

原始rc7验收：
1. 网格点缺失，虽然新的rc7依样画葫芦加了网格点，但是首先样式不够明显，第二无论如何缩放网格都不变化！王哥点的作用就是为了给用户以缩放的感觉！参考【重点修复】file:///D:/CodingPlayground/Tapnow-Git-Sync/Tapnow%20Studio-V2.6-1-%E5%8E%9F%E7%89%88.html 原版的代码重新加上网格点！！
2. 节点边框的填充色正常，验收通过。
3. 模型库演示类别右对齐验收通过
4. x个模型的显示guise改样式，验收通过
5. 开关样式修改完成，验收通过
6. 现象：【重点修复】不再出现双路径和404，但缓存仍持续报错，几分钟上千条

6a. 非本地缓存模式下报错:
Base64转Blob失败 TypeError: Failed to fetch
GET data:image/jpeg;base64,... net::ERR_INVALID_URL

6b. 启用本地缓存后 Jimeng 代理 403:
GET http://127.0.0.1:9527/proxy?url=https%3A%2F%2Fp16-dreamina-sign-sg.ibyteimg.com%2F... 403 (Forbidden)
[缓存] 保存图片缓存失败: Error: 缓存拉取失败: 403

6c. 点击浏览选择保存路径未生效，未写入图片/视频保存路径

6d. 点击重建历史缩略图报错：
GET data:image/jpeg;base64,... net::ERR_INVALID_URL
```

## 2026-01-22 10:53 rc7 画布网格/节点配色/模型库样式/缓存异常
```
1. 所有画布的网格点缺失，参考3.8.0版本里面的样式需要补全；黄色主题内的网格点使用深黄
2. 可以见得左侧白色主题下边框的颜色填充（红色斜线部分）是纯白色，而内部的文字输入区域是浅灰色，是和外框填充部分有颜色差异。而图片1的右侧是我们黄色主题的现状，外框没有和内部的文字输入有区别！！我的需求是把外框黄色主题下的各个节点的外框填充颜色部分改成深黄色。（238/232/213）同时把下面模型选择的输入框和右边参数的选择框两个加在一起，一共是三个框，这三个框的填充颜色从浅灰色改成浅黄色。（253/246/227）
3. 图片2，模型库的模型显示类右对齐（图二）
4. 图三的x个模型的显示灰色改为图二中模型类别的标签样式，使用深黄色；图四高亮色块改为浅黄（原则就是深黄背景高亮用浅黄，浅黄背景突出用深黄，互相互补）
5. 图五所有的开关，关闭状态都采用淡灰背景不然在黄色主题下开和关无法区分
6. 重点bug修复：图6/图7；图6是关闭本地服务器的状态，图片正常显示。一旦启用本地焕春变成图7样式，正常的图片被替换成原来缓存过的不同的图片，console里面大量类似下方报错。剋观察到服务器还是调用了两个缓存地址，一个/.tapnow_cache/history另一个/history
另外的错误：我更新了图片和视频的保存路径并且点击刷新缓存，无效！新地址没有文件存入

报错日志如下：
Tapnow Studio-V3.8.1-rc6.html:701 
 
 HEAD http://127.0.0.1:9527/file/history/ab97095…~tplv-wopfjsm1ax-aigc_resize_0_0.jpg 404 (Not Found)
Tapnow Studio-V3.8.1-rc6.html:701 
 
 HEAD http://127.0.0.1:9527/file/history/ab97095…~tplv-wopfjsm1ax-aigc_resize_0_0.png net::ERR_ABORTED 404 (Not Found)
Tapnow Studio-V3.8.1-rc6.html:701 
 
 HEAD http://127.0.0.1:9527/file/.tapnow_cache/history/ab97095…~tplv-wopfjsm1ax-aigc_resize_0_0.jpg net::ERR_ABORTED 404 (Not Found)
Tapnow Studio-V3.8.1-rc6.html:701 
 
 HEAD http://127.0.0.1:9527/file/.tapnow_cache/history/ab97095…~tplv-wopfjsm1ax-aigc_resize_0_0.png net::ERR_ABORTED 404 (Not Found)
Tapnow Studio-V3.8.1-rc6.html:701 
 
 GET http://127.0.0.1:9527/proxy?url=https%3A%2F%2Fp16-dreamina-sign-sg.ibyteimg…%26x-signature%3Dg8KRrLYuWmYZNKCEBWDKz%252FW7%252BbE%253D%26format%3D.jpeg 403 (Forbidden)
Tapnow Studio-V3.8.1-rc6.html:454 
 [缓存] 保存图片缓存失败: Error: 缓存拉取失败: 403
    at Tapnow Studio-V3.8.1-rc6.html:701:39191
    at async Tapnow Studio-V3.8.1-rc6.html:701:47373
Tapnow Studio-V3.8.1-rc6.html:701 
 
 HEAD http://127.0.0.1:9527/file/history/2663ea2…~tplv-wopfjsm1ax-aigc_resize_0_0.jpg net::ERR_ABORTED 404 (Not Found)
Tapnow Studio-V3.8.1-rc6.html:701 
 
 HEAD http://127.0.0.1:9527/file/history/2663ea2…~tplv-wopfjsm1ax-aigc_resize_0_0.png net::ERR_ABORTED 404 (Not Found)
Tapnow Studio-V3.8.1-rc6.html:701 
 
 HEAD http://127.0.0.1:9527/file/.tapnow_cache/history/2663ea2…~tplv-wopfjsm1ax-aigc_resize_0_0.jpg net::ERR_ABORTED 404 (Not Found)
Tapnow Studio-V3.8.1-rc6.html:701 
 
 HEAD http://127.0.0.1:9527/file/.tapnow_cache/history/2663ea2…~tplv-wopfjsm1ax-aigc_resize_0_0.png net::ERR_ABORTED 404 (Not Found)
Tapnow Studio-V3.8.1-rc6.html:701 
 
 GET http://127.0.0.1:9527/proxy?url=https%3A%2F%2Fp16-dreamina-sign-sg.ibyteimg…%26x-signature%3D6dbF%252ByWa%252Bw5emwu6hOwub9pv2s4%253D%26format%3D.jpeg 403 (Forbidden)
Tapnow Studio-V3.8.1-rc6.html:454 
 [缓存] 保存图片缓存失败: Error: 缓存拉取失败: 403
    at Tapnow Studio-V3.8.1-rc6.html:701:39191
    at async Tapnow Studio-V3.8.1-rc6.html:701:47373
```

## 2026-01-21 17:51 rc6 迭代需求与队列空白修复
```
新版本迭代rc6，不要复用原来版本号码
验收：
1. 节点的边框还是不正确，这个颜色应该是要用比较深的颜色，节点的内部已经是正确了。
2. 还有两个比较特殊的节点，一个是智能分镜，另外一个是小说，他们的配色还是不对。智能分镜的抬头和底部还是要用比较深色的这个黄色，智能温镜的内部要用到这个浅色的黄。这逻辑的规则很简单，就是所有的节点在黄色的主题下，全部要用黄色、灰色来进行填充。那首先幕布是浅黄色的那外框要跟幕布的浅黄色区隔开来，那就要用深黄色，那外框节点的外框既然是深黄色，那么节点的内框要跟外框区隔开来，要用浅黄色。小说的节点也是一样。小说的节点的外框现在还是浅色的黄，要改成深色的黄。小说决定的内部现在是白灰色，要给它替换成浅色的黄。
3. 缓存模块的开关目前看来是正常的，验收成功。
4. 模型接口配置里面基本上也都改了。嗯，属于暂时就先这样，后续再进行微调。

样式继续调整：
1. 黄色主题下所有的蓝色按钮、绿色按钮，全部改为深灰色按钮
2. 小说输入节点内部还是白色，需要改成浅黄色，小说输入的外框改为较深黄色参见3中的颜色
3. 图片对比节点、图片输入节点的背景均改为卡片的较深黄色
4. 自定义的模型库中的模型修改完之后其他没有应用模型库的模板的同名模型也会受到影响，需要修复一下
5. 模型库里面所有的模型默认全部都是折叠起来的，不要摊开。模型这边所有的模型，它有一个模型类型，image chatt等等。这个模型类型要放在模型名字的旁边，不要放在里面。
【重点开发】6. 模型库里面的这个模型啊，它需要增加一个自定义参数模块，就按点击了之后，它会跳出一个自定义参数，在后面增加。
a. 这个参数它可以自定义参数名，它可以可以是size，也可以是quality。
b. 这个自定义参数还有一个复选框，可以覆盖掉原本的相同名字的参数。比如说这个参数是模型名称就叫做model。因为原本这个模型就有model这个参数。那么我这个自定义参数叫model，然后又开启了复选框可以把原本同名的参数覆盖掉。那么这个模型它在使用的时候，只要用户在外面比如说AI申图或者是AI生视频的时候，选择这个模型model参数，去调整它的参数。那么这个模型送出去的参数的时候，它就可以把自己的模型名字都可以直接改掉。这样子的话更加灵活。那这个模型它在切换这个model这个参数的时候呢，它就可以自定义的把它自己的模型名字给切换掉。
c. 最后这个有自定义参数的模型，它右侧还有一个展示最终提交的json或者是那个代码的这个模式，可以让用户可以查看最终的提交请求的代码。
d. 最后呢在模型类型里面增加一种叫做chat image模型。这个chat image模型呢就是使用chat模型的格式，但是可以增加到视频模型的这个类别里面，可以在AI绘图里面看到。
总结：最后来梳理一下这个重点开发的第六个自定义参数功能，它的用处就是给到an i gravity的chat模型来调用图像生成的功能。它里面有一个重点的功能，就是直接替换模型的名称来实现对于分辨率比例的一个控制。那我们呢就用自定义参数的这个功能来实现对于这一些功能的切换。

补充：修复点击队列按钮屏幕空白的bug
Tapnow Studio-V3.8.1-rc5.html:454  TypeError: Cannot read properties of undefined (reading 'push')
    at Tapnow Studio-V3.8.1-rc5.html:924:81024
    at Array.forEach (<anonymous>)
    at Tapnow Studio-V3.8.1-rc5.html:924:80952
```

## 2026-01-21 06:01 rc5 颜色与本地缓存提示条纠偏
```
0. 为啥rc4被删了，所有的生成物不得删除！！！不得覆盖
1. 智能分镜节点完全没有改，也一样上下深黄色，当中浅黄色；普通节点边框深黄，节点当中颜色正确；API配置的模型条目的色块需要全部调整浅色，边框颜色正确（需要包含模型库）
2. 本地缓存未连接的显示还是不正确，不是这样一圈椭圆长条，而是整个吸附在上方的通知条，配色也用原版的配色（图片3黑色主题、图片4黄色主题和白色主题）
3. 新装的缓存的开关没有理解正确，开关不是不显示提示条，而是主动关闭本地缓存！也就是说在缓存菜单里面开就是打开本地缓存，关则主动关闭缓存（即便本地的服务器开启）；显示条目的绿条提示也是增加的x是主动关闭缓存的功能；同时没有进行本地缓存则这个条目自动隐藏（手动关闭立即隐藏，缓存设置开关关闭立即隐藏，本地服务器从打开变成关闭→显示3分钟红灯后隐藏绿灯条，本地服务器未开缓存界面主动打开本地缓存→显示3分钟红灯如果本地服务器一致未检测到则自动隐藏
```

## 2026-01-20 19:46 UI 暖色主题修正
```
现在 bug 很多，我们一条条来修改问题，暂停所有新功能专心修 bug
首先是 UI 的暖色问题，按照图片中的颜色修改
左侧聊天界面按钮和右上角设置的按钮改为 rgb 97 97 97
画布的边框改为 RGB(238,232,213) 和整个画布的边框一致，和左边资产卡片的说明部分一致（其上文字都使用黑色）图片预览的背景的浅灰色保持现在的不变
画布的空白改为 rgb（253 246 227）和节点的内部保持一致
```

## 2026-01-20 23:12 UI 暖色补充修正
```
第2张图是现状箭头处没有修改，图1是改的参数
右上角的黑色按钮改成97，97，97
图3的菜单（所有菜单）改成（238，232，213）
```

## 2026-01-20 23:47 主题配色对比构建
```
还是不对，把最早换主题的配色备份恢复出test.html我要进行对比
```

## 2026-01-21 01:29 UI 暖色纠偏（节点/历史卡片/间隙）
```
1. 图一，节点的部分还是没有改啊，边框是238 232 213，内部是 253 246 227，看得懂吗
2. 图二，改的和一坨屎一样。我的要求是卡片的说明板块修改成和便条一样的238 232 213 其他让你改了吗？有必要自说自话改吗？图片的背景色黄色主题和图四的白色主题颜色保持一致！
3. 图五，间隙的颜色改回浅色。
就只是改一个颜色！！！而且你看不懂十六进制我都改成rgb参数给你，画好箭头都能改错，你告诉我还能怎么给你更清晰表达？先不要改任何回答我问题先！
```

## 2026-01-20 03:19 rc5 报错修复与 3.8.2 规划
```
版本的报错问题，如果上面调tu'pian研完毕后确认备份源代码并构建物后 可以直接开始修复下方的6个问题，版本rc5
1. 自动保存失败，排查问题 [AutoSave] 自动保存失败: Failed to execute 'setItem' on 'Storage': Setting the value of 'tapnow_autosave' exceeded the quota.
2. 本地缓存提示增加开启关闭按钮，左侧长期显示的提示条增加关闭按钮，关闭按钮点击后隐藏绿色条状提示，在本地缓存设置里面增加开关开启则显示绿色条状提示；图一是原项目样式，图二是我们的样式，修改为原项目样式后在红框处添加开关（提示条上是关闭按钮，菜单里面是开关）
3. 优化缓存方案
   a. 新生图的图片没有进行本地缓存
   b. 全面彻底的梳理缓存文件夹的位置到底获取 \\Downloads\\TapnowStudio\\history 还是 \\Downloads\\TapnowStudio\\.tapnow_cache\\history
4. 蒙版相关问题：@docs/debug/debug4.txt
   a. 检查通过蒙版参考图生图没有正确识别蒙版的问题 jimeng4.5
   b. 错误代码1002 即梦生图失败排查下问题，是在图生图的时候发生的 jimeng4.5
   c. 第一次画蒙版大概率是好的，但蒙版保存后第二次重新绘制蒙版会出现问题，有1000的错误，也有蒙版位置不变的错误
5. 引用 zimage（modelscope）/qwen 去图生图还是碰到 cors，报错在下方；解决该问题，避免同类问题发生 @docs/debug/debug5.txt
6. antigravity 逆向报错与规划：@docs/debug/debug6.txt
   - 需要首先使用 image 模型生图（用 size 控制比例）如何控制分辨率
   - 如果使用 oai 兼容的 chat 通过模型后缀控制比例和大小，如何把这个模式整合到节点（AI 生图 + 智能分镜）
   - 制作完整规划并写入 md，引用到需求库（先不要改动代码，3.8.2 规划功能）
7. 聊天中生成的图片需要在资产/生成历史中展示
8. 模型配置的参数没有同步到 AI 视频节点和智能分镜节点，需要修复：非标参数传递/选中；size 控制比例与分辨率
```

## 2026-01-20 01:09 rc3/rc4 验收与修改要求
```
验收：
rc3验收
1. 未成功，见下方2
2. 初步可以了，调整见下方4
a. 成功；b.成功；c.成功，微调见下方5
rc4验收
1. 我看你的反馈是目前没有限制？但是具体要看测试，是这么理解的吗
2. 看懂了大致相同，具体看参数可能有不同，是这么理解么
3. 没有执行，你无法调取网页，我记得你可以调取网页的呀，你再测试下，尤其是这些连接加入.md可以直接下载为md文档（https://vibecodingapi.apifox.cn/403452729e0.md）方便你查阅 /docs/api/存入这里
https://vibecodingapi.apifox.cn/403452729e0
https://vibecodingapi.apifox.cn/403452730e0
https://vibecodingapi.apifox.cn/403452731e0
https://vibecodingapi.apifox.cn/403452732e0
https://vibecodingapi.apifox.cn/403452733e0
https://vibecodingapi.apifox.cn/403452734e0
https://yunwu.apifox.cn/api-358068905
https://yunwu.apifox.cn/api-358068907
https://yunwu.apifox.cn/api-358068995
https://yunwu.apifox.cn/api-358742580
https://yunwu.apifox.cn/api-369666077
https://yunwu.apifox.cn/api-376104874
https://yunwu.apifox.cn/api-363028872
https://yunwu.apifox.cn/api-385627774
https://yunwu.apifox.cn/api-367102521
https://yunwu.apifox.cn/api-371984249
https://yunwu.apifox.cn/api-363040669
https://yunwu.apifox.cn/api-363824206
https://yunwu.apifox.cn/api-363309789

rc4补充的验收
1. 主题和项目保存一起记录，模型和配置导出一起保存，验收成功
2. 主题初步可以了，具体修改见下方

修改及优化：
1. 白色主题-亮光；黄色主题-日光；黑色主题-暗光，现在主题名字不匹配，按这个调整（我懂你的意思是下一个主题是什么，但还是当前主题是什么比较好，毕竟只有三个）
2. 图2 160/0/235 这个颜色（或者图3），来填充图1的左侧背景深灰色部分（现在的颜色还是不对）
3. 定义现在你在黄色主题用的是浅1（画布，最浅）和浅2，我这里补充图4-深色1+图5-深色2；在黄色主题中右上角的按钮使用图5-深色2；把现在的浅色2改为深1，把浅1改为浅2；把节点框的纯白部分改为浅1，把节点部分灰色部分改为浅2
4. 模型标签里面预制模型的，视频模型需要增加首尾帧复选框，增加HD复选框。对应AI视频节点的首尾帧复选框和HD复选框。对应智能分镜节点的首尾帧功能，HD复选框也比照添加。
5. 首尾帧微调（图6）节点和外面的连线不对齐，最好能够直接连接，最好图片输入节点可以直接主动连接到首尾的这个点上面。
```

## 2026-01-19 21:06 流程执行与短期记忆要求
```
分析为啥都没有按照要求执行finish脚本生成构成物，是哪里缺失了规则？
必须备份，必须同步更新文档，这些在规则里面明确的事情不需要再问我，立即执行文档更新（上方所有没有更新的内容都补充起来）。ag_state.md也需要更新近期记忆；那么ag_state里面更新短期记忆也补充进去，每次读取短期记忆也加入
```

## 2026-01-19 21:06 rc4 主题保存/模型库导出与 Solarized Light 主题
```
rc4 补充
1项目保存需要能够把我们的主题就是亮色或者是暗色记录下来一并保存, 需要把模型库也保存下载
2增加其他的版式主题，比如说黄色为基调的主题。寻找一个相关的配色样式（参见图片1配色），然后进行应用新增配色（这个配色在vscode叫做solarized light如果可以打开vscode的主题文件则可以参考）
```

## 2026-01-19 21:06 rc4 CORS 检测与 Sora2 接入文档
```
rc4
1. 检测：https://vibecodingapi.ai/ 和 yunwu.ai 能否进行直链不受cors影响？
2. 提问：是否vibecodingapi.ai接入了就可以接入yunwu.ai？都是newapi架构的
3. 接入：云雾和vibecodingapi.ai的sora2安排接入，相关文档如下：
https://vibecodingapi.apifox.cn/403452729e0
https://vibecodingapi.apifox.cn/403452730e0
https://vibecodingapi.apifox.cn/403452731e0
https://vibecodingapi.apifox.cn/403452732e0
https://vibecodingapi.apifox.cn/403452733e0
https://vibecodingapi.apifox.cn/403452734e0
https://yunwu.apifox.cn/api-358068905
https://yunwu.apifox.cn/api-358068907
https://yunwu.apifox.cn/api-358068995
https://yunwu.apifox.cn/api-358742580
https://yunwu.apifox.cn/api-369666077
https://yunwu.apifox.cn/api-376104874
https://yunwu.apifox.cn/api-363028872
https://yunwu.apifox.cn/api-385627774
https://yunwu.apifox.cn/api-367102521
https://yunwu.apifox.cn/api-371984249
https://yunwu.apifox.cn/api-363040669
https://yunwu.apifox.cn/api-363824206
https://yunwu.apifox.cn/api-363309789
```

## 2026-01-19 16:54 历史面板亮色适配与备份规则
```
版本号为3.8.1.-rc2
1. 如果修改了服务器也需要备份，研判如何修改finishi_task脚本
2. 左侧生成历史板块的滑动便条在亮色模式下是黑色的调整为浅灰色
3. 左侧生成历史板块缩略图预览区：亮色主题底板改浅灰；提示文字“图片1/图片2/图片3/图片4”在亮色主题用深灰色，居中显示，字体为微软雅黑，失败则 fallback 到楷体
```


## 2026-01-19 16:01 模型库折叠与 Gemini 修复
```
1. 接口和模型列表不需要放入折叠中
2. 模型库中模型增加每一个条目的折叠和展开，并再右上角增加折叠按钮，可以全部折叠和全部收拢，参考图一图二
3. 模型库中的视频模型增加显示比例参数
4. gemini继续修复，目前显示图三但是点开无正确显示图片，报错 @docs/debug/geminierror3.txt
补充，图片已经有正确返图，直接把缩略图这里的图片连接拖动开新的标签页可以正确浏览图片
```

## 2026-01-19 05:59 Z-Image/Gemini 与模型库调整
```
1. zimage连上了，但是Gemini有问题能发不能收，同步异步都尝试了不行 docs/debug/geminierror2.txt；里面有gemini的问题，zimage跨域没有办法缓存图片的问题（想办法通过代理解决）还有其他缓存报错也一并解决下
2. 只是把API接口配置里面的所有杂项配置放一个折叠框内即可类似于图一图二样式。
3. 不知道是不是你动了模型列表样式的原因，模型列表添加之后会导致模型显示不全消失，以及模型添加输入部分又出现了每次只能输入一个字符的bug。另外引用模型库不要横向长条放置直接放置在模型类型选择旁边（图三）
4. 我们在3.6和后续很多版本花了大力气把模型的引用简化，直接引用模型的id，现在在模型库里面又是模型id+名字的冗余做法有必要吗？还是说只有一个会被引用？哪一个？如果说又给我搞各种引用变量我坚决反对！如果说名字只是自己方便记忆那可以留着，但是要标注清楚哪一个是系统引用的，哪一个是自己记忆用的，比如香蕉=gemini-3-image-preview那可以的。但是两个框要标注清楚。
5. 图四，模型参数填写这里有很多冲突的选项比如这里的复选框和下拉和我们在前端原来的模型列表有什么区别？冗余删除掉，文图视频分类即可。重要的参数没有添加，比如视频模型就要填写秒数，哪几个可选。比如图片模型需要填写比例。全比例让用户勾选；比如视频的分辨率可选可输入等等，默认又有什么用处？每一个选项都需要有意义有用处！如果让用户填文本，那么文本需要有范例，如果是下拉框形式添加进去那么需要+号让用户可以填表。如果是复选框那么每一个点击需要弹下拉窗口；还有默认的模型尽可能填写全正确的信息让用户在这个基础上修改。
6. 每一个修改的卡片增加修改铅笔按钮，点击才可以修改；增加模型的接口调用格式，gemini模型？openai模型等等，如果引用模型库的模型则以模型库的模型为准。这样就可以做到供应商的模型一种接口，特定模型库的模型另一种接口了。
```

## 2026-01-19 02:03 流程规则调整与 codex.md
```
预检是可选的吧
AG_status 没有要求更新？
写入，并且把每一个文档的作用标注下
更新文档：docs/user_requirements_raw.md（原话）、docs/feature_pool.md（状态）、changelog.md（仅已验证）
原本写的有：8. git status 自查变更。评估是否需要加入
最后输出项目根目录codex.md;并加入gitignore
1. 回退
2. 加入追踪
你之前用上了我们二阶段的脚本吗？步骤规则是否列一下我来贴到规则里面？
```

## 2026-01-19 01:44 回退 README 与 localserver 追踪/流程说明
```
1. 回退
2. 加入追踪
你之前用上了我们二阶段的脚本吗？步骤规则是否列一下我来贴到规则里面？
```

## 2026-01-19 00:28 3.8.0 回退后 API 重接入与 UI 要求
```
我们原本已经开发到3.8.1-rc1，但是现在因为各种原因恢复到3.8.0版本源代码开始重新开发API集成功能，我们优先开发modelscope的zimage和yunwu.ai/vibecodingapi.ai 的 gemini-3-pro-image-preview；稍后接入sora2，按任务拆解如下：
1) 完善 API 配置与模型列表 UI（再接入接口）
2) 落地 ModelScope Z-Image 接入（异步任务 + 轮询） 
3) 落地 Gemini 3 Pro Image Preview 接入（Gemini native）
仔细阅读附加的两个文档参考制作。
关于1的详细描述：
a. 启用本地代理不要使用总开关，以provider为层级区分代理开关可以放在图二中画圈的图1处（Provider 级：接口类型（OpenAI/Gemini/ModelScope）、是否需要代理、是否异步/Model 级：能力标签（图/视频/图生图）、限制（分辨率/比例）、默认模型）
b. 保留原面板，新增“模型库”标签页；可以自定义增加特定模型，解决同一个模型在不同供应商复用的问题，解决新模型增加但现有面板难以定制模型参数的问题，一次设定全局引用。模型库有了之后添加供应商的模型时候可以下拉选择引用模型库模型
c. 图片2，除了红框部分其他全放折叠菜单中
scripts文件夹是否加入gitignore
所以一次典型的开发交互步骤中全流程是怎么样的，我应该做什么，怎么交互使用脚本
1. localserver需要加入追踪
2. githooks是派什么用处，scripts不是项目产出啊没有必要给其他用户分享吧，我倾向于ignore
3. 哪一个脚本是对文档更新有格式化限定的，好像没看到
可以增加校验脚本，但是现阶段暂时不用？
如何使用轻量化看板？
参考文档在原来的对话中也不见了，我这里补充给你
```

## 2026-01-18 21:40 升级到第二阶段
```
TapNow-PP 项目持续开发新功能，项目介绍如下，请先了解：
- backups/ 所有源代码归档 必须符合内部文档格式要求
- dist/ 每个版本生成的构成物放入用于测试
- docs/ 所有项目文档
  @ag_state.md 规则与近期功能
  @feature_pool.md 抽象总结功能池 近期远期
  @user_requirement_raw.md 用户原文需求避免误解，定期审阅归档
  @/imporve/discussion_report_full_plan.md 帮我升级到第二阶段
- localserver/ 本地缓存服务器+本地代理服务器当前版本源码，修改前后备份归档
- src/ 主项目当前版本源码，修改前后备份归档
- .gitignore 审阅是否加入这个：D:\CodingPlayground\Tapnow-Git-Sync\localserver\__pycache__
- 单文件解释: 三个7z两个是jimeng-api一键启动包用于逆向转化api给我们项目使用，另一个是localserver原始版本
[changelog.md](changelog.md) 每个版本的详细升级说明 [README.md](README.md) 项目主页说明，每个版本发布修改更新；*.html只放每次发布的版本
```

## 2026-01-18 05:45 本地代理接入说明
```
服务器代理已经好了阅读[本地接收器改造与接入说明.md](本地连接器/本地接收器改造与接入说明.md) 配合进行修改
```

## 2026-01-18 05:36 继续
```
Continue
```

## 2026-01-17 22:10 原项目 CORS 与 UI 方案A
```
0. 查看原项目它里面的api是https://ai.comfly.chat 为啥没有CORS的问题？D:\CodingPlayground\Tapnow\原项目继承
1. 是说标红框的拉到方框的居中。是说亮色主题下浅灰色的底色（现在是黑色很突兀），深灰色的字“图片1”然后字拉到方框的中心。而不是调整下面的文字，卡片上的说明文字全部恢复原来状态。
2. ping本地服务器报错？但是打开服务器还是能连
        Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at http://localhost:9527/save-cache. (Reason: CORS request did not succeed). Status code: (null).
3. 好的先使用方案A增加内容，同时按照图片2把这些画红框的板块放在一个折叠菜单内
4. 到底用的是history 还是 .tapnow_cache\\history
不停报错，报错不停；3.8的话没有那么多报错

XHRHEAD
http://localhost:9527/file/history/1767895878410-0.png
[HTTP/1 404 Not Found 64ms]
```

## 2026-01-17 16:25 ModelScope 报错与 UI 缺口说明
```
1. UI方案列了很多没有切身体会，我想知道改造之后UI功能上面我们还缺什么，为了什么需要改造UI？缺了什么
2. 报错 [API Select] Using Key ending in ...53b0 Tapnow Studio-V3.8.1-rc1.html:454:96167 
XHRPOST
https://api-inference.modelscope.cn/v1/images/generations
[HTTP/1.1 400 Bad Request 97ms]

[CONSOLE_ERROR] Error: {"errors":{"message":"image-gen task currently does not support synchronous calls. Please refer to the documentation and set header X-ModelScope-Async-Mode=true to switch to asynchronous calling mode"},"request_id":"8c462d5a-7d68-4e6f-b0a4-4fe428968ce0"}
    qo file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:685
    onClick file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:903
    l2 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:44
    u2 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:44
    d2 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:44
    Bg file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:44
    gb file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:44
    _f file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:44
    Dh file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:47
    Uy file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:44
    _f file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:44
    dh file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:44
    S2 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.8.1-rc1.html:44
Tapnow Studio-V3.8.1-rc1.html:454:96060
Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at http://localhost:9527/ping. (Reason: CORS request did not succeed). Status code: (null).
[AutoSave] 自动保存完成 12:50:37 PM Tapnow Studio-V3.8.1-rc1.html:454:96167
Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at http://localhost:9527/ping. (Reason: CORS request did not succeed). Status code: (null).
```

## 2026-01-17 13:20 CORS 修复与文档更新
```
修改一下生成时候显示的底部文字：
a. 显示居中，使用华文中宋/没有的话fallback到微软雅黑/楷体
b. 如果是亮色状态下白底灰字（黑色状态保持配色）

1. 让你给出3方案是指给出先完善 API 配置与模型列表 UI（再接入接口）的方案
好吧，既然已经落实了1+2先测试了z-image好像cors有问题，尝试修复
2. 继续给出API配置和UI的方案，尽可能复用现有UI

对了更新所有文档的时候记得更新changelog和readme都更新到3.8新版本为止
readme 首段文案用如下：
自原作者 @zhengxinlan1995-code 的 2.6.1 版本以来到 3.8.0版本（截至 2026-01-17）共经历 至少 135 次 快速迭代与修复（含 81 个公开版本号及 54+ 次内部逻辑微测），包含 6 个 里程碑版本与 3次 重构。目前已进化为功能较为完善的工作流设计生产平台。

readme 最新稳定版更新3.8
关键里程碑这里，里程碑加入3.7.36，补齐了本地缓存和小说拆分成为原版项目超集
34版本修改核心是集成子版本解决了1006报错问题，增加视频首尾帧支持，时钟可提可不提
```

## 2026-01-17 11:34 API 接入方案与执行
```
给出3方案然后落实1+2
```

## 2026-01-17 01:51 3.8.1-rc1 API 接入需求
```
参考docs下面的 modelscope_zimage_knowhow.md 准备增加这三种API，优先zimage和gemini-3-pro-image-preview，sora2延后
更新到我们的文档，需求池加入+引用文档，原文文档加入；开始开发3.8.1-rc1
验证通过，更新ag_state.md，做上面要求
```

## 2026-01-17 01:51 智能发送子菜单延迟与3.8.0发布
```
非常好！除了“子菜单悬停保持与离开立即关闭”理解错误之外其他全部验收完成！
我的意思是离开不要立即关闭，要延迟1秒保持子菜单。不然鼠标没过去就关闭菜单了。这个修复完毕之后标号是3.8.0 创建生成物，备份
更新所有文档，同步git文件夹并推送掉
```

## 2026-01-17 00:57 智能发送与拖放验收反馈
```
1. 文案验收成功“智能发送”，菜单大小调整成功，之前的生成历史换行和图标紧凑均验收成功，全部重建缩略图功能验收成功
2. 菜单自动展开验证成功，【但是展开的菜单消失延迟1秒】
3. 又有进步，多完成了几个拖动和发送功能，还有几个需要继续修复（c,d）
 a. 发送成功：预览，视频输入，图片输入，智能分镜，视频拆解提示词反推节点，AI视频和AI绘图节点， 图片对比均发送成功；
 b. 拖动成功：预览，视频输入，图片输入，智能分镜，视频拆解提示词反推节点
 c: 发送失败：【右侧聊天激活对话框】是否逻辑难以判断？能否以最近操作的组件来判断？如果不行则先跳过本功能专注修复下方的拖动，并把图一顺序调整为聊天，预览，幕布
 d: 拖动失败：【图片对比自动连线，AI视频和AI绘图节点自动连线，右侧聊天激活对话框】补充：图片放到聊天对话框则视作添加图片
```

## 2026-01-16 22:10 智能发送菜单与节点识别反馈
```
1. 历史模型显示没问题了
2. “发送到” 右侧显示的折叠按钮需要自动展开折叠（尤其是鼠标悬停到折叠按钮的时候务必展开）
3. 预览发送成功，视频输入发送成功，图片输入发送成功，智能分镜发送成功；
   视频拆解提示词反推节点发送失败（当视频拆解/提示词反推模块激活用户发送图片到这个模块或者拖动图片到这个模块时自动转化为图片2样式前方接入图片模块并连线）
   AI视频和AI绘图节点，比照节点也比照处理，右侧天激活对话框发送失败；增加这两个节点的识别发送
4. “发送到”文案改为“智能发送”
5. 根据最长的文案宽度缩小菜单的宽度
```

## 2026-01-16 14:58 模型显示疑问
```
关于模型的疑问，我们之前重构不是已经把中间的名字id去掉了吗。为什么左侧还是显示的是Provider没有显示模型的名字？
不对啊jimeng就没有落到jimeng而是jimeng4.5是正常的，难道他有displayname，displayname不是被精简了吗？
确保不要其他地方报错，可以直接改
```

## 2026-01-16 13:45 rc4 追加需求
```
rc4中是不是没有做以下内容？如果是没做的话补上
2.左侧历史生成拖拽到节点的功能在智能看板上很完美，也加入拖拽到图片输入节点，视频输入节点（视频），视频输入节点关键帧（图片），预览窗口，如果拖动到画布（没有节点的空白）则生成图片输入节点，如果视频拖动到画布则是视频输入节点
3.把所有左侧生成历史的发送到xxx全部整合成一个“发送到”菜单，发送到功能智能识别，如果激活的是某个节点则发送给这个节点，如果激活的是分镜发送到这个分镜的激活分镜，如果激活的是预览则发送给预览，如果没有选中就发送到画布，如果光标在对话右侧聊天则发送到对话。另外发送到菜单右侧子菜单折叠按钮展开子项目是发送到预览，和发送到对话，发送到预览三个项目（应用到选中节点和发送到分镜整合掉了就不要放了）
补充：为了节约空间把重建按钮放到垃圾桶下面，去掉文字只放符号（保留popup说明）；然后再在本地缓存这里加一个“全部重建历史缩略图”按钮，放在提示下方。提示文案精简为：“提示：设置路径后点击刷新缓存可将素材保存到新文件夹”
```

## 2026-01-16 10:03 rc3 细节追踪
```
图1的按钮样式依旧太靠左，还是要往右走，居中；
没看到重建缩略图按钮，在哪里
```

## 2026-01-16 08:58 rc4 指令与补充需求
```
之前以上的需求做完备份，生成rc3构成物；下面是rc4直接执行

1.智能分镜图片生成模式的，多图模式，多图参考位置最多图片还可以增加一张图片的位置

2.补充需求下次处理：左侧历史生成拖拽到节点的功能在智能看板上很完美，也加入拖拽到图片输入节点，视频输入节点（视频），视频输入节点关键帧（图片），预览窗口，如果拖动到画布（没有节点的空白）则生成图片输入节点，如果视频拖动到画布则是视频输入节点 
3.补充需求下次处理：把所有左侧生成历史的发送到xxx全部整合成一个“发送到”菜单，发送到功能智能识别，如果激活的是某个节点则发送给这个节点，如果激活的是分镜发送到这个分镜的激活分镜，如果激活的是预览则发送给预览，如果没有选中就发送到画布，如果光标在对话右侧聊天则发送到对话。另外发送到菜单右侧子菜单折叠按钮展开子项目是发送到预览，和发送到对话，发送到预览三个项目（应用到选中节点和发送到分镜整合掉了就不要放了）
```

## 2026-01-16 08:11 rc3 验收补充与新增需求
```
rc2没有构成物吗？我看rc3的总队列改了，验证通过
图1的按钮样式依旧太靠左，还是要往右走，居中；
图2左上角一开始就两行显示文字，右侧按钮紧凑
没看到重建缩略图按钮，在哪里

新增：智能分镜需要在空白的时候直接点击空白处新建分镜
```

## 2026-01-16 07:18 rc2 调整与 rc3 Bug 分析补充
```
1. 队列总表现在是图片3完全看不了，改成图片2样式下拉拓展，功能目前没问题
4. 右侧按键参见图片1的右侧，右移动居中
2. 下载逻辑通过测试

小修小补好上部分是rc2，完成备份后直接处理rc2的bug分析修复

补充1：队列总管理这里增加一个切换各个队列是管线管理还是并行关系的开关

更正：小修小补好上部分是rc2，完成备份后直接处理rc3的bug分析修复

补充猜测：我使用liberwolf浏览器的时候发现历史面板性能模式会让他这里的小图变成彩色马赛克（图1下半），并打不开预览图。然后切换之后生成的图片一切正常（图1上半）。是否生成时候就存储记录了缓存后续不变了？但是素材管理里面的调取图片的逻辑又不同，每次重新调取？虽然在云端的时候左右点击即便是鼠标预览大图只要切换就变成小图，但是逐个点开可以看到大图，即便是历史老图片也行。说明这个数据链接没过期还可以从网上下载到信息。如果是这样可以在图二的这个条目右侧增加个按钮重新读取图片重做小图缓存？
```

## 2026-01-16 05:17 补充需求与历史预览异常
```
1. 补充需求下次处理：左侧历史生成拖拽到节点的功能在智能看板上很完美，也加入拖拽到图片输入节点，视频输入节点（视频），视频输入节点关键帧（图片），预览窗口，如果拖动到画布（没有节点的空白）则生成图片输入节点，如果视频拖动到画布则是视频输入节点
2. 补充需求下次处理：把所有左侧生成历史的发送到xxx全部整合成一个“发送到”菜单，发送到功能智能识别，如果激活的是某个节点则发送给这个节点，如果激活的是分镜发送到这个分镜的激活分镜，如果激活的是预览则发送给预览，如果没有选中就发送到画布，如果光标在对话右侧聊天则发送到对话。另外发送到菜单右侧子菜单折叠按钮展开子项目是发送到预览，和发送到对话，发送到预览三个项目（应用到选中节点和发送到分镜整合掉了就不要放了）
3. 重点分析bug下次修复：左侧历史生成这里【重点下次修复先分析，上面两条放原文池和需求池】
1. 默认打开应该是普通模式不应该有任何模式。
2. 大量的图片点开只显示小图，console里大量报错
3. 批量素材管理的症状又不同，单独双击点开预览的图片正常，但是左右上下翻转的时候却只能看到小图

补充观察到的现象：
1.新生成的图片切换正常，都是正常图片，而历史图片（从项目恢复的则不行，只显示小图）（网络模式），本地模式下比较新的文件展示正常，左右键盘组间切换正常，老点的图片打开鼠标点击左右预览正常小图在生成历史面板显示黑色，键盘左右切换则变成小图；组间上下切换均不正常跳跃卡顿。
2.但是在批量素材管理里面双击单个阅览正常，左右切换第一次是小图（网络模式），如果切换到本地模式左右键盘切换是小图，但是鼠标点击正常显示但是组间切换都不正常，会卡住跳跃等

类似日志省略
Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at http://127.0.0.1:9527/ping. (Reason: CORS request did not succeed). Status code: (null).
Security Error: Content at file:///D:/CodingPlayground/Tapnow/Tapnow%20Studio-V3.8.0-rc.1.html may not load data from blob:null/a3d7c6ea-8519-4e3d-bfb8-4ebe564c27d4. 2
Security Error: Content at file:///D:/CodingPlayground/Tapnow/Tapnow%20Studio-V3.8.0-rc.1.html may not load data from blob:null/f6d4f8b6-ca71-41a2-81d1-38dc82b89efa. 2
Security Error: Content at file:///D:/CodingPlayground/Tapnow/Tapnow%20Studio-V3.8.0-rc.1.html may not load data from blob:null/57ff3279-700c-4290-b10c-1c04535e8c52. 2

图片 1 加载失败 Tapnow Studio-V3.8.0-rc.1.html:454:95927
图片 2 加载失败 Tapnow Studio-V3.8.0-rc.1.html:454:95927
图片 3 加载失败 Tapnow Studio-V3.8.0-rc.1.html:454:95927
图片 4 加载失败 Tapnow Studio-V3.8.0-rc.1.html:454:95927
```

## 2026-01-16 05:04 3.8rc2 验收补充
```
版本号rc2
1. 队列可视化暂时可以。可以增加单个排队任务删除（右侧加垃圾桶符号）。另外这个按钮是只是显示这个特定的节点的队列。左侧生成历史这里增加按钮放置整个画布的队列，要能分清楚任务总批次，一个任务批次是一次点击批量按钮，点击后比如是12个生成分4个线程，那么就有3个轮次（样式参考如下）
清空队列（除了现在任务之外的所有），终止全部（包括现在队列）
Node1 - 三体分镜2 (按照节点命名) task1：12个总生成 一次生成4个 (数据统计兼分隔）
（4线程）共3个轮次（两个在排队）可以手动删除，正在生成的如果报错则可以手动改删除（需用户确认）  🚮(这里任务可以删除)
 - T1B1 - xxxxx  🚮
 - T1B2 - xxxxx  🚮
NODE1 - 三体分镜2 - task2: 10 total · 4 each · 3 batch （样式参考，具体英文标题名字根据合理的来）
 - T2B1 - xxxxx  🚮

2. 下载功能，全局下载通过。选中下载的逻辑有问题：有左上角的复选框的，复选框没有选中的不下载，只下载左上角复选中的图片(图片2）如果复选框选中，图片右上角复选也选中，只下载单图（即选中卡片也选中的这一张图片）；如果没有选中卡片左上角的复选框，则以图片勾选的框为准。逻辑是优先灰色按钮复选框（左上角复选框）然后再看图片复选框（四张图里面智能选一张），都选取交集
3. 局部重绘通过
4. 智能分镜，图片调整整体正确，但是右侧空隙太大，和左侧分隔栏一起整体右移确保没有空隙（图片1）
```

## 2026-01-16 01:00 3.8rc 验收反馈与调整
```
1. 队列可视化我看到了队列按钮，但是点击后的弹窗被遮盖，需要调整。这一点和下载按钮的弹窗相同，都需要一并修改
2. 下载功能 (2026-01-09 06:39)：下载问题和1一样，我选择不到按钮无法验证
3. 局部重绘需求 (2026-01-09 06:29)：经过之前调整操作条应该在屏幕的下方，但是这次打开整个操作条都不见了，无法验证
4. UI 布局需求 (2026-01-09 06:29)：验收成功；折叠UI调整得非常好；加宽也验收成功；
5. 智能分镜主卡片需求 (2026-01-09 04:10)，删除按钮位置正确，先把所有图标居中，然后看看能不能生一个设计图来参考一下
6. 智能分镜拖放需求 (2026-01-09 04:10)：完美，验证成功
7. 资产左侧查看提示：验证成功
补充说明5，左右图标在左侧的隔离线和右侧的卡片边框之间偏左了，至少居中，且图标适量放大以符合新的空间
```

## 2026-01-16 00:02 版本号与构建物命名
```
那可以是3.8rc或者beta之类的，不能在固定的已经完成的稳定版上持续覆盖。况且3.8都已经是明确告诉你了。原来的规则是避免没有明确版本号就擅自升级版本设置的
37.36c可以从git文件夹里面把备份的拷贝回来，在主项目中使用3.8版本号或者 3.8.0 pre 之类的的衍生版本号
```

## 2026-01-15 22:12 启动 3.8 执行顺序
```
很完善了，开始执行3.8
可以先批量下载的逻辑+优先队列可视化，然后UI 布局 + 局部重绘 + 分镜主卡片/拖放一起做（按 P1 顺序）
```

## 2026-01-15 17:53 优先级调整与待开发标注
```
P0可以，你提得P1和P2放在下一个版本，这次优先完成下载功能 (2026-01-09 06:39)以及UI 布局需求 (2026-01-09 06:29)局部重绘需求 (2026-01-09 06:29)智能分镜主卡片需求 (2026-01-09 04:10)智能分镜拖放需求 (2026-01-09 04:10)覆盖提示 "继续批量生成会覆盖原有输出但是资产在左侧可以查看" 待开发

另外所有其他待开发得功能全部增加评估P0/1/2/3；其中1006 错误探索 (2026-01-09 03:40)已经基本完成，备注
```

## 2026-01-15 06:26 需求池整理与3.8规划
```
1. [v2_6_1_vs_v3_7_34_feature_compare.md](docs/v2_6_1_vs_v3_7_34_feature_compare.md)  3、4、11是否落地了。我们现在是否有原项目2.6.1的所有能力，确认。
2. 把 [user_requirements_raw.md](docs/user_requirements_raw.md) 里面标注归档的检查一下是否都已经完成（必须要项目全部完成）确认完毕后全部归纳到archive里面新建文件md归档，并放到这个文件最后面经过我二次确认后删除。
3. 整理好2之后把2中所有的需求归纳和需求池对照增补，有不少需求是我手写进入user_requirements_raw里面的，需要增补汇总。（重新排序优先级）
4. 一切整理好之后根据最新的需求池规划下个大版本的落地规划 暂定3.8（加哪一些功能，优先级如何等等）
```

## 2026-01-14 08:33 35后续调研与同步要求
```
之前的验证均通过，漏了调研
1.查重的逻辑应该是在这个文件夹内没有重复即可，我换一个子文件夹还是不让我下载
2.整理好了之后源码复制到git文件夹，构建物也复制过去，然后更新changelog 和readme 最后推送掉
3.按钮如何验证是否开性能了，下个版本的前期调研我们自查一下，输出结论即可不要继续改代码
```

## 2026-01-14 07:53 继续
```
继续
```

## 2026-01-14 04:47 36c 补充修复与前期调研
```
补充修复：
1. 图一，下拉的选框是上对齐，但是原本上拉的选框还是要下对齐啊。比如之前的AI绘图和AI视频节点
2. 图二图三，同样的节点生成角色/环境视频的节点报错，而AI视频节点则正常；另外视频节点需要一个分辨率选择（看模型是否支持所以可以720/1080/不选）
[CONSOLE_ERROR] Error: No Task/Job ID returned. Response: {"code":-2000,"message":"Params body.duration invalid","data":null}
    xo file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36c.html:690
3. 角色的图片模式角色就不用说话了，会导致角色图片上面有文字，不是我们要的

下一个版本的前期调研：

[v2_6_1_vs_v3_7_34_feature_compare.md](docs/v2_6_1_vs_v3_7_34_feature_compare.md) 根据前期分析原版的能力现在我们还缺少哪些？2.3.4.11需要确认
1. 已实现
2. UI实现？逻辑是否实现需要验证
3. 是否添加，需要确认
4. 是否添加，需要确认
5. 已实现
6. 已实现
7. 已实现
8. 已实现
9. 本就有
10 本就有
11. 是否添加，需要确认

补充信息：生成的视频是实实在在本地缓存和引用的，但是一旦本地服务器关闭，就无法打开了，没有fallback到应该的链路 localCacheUrl > thumbnailUrl > originalUrl
图片打开则是固定的originalurl
```

## 2026-01-14 03:32 角色库场景库扩展及创建角色节点优化
```
1. 创建角色节点为啥没法和AI视频节点串联，我还希望后期可以和智能分镜节点串联
2. 角色库增加普适的角色库/环境库（主要以图片为主）所以创建角色节点也需要可以创建图片
3. 角色库和图片库的UI设计，放在左侧条目中
```
## 2026-01-14 02:06 36c 验收补充与优化
```
验收
1. 双层模型选择正常，优化见下面2
2. 好像解决了，但是问题是.tapnow_cache/history我们不用为啥要兼容，是兼容原版项目吗？那不是不行
3. 保存命名正确，但是本来保存按钮就是4张图片，我说得只有头图的是自动缓存见下方3
4. 通过，但是缓存显示存疑，见下方3

优化
1.点击浏览按钮跳出类似于保存文件的浏览窗口让用户选择文件夹，不是跳出一个输入框
2. 双模型选择如果是下拉的则需要文字上对齐避免文字跳跃影响体验
3. 显示后端缓存真的后端缓存了吗，我把缓存文件都删除了，黄标还存在。我点击刷新缓存，到history里面查看还是只有首图，没有余下的三张图片
4. 按钮现在我观察到还是联动，只要点击任一方另一方一起变化
5. 同一个地方同样的图片下载要去重（不要再下载了）
```

## 2026-01-13 22:26 36a/36c 验收反馈与本地缓存/保存调整需求，归档
```
验收：
1. 35版本的生成视频/图片节点的模型选择都要给到双层选择（这是我们的特色）改完35版本验收完成
2. 36a:“我怎么感觉这个本地缓存服务器和本地保存节点好像是一回事情？”这个问题你没有回答，现在回答我。
验收：保存按钮验收完毕，功能可行，保存节点的自动保存功能也正常
问题：
1/python的脚本会卡住？导致保存功能失败，history文件夹是缓存？
2/那么里面只保存了四张生成的第一张图片，其他三张没有保存；确保全部保存
3/缓存目录是否不一致？另外1768308020219-4rdaq6.jpg 这个文件是啥
4/手动保存的/自动保存的文件需要按照提示词重命名，如有项目标题则为 项目名-提示词-编号
5/配置已更新的toast不消失；图片和视频的保存路径正反斜杠统一吧，右侧加一个浏览按钮浏览地址
6/ 图2，原项目的本地缓存已连接是不受上方折叠按钮影响，只要连接就会亮起在外露出的，比照修改。并且蓝色提示也比较添加并检查是否如此。

服务器的日志（3/的补充）
[2026-01-13 20:40:47] 缓存文件已保存: 
C:\Users\Christopher/Downloads/TapnowStudio\history\537e284c907f4d4ab66b141e2d570d13~tplv-wopfjsm1ax-aigc_resize_0_0.jpg (893493 bytes)

浏览器的日志报错，是否目录不一致（3/的补充）
[API Select] Using Key ending in ...39a8 Tapnow Studio-V3.7.36c.html:454:96167
XHRHEAD
http://127.0.0.1:9527/file/.tapnow_cache/history/537e284c907f4d4ab66b141e2d570d13~tplv-wopfjsm1ax-aigc_resize_0_0.jpg
[HTTP/1 404 Not Found 3ms]

XHRHEAD
http://127.0.0.1:9527/file/.tapnow_cache/history/537e284c907f4d4ab66b141e2d570d13~tplv-wopfjsm1ax-aigc_resize_0_0.png
[HTTP/1 404 Not Found 1ms]

XHRHEAD
http://127.0.0.1:9527/file/.tapnow_cache/history/1768308020219-4rdaq6.jpg
[HTTP/1 404 Not Found 3ms]

XHRHEAD
http://127.0.0.1:9527/file/.tapnow_cache/history/1768308020219-4rdaq6.png
[HTTP/1 404 Not Found 2ms]

[AutoSave] 自动保存完成 12:41:15 PM

=================

36b 已经修改的功能目前验收正常，我们也和原项目一样把两端按钮独立开来。相关疑问：我们的全局ultra有什么变化，原来项目只有两挡呀。

36c 验收：标签参数正确，四图显示正确，模型显示正确，按钮也有了，
新增：后端缓存的图片也比照原项目标在批量素材管理里面标记后端缓存，原项目的批量素材样式中的1/2/3/4的左下角标增加上（图3），而且原项目在各自小图双击可以打开各自小图的预览我们加上，单击小图有灰一下然后点击右上角的预览按钮可以预览对应小图，只有点击下方提示词和参数的标签处才能选中整个卡片并勾选，我们比照修改。
```

## 2026-01-13 18:36 35 版本验收微调与 36a 黑屏修复，归档
```
那么35版本的修复呢？
36c的修复是否包含36a和36b

35的版本验收：
1. prompt角色展开验收完毕
2. 功能都有了，验收成功，需要微调一下，风格环节原项目是下拉框选择预设内容然后根据预设内容修改prompt，不需要预先填充，只需要用户选择即可；另外参考一下原来项目的提示词（下方）
3. 子菜单制作功能正常，需要微调，子菜单样式和我们双层模型类似，右侧增加菜单不要下方增加菜单，参考图1
看下是不是用src_backup_v3.7.35_desc_prompt_fix_20260113-0712来修改，修改后备份源码构建生成物

提示词过滤
{
  "model": "gemini-3-flash",
  "messages": [
    {
      "role": "system",
      "content": "你是一个提示词优化专家。请分析以下提示词，只保留关于人物外貌、服装、姿态等角色特征的描述，去除所有剧情、动作、对话和背景信息。输出应简洁，只包含角色特征描述，格式为\"全身视角，[人物特征描述]，站在纯白色背景前\"。必须确保背景始终是纯白色，不能有任何场景描述。"
    },
    {
      "role": "user",
      "content": "动漫风格，全身视角，名叫总工程师的不详岁左右男站在白色背景前，负责罗布泊东方核子中心加速器的具体运行。性格务实，更关注试验的实际操作和对社会的影响，在宇宙异象发生时表现出担忧。，正在用中文普通话面向镜头做自我介绍，说着：我是总工程师，加速器运行负责人，然后缓慢转一圈360度全方位展示身体"
    }
  ],
  "temperature": 0.3
}

场景增强提示词
{
  "model": "gemini-3-flash",
  "messages": [
    {
      "role": "system",
      "content": "你是一个场景描述优化专家。请分析以下提示词，只保留关于场景、环境、建筑、背景等场景特征的描述，去除所有人物、角色、字符、对话和动作描述。输出应简洁，只包含场景特征描述，不能包含任何人物或角色。"
    },
    {
      "role": "user",
      "content": "位于罗布泊沙漠，由一群优雅的白色建筑组成。地下深处建有周长150公里的巨大粒子加速器，是人类试图击破夸克的实验场。"
    }
  ],
  "temperature": 0.3 
}

4. 36a开始黑屏需要修复

ReferenceError: can't access lexical declaration 'Jd' before initialization
    fz file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:671
    z0 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:45
    Xy file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    Vy file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    s2 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    nd file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    Rf file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    By file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    H file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    X file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    EventHandlerNonNull* file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    <anonymous> file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
Tapnow Studio-V3.7.36a.html:454:96060
Uncaught ReferenceError: can't access lexical declaration 'Jd' before initialization
    fz file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:671
    z0 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:45
    Xy file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    Vy file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    s2 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    nd file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    Rf file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    By file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    H file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    X file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    EventHandlerNonNull* file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    <anonymous> file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
Tapnow Studio-V3.7.36a.html:671:40664
```

## 2026-01-13 08:10 36c 批量素材管理修复需求，归档
```
前面全部做完之后确保备份后再做这个：

36c版本修复内容，图片一是我们35版本的批量素材管理，模型名称显示不正确。图片只显示一张。 而图二原始项目中显示四张，且右上角还有清理缓存按钮。
需求：1. 让我们模型也显示正确
2. 让我们的显示也是四张
3. 比照原始项目增加批量删除按钮
4. 把我们在生成历史里面的图片参数也同步过来 最终显示：类型，模型，比例/分辨率/（时长），时间，耗时；为了节约空间这里时间用24小时制不用写PMAM了，耗时部分的用时两个汉字也省略用分钟直接 0.5m 就是30s只保留一位小数。///文→图 jimeng-4.5 · 16:9/2K · 22:36 · 0.5m///  图→视 jimeng-v3.0 · 16:9/720/5s · 23:36 · 5.2m//最终的格式这样，模型最长12个字符，如果太长可以按照我这样缩写，鼠标悬停展示全名

备份代码，更新文档，需求池，原始需求池，生成构成物
```

## 2026-01-13 08:09 36b 本地缓存菜单与性能按钮对比，归档
```
36b版本是在36a的基础上补充生成历史这里的本地缓存功能折叠菜单+原版的自动缓存保存路径，png转jpg功能；保存节点的服务器地址修改，子文件夹修改，没有png转jpg功能。原版的bug需要修复，就是待保存文件在前方节点刷新后需要更新

另外详细分析下原版的闪电是否只控制历史这里的图片预览，对整体性能没有影响吧。
原版整体只有性能模式和非性能模式，我们这里有三档；原版两个按钮是分开控制的，我们是串联一起的。列表格对比我们的按钮和原版的按钮差异，我需要根据输出调整最终布局。
```

## 2026-01-13 07:12 角色与场景描述增强、菜单结构与缓存保存需求，归档
```
原版导入的提示词：动漫风格，全身视角，名叫丁仪的中年岁左右男站在白色背景前，物质无限可分学派的代表人物。身穿蓝色工作服，外表朴素如勤杂工，性格冷静且对科学探索充满乐观，认为击破夸克是物理学的新起点。，正在用中文普通话面向镜头做自我介绍，说着：我是丁仪，中国理论物理学家，然后缓慢转一圈360度全方位展示身体

我们版本的提示词：动漫风格，全身视角，名叫丁仪的25岁左右年轻男人站在白色背景前，杰出的中国理论物理学家，主张物质无限可分。他性格冷静、坚定，对科学探索充满理想主义，常身穿蓝色工作服，外表朴素，容易被误认为是勤杂工。，正在用中文普通话面向镜头做自我介绍，说着：我是丁仪，角色设定，然后缓慢转一圈360度全方位展示身体

1. 看到差别了吗，倒数第二句这里视频模式第二段我们的版本没有把角色设定展开。这里需要修改并展开具体角色设定；图片模式里面也是一样。而且在生成角色图片节点里多加了“然后缓慢转一圈360度全方位展示身体”这样一句话。

2. 图二，原版的场景描述和角色描述没有我们这么简陋，是有增强场景描述，过滤提示词的大模型能力的，同时可以选择LLM。还可以拖拽或者点击增加参考图。按照图二增加大模型双层选择，增加风格，增加参考图（多图）但是不要像他一样添加生图生视频等参数，这是下一个节点的工作。
另外现在切换到图片模式自动连接出来一个图片节点很好，我希望点击图片模式的时候判断有没有连接图片节点，没有的话就直接生成并连接。这个对视频节点也一样。比如默认生成的生成角色视频节点被我删除，或者被我删除连结了，那么这时候点击视频模式就应该像图片模式一样自动连接一个生角色/场景视频节点

3. 图三，菜单目录中其他新增条目全部作为提取角色和场景的子目录，提取角色和场景条目分为两段，前段点击是“角色与场景提取”节点，后段折叠符号悬浮或点击展开子目录图二

====以上修复为35版本====做好保存源代码，更新所有相关文档后继续在这个基础上制作下面修复

4. 修复节点缓存和保存功能
[v2_6_1_vs_v3_7_34_feature_compare.md](docs/v2_6_1_vs_v3_7_34_feature_compare.md) 
经过我的原版摸索操作，我怎么感觉这个本地缓存服务器和本地保存节点好像是一回事情？
[tapnow-local-server.py](本地连接器/tapnow-local-server.py) 本地缓存也是把文件下载到一个目录？
我使用作者的原版
本地缓存失败，但是批量保存成功，另外自动保存也是没有触发的。我们的35版本也是缓存失败，另外我们35版本的保存节点没有手动保存本地按钮；

=====36版本======上方36a，下方36b======每个版本保存源代码，构建html，更新文档
{没有服务器地址修改，没有子文件夹修改，没有原版的自动缓存保存路径，没有png转jpg功能。} 


[2026-01-13 00:24:10] HTTP: GET /ping HTTP/1.1
[2026-01-13 00:24:13] HTTP: HEAD /file/history/24e5e569f1204a61a0c60116e4e15c08~tplv-wopfjsm1ax-aigc_resize:0:0.jpg HTTP/1.1
[2026-01-13 00:24:13] HTTP: HEAD /file/history/24e5e569f1204a61a0c60116e4e15c08~tplv-wopfjsm1ax-aigc_resize:0:0.png HTTP/1.1
[2026-01-13 00:24:13] HTTP: HEAD /file/history/1768228743334.jpg HTTP/1.1
[2026-01-13 00:24:13] HTTP: HEAD /file/history/1768228743334.png HTTP/1.1
[2026-01-13 00:24:16] 保存缓存失败: [Errno 22] Invalid argument: 'C:\\Users\\Christopher/Downloads/TapnowStudio\\.tapnow_cache\\history\\24e5e569f1204a61a0c60116e4e15c08~tplv-wopfjsm1ax-aigc_resize:0:0.jpg'
[2026-01-13 00:24:16] HTTP: POST /save-cache HTTP/1.1

2026-01-13 00:32:03] HTTP: OPTIONS /save-batch HTTP/1.1
[2026-01-13 00:32:07] 批量保存: C:\Users\Christopher/Downloads/TapnowStudio\tapnow_1768235518903_0.jpg
[2026-01-13 00:32:07] 批量保存: C:\Users\Christopher/Downloads/TapnowStudio\tapnow_1768235520136_1.jpg
[2026-01-13 00:32:07] 批量保存: C:\Users\Christopher/Downloads/TapnowStudio\tapnow_1768235522636_2.jpg
[2026-01-13 00:32:07] 批量保存: C:\Users\Christopher/Downloads/TapnowStudio\tapnow_1768235523586_3.jpg
[2026-01-13 00:32:07] HTTP: POST /save-batch HTTP/1.1
```

## 2026-01-13 04:07 小说拆分链路与 CORS 说明，归档
```
1. 继续报错CORS，只在使用https://127.0.0.1的本地服务的时候报错改为http后正常生成但是有warning，用云端api也正常，没关系的话就这么放着
2. 上文的功能补充实现，记得备份，需求池，ag_state，原文需求，构建物

Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at https://127.0.0.1:8045/v1/chat/completions. (Reason: CORS request did not succeed). Status code: (null). 2
Extraction Failed TypeError: NetworkError when attempting to fetch resource. Tapnow Studio-V3.7.35.html:449:95811
[AutoSave] 自动保存完成 6:03:42 PM Tapnow Studio-V3.7.35.html:449:95918
Cross-Origin Request Warning: The Same Origin Policy will disallow reading the remote resource at http://127.0.0.1:8045/v1/chat/completions soon. (Reason: When the `Access-Control-Allow-Headers` is `*`, the `Authorization` header is not covered. To include the `Authorization` header, it must be explicitly listed in CORS header `Access-Control-Allow-Headers`).
[AutoSave] 自动保存完成 6:04:42 PM Tapnow Studio-V3.7.35.html:449:95918
```

## 2026-01-13 03:40 左侧生成历史增加右键菜单一键使用这个提示词功能
```
右键菜单，发送这个提示词，发送到激活的节点/镜头/xxx, 如果没有激活则复制到剪贴板
```
## 2026-01-13 02:39 图片导入功能优化
```
视频输入导入图片，需要可以导入首尾帧以及多参考图，只要卡片激活+开启多参/首尾则导入的图片以激活的界面为主，比如首尾帧的尾帧激活，则导入图片就是尾帧，从历史生图发送到只能分镜也是发送尾帧。如果是图片，那么就是多参考图，只要多参考图开启，默认输入的就是下一张图，比如多参考开启，现有一张图，那么导入就是第二张图。继续导入增加第三张图。
```

## 2026-01-13 02:39 拆分小说功能整合智能分镜
```
1. 智能分镜的脚本拆分像小说节点一样增加字数统计，口径一致
2. 脚本模块点开，程序拆分右侧的LLM拆分 改为：“LLM拆脚本”，右侧增加“LLM拆小说”（默认使用拆小说节点的prompt），“LLM自定义”两个按钮，删除画笔符号右侧的描述，
3. 输入框背景的说明文字更新：“程序拆分格式： # 1  第一个镜头描述 # 2 第二个镜头描述 或者直接描述换行也可识别”
4. 只要点击画笔符号弹出LLM prompt，进入编辑模式上面按钮均不可以执行LLM拆分工作，按钮变成了切换标签，按钮变灰色，选中则高亮变蓝色特效类似旁边的画笔按钮。比如这个pormpt输入框模式开启的状态下我点击LLM拆小说，就弹出拆小说的提示词，如果点击自定义就是自定义保存的提示词，如果点击拆脚本就是现在有的拆脚本提示词。
5. 每个标签左侧三个按钮，第一个显示LLM prompt，只要用户点击就变成默认prompt（记忆）这是写死的不可修改，LLM prompt下面分别有两个可以选择记忆的prompt可以diy输入。点击则切换，选中则左侧标签高亮示意这个提示词正在使用。

```
## 2026-01-12 21:53 V2.6.1 功能合并与版本升级需求

```
[TapnowStudio-V2.6-1(original).html](原项目继承/TapnowStudio-V2.6-1(original).html) 的功能较 [Tapnow Studio-V2.6.0-Original.html](Tapnow Studio-V2.6.0-Original.html) 增加了哪些
我们的fork最初是基于2.6.0版本迭代的。不过我们之前把我们的fork项目和2.6.1原版合并过一次，但是我现在看下来并没有2.6.1的小说导入节点和保存到本地节点，请根据上方两个原项目的源代码+对比我们的34版本最新代码，参考下方原项目的更新日志来分析哪些内容没有迭代进我们的项目，执行完整的功能合并，确保我们的项目是原项目的超级。更新ag state，更新需求池，更新原需求文档（仅这段文字不包含后面日志），版本号35，操作完成后备份代码
```

## 2026-01-12 06:45 主项目合并与归档要求，归档

```
全部验收成功，把隔离项目的备份zip复制到主项目的backup中，33fix改为33fix1006passed.zip
把主项目源代码备份备注好，然后把隔离项目的最新源代码覆盖主项目源代码，版本号为34（看下是否修改代码），然后备份34代码标注里程碑，生成34的html
最后把所有原创的文档归档到主项目docs中
最后把所有原创的文档归档到主项目docs中意思是：如果有可以合并引用到需求池里的文件比照之前操作，如果不能的独立文件就在主项目doc下面新建归档文件夹放入
对了别忘了最后把主项目文档都更新一遍
```

## 2026-01-12 04:40 智能分镜计时器修复需求，更新到0.3刷新后归档

```
计时器在点击开始后正常计时，但是0.1秒这块刷新太慢，刷新稍微快些。
其二是要求时间在任务完成时停止一直显示使用的秒数。然后在下一次重新生成的时候从0开始计时
```

## 2026-01-11 12:00 模型选择一致性与 Jimeng 视频规范补充 (分支记录)，归档

```
我的需求包含选择正确的模型输出正确的模型内容，不是它是上层代理归一就不管了。尤其是我提问，那么就算是其他带来的问题也需要叙述。不可留空等我问询。

这里是jimeng-api网页逆向项目的文档，也就是我们用的上游代理，是包含fast模型的选择的，分析，酌情修改

Video Generation
POST /v1/videos/generations

Generate a video from a text prompt (Text-to-Video) or from start/end frame images (Image-to-Video). Supports three generation modes:

Text-to-Video: Pure text prompt without any images
Image-to-Video: Single image as the first frame
First-Last Frame: Two images as the first and last frames
Mode Detection: The system automatically determines the generation mode based on the presence of images:

No images → Text-to-Video mode
1 image → Image-to-Video mode (only first_frame_image is provided)
2 images → First-Last Frame mode (both first_frame_image and end_frame_image are provided)
Request Parameters:

model (string): The name of the video model to use.
prompt (string): The text description of the video content.
ratio (string, optional): Video aspect ratio, defaults to "1:1". Supported ratios: 1:1, 4:3, 3:4, 16:9, 9:16, 21:9. Note: In image-to-video mode (when images are provided), this parameter will be ignored, and the video aspect ratio will be determined by the input image's actual ratio.
resolution (string, optional): Video resolution, defaults to "720p". Supported resolutions: 720p, 1080p. Note: Only jimeng-video-3.0 and jimeng-video-3.0-fast support this parameter; other models ignore it.
duration (number, optional): Video duration in seconds. Supported values vary by model:
jimeng-video-veo3 / jimeng-video-veo3.1: 8 (fixed)
jimeng-video-sora2: 4 (default), 8, 12
jimeng-video-3.5-pro: 5 (default), 10, 12
Other models: 5 (default), 10
file_paths (array, optional): An array of image URLs to specify the start frame (1st element) and end frame (2nd element) of the video.
[file] (file, optional): Local image files uploaded via multipart/form-data (up to 2) to specify the start frame and end frame. The field name can be arbitrary, e.g., image1.
response_format (string, optional): Response format, supports url (default) or b64_json.
Image Input Description:

You can provide input images via file_paths (URL array) or by directly uploading files.
If both methods are provided, the system will prioritize the locally uploaded files.
Up to 2 images are supported, the 1st as the start frame, the 2nd as the end frame.
Important: Once image input is provided (image-to-video or first-last frame video), the ratio parameter will be ignored, and the video aspect ratio will be determined by the input image's actual ratio. The resolution parameter remains effective.
Supported Video Models:

jimeng-video-3.5-pro - Professional Edition v3.5, works on all sites (Default)
jimeng-video-veo3 - Veo3 model, Asia international sites only (HK/JP/SG), fixed 8s duration
jimeng-video-veo3.1 - Veo3.1 model, Asia international sites only (HK/JP/SG), fixed 8s duration
jimeng-video-sora2 - Sora2 model, Asia international sites only (HK/JP/SG)
jimeng-video-3.0-pro - Professional Edition, China and Asia international sites (HK/JP/SG)
jimeng-video-3.0 - Standard Edition, works on all sites
jimeng-video-3.0-fast - Fast Edition (China site only)
jimeng-video-2.0-pro - Professional Edition v2, China and Asia international sites (HK/JP/SG)
jimeng-video-2.0 - Standard Edition v2, China and Asia international sites (HK/JP/SG)
Note: US site only supports jimeng-video-3.5-pro and jimeng-video-3.0 models.
```

## 2026-01-11 22:45 V3.7.33 Hotfix 验收成功 🎉，归档

```
验收结果: ✅ API Model 输入框焦点丢失问题已修复！

修复内容：
- 问题：API 设置中修改模型 ID 时，由于 id 被用作 React key，导致组件重绘丢失焦点。
- 方案：引入稳定的 _uid 作为渲染 key。
```

## 2026-01-10 22:59 节点分层置顶

```
请忽略上面两个对话，继续帮我分析如何正确让节点分层。也就是现在操作的节点放在上一层视觉效果
只读不执行代码操作
```

## 2026-01-10 04:21 V3.7.30 验收成功 🎉，归档

```
验收结果: ✅ 预览回填成功！

修复内容：
- 移除 setTimeout(0) 包装，直接调用 setNodes
- 添加调试日志便于追踪问题

日志正常：
[V3.7.30 Debug] 检查分镜表任务映射: { mapSize: 2, hasTask: true }
[V3.7.30 Debug] 分镜表任务详情: { isImageMode: true }
[分镜表] 图片生成完成，回填图片: { imageCount: 4 }
```

### 新发现问题 (V3.8 待办)，归档

1. **锁定镜头仍触发任务**：灰色框锁定的镜头（outputEnabled=true）仍被加入批量队列
2. **键盘导航首次无效**：切换到新组后第一次按右键无反应，currentIndex 未正确重置
   - 日志显示 `currentIndex: 3, nextIndex: 0` 但实际应该是 `currentIndex: 0`
3. 移除调试日志（`[V3.7.30 Debug]`）


## 2026-01-10 03:37 V3.7.30 验收反馈，归档

```
验收：
日志有的，没有预览，转圈不停
正常的需求是转圈在任务返图的瞬间就直接停止，然后转圈也加一个timeout，最多60s不管有没有成功必须停止

日志：
[updateShot] 开始更新: 
Object { nodeId: "node - 1767910292315 ", shotId: 1767977456091.7048, updates: {…}, options: {} }
[updateShot] ✅ 更新镜头 1767977456091.7048: 
Object { updatedStatus: undefined, hasImages: false, imageCount: 0, firstImageUrl: "undefined..." }
```

### 问题分析，归档
- `updateShot` 被调用了，但 `updatedStatus: undefined`，`hasImages: false`
- 说明这个调用来自 UI 交互（如复选框点击），而不是生成完成回调
- 生成完成的回调可能没有正确触发

### V3.7.30 诊断修复，归档
1. 添加详细调试日志：`[V3.7.30 Debug] 检查分镜表任务映射`
2. 观察 `storyboardTaskMapRef` 是否正确记录了任务
3. 如果日志显示 `分镜表任务未找到或不是图片模式`，说明任务映射有问题

### 新增需求 (2026-01-10)
1. **积分预判可用性**：在调用 API 前先通过余额过滤账号
2. **黑名单自动重置**：每日 0 点自动清空黑名单
3. **转圈超时强制停止**：最多 60s 不管成功失败必须停止转圈


## 2026-01-10 01:02 V3.7.29 第七版验收反馈 (最新)，归档

```
V3.7.29 第七版修复完成 (状态覆盖与队列修复)

测试: 批量生成 6 张图（2线程），观察完成后是否还会变回 failed。
      尝试强制终止（输入1），观察后续任务是否能正常开始运行。

结果:
1. 完全不知道你要我检查什么，图一，我这里第一批的任务6（2）全部没有预览输出，
   而且最后两个任务一直在转圈
2. 强制终止后以6（3）运行第二批次，不会在第一轮三个任务后卡死了，会生完，
   但是依旧没有一个预览。

新增需求：队列没有显性的管理，没有办法终止，考虑队列的显性露出和管理设计
```

### V3.7.29 第七版 待修复问题

| 问题 | 描述 | 优先级 |
|------|------|--------|
| **预览不回填** | 批量生成后所有分镜卡片预览空白（生图成功但不显示） | P0 |
| **转圈不停止** | 任务完成后部分镜头仍在转圈 | P0 |
| **队列不透明** | 没有显性队列管理，无法手动终止 | P1 |

---

## 2026-01-09 11:49 V3.7.29 验收反馈 (Step 5800)，归档

```
验证：本次标号和让我测试的号码不对应
1. 这次6个生图，2线程。没有一个预览填充，也没有过程填充后消失的，啥都没有就是空白。
2. 而且播放按键从第三个镜头到第六个都是转圈圈
3. bug：另外我发现bug，四个转圈圈本就是bug，但是我用重新生成强制这四个暂停，但是添加到任务的只有2个。我看到的样子是图一，上面两个任务提交了，但是下面四个任务却是闲置状态，也没有排到任务（我这次线程选的是0）也就是说程序只让运行中的强制停止但是没有让停止的镜头运行任务（图二是再次运行看到前两个暂停处于闲置，下面的则在运行状态。）
4. 另外图片明明已经生成了但是状态还在转圈圈，请注意对于任务是否执行的判定。不会是以预览图的填充来判断的吧，应该看有没有error或者有没有返回图片信息（左侧的历史里面已经有资产生成了）这时候就应该停止任务了
```

### V3.7.29 第六版修复内容，归档
| Bug | 修复方案 |
|-----|---------|
| 异步回填缺失图片 | updateShot 传递 output_images（全部4张）而不只是 output_url |
| queueMicrotask 不可靠 | 改用 setTimeout(0)，更稳定 |
| 添加调试日志 | updateShot 内部添加日志确认执行 |

### 待验证，归档
- setTimeout(0) 是否解决状态更新问题
- 预览是否正确回填
- 转圈圈状态是否正确更新为 done

## 2026-01-09 10:54 V3.7.29 验收反馈 (Step 5676)，归档

```
验收：
1. 批量：预览的问题依旧，预览不行。三线程两个预览不行，双线程一个预览不行，预览不成功被视作没生成。但是批量的第二批次成功了。预览出问题。最后一次是6个任务2线程，这次只有2和5成功预览其余都失败（生图是成功的，都在资产里面）
2. 给一个放弃选项，图片二。也就是不操作。
3. 参数同步没问题 ✓
4. 右键预览在四格田字里面有，在1大图+3小图状态没有，下载按钮也没有
5. toast位置可以了 ✓
6. 模型联动目前没有看到了 ✓
```

### V3.7.29 第三版修复内容，归档
| Bug | 修复方案 |
|-----|---------|
| 卡住镜头弹窗 | 改用 prompt() 支持 终止/跳过/放弃 三选项 |
| 1+3布局右键 | 为大图和3个缩略图添加 onContextMenu |
| 右键下载按钮 | previewContextMenu 增加"下载"选项 |

### 关键待修复 Bug (V3.7.30)，归档
| Bug | 描述 |
|-----|------|
| 预览不回填 | 生图成功但分镜卡片预览空白，需要调试 storyboardTaskMapRef 回调 |

## 2026-01-09 10:00 V3.7.29 验收反馈 (Step 5531)，归档

```
验收反馈：
模型联动问题还没有好，又出现了模型调整一个其他联动的情况，但是这次不是整齐划一的，需要继续排查

批量生成bug很多
1. 批量的第一批都是可以加入队列的，第二个批量任务都是不行的，批量运行的时候比如三线程只有第三个镜头是灰色转圈在生图状态的，右侧的预览呢是不停切换的，从第一个镜头有预览到第三个镜头有，到第三个镜头没有变成第一个镜头，一个批次只有一个镜头有预览（三个任务同时，三个里面只有一个有预览）
2. 队列阻塞继续有问题
3. 上下可以了 ✓
4. 可以跳过了 ✓
5. toast 放到靠近屏幕中间来一点（下来一点）

右键预览 previewContextMenu 增加"预览原图"可没有成功，分镜卡片需要支持右键菜单
```

### V3.7.29 修复内容，归档
| Bug | 修复方案 |
|-----|---------|
| 模型联动（假） | 移除显示时的 localStorage fallback，只显示 shot.model |
| Toast 位置 | top-4 改为 top-20，向下移动 |
| 右键预览缺失 | 为分镜卡片 2x2 格子和单图添加 onContextMenu |

### 待修复 Bug (V3.7.30)，归档
| Bug | 描述 |
|-----|------|
| 批量第二次不运行 | 首次成功，后续批量失败，状态机问题 |
| 预览相互覆盖 | 多并发时只有一个镜头有预览 |
| 镜头状态不同步 | 三线程只有一个显示转圈 |

## 2026-01-09 09:26 V3.7.28 验收反馈 (Step 5389)

```
验收：
1. 黑屏ok
2. Toast位置可以，时间加长到5秒，同步参数也给一个toast
3. 滚动ok
4. 开屏首个队列ok，但是双数号的镜头/任务没有预览（双线程）；然后第二次生图原准备覆盖掉之前的，但是因为三个任务没有预览，程序认为没有生成，这第二次生图它只给了三个任务（三线程）bug1，但是任务也没有运行；然后新增任务6个3线程也失败。所以这是第一次任务成功第二次任务不运行的bug2，console里面正常。
5. 失败，无法组间切换（历史面板上下键）
6. 成功esc，智能分镜的预览部分也可以esc

新bug：
预览如果是图片1这样的一组有但是下一组没有，再下一组有预览的时候，图片无法从组1切换到组3来进行阅览。只有连贯的可以切过去，这不合理

新增需求：
拖拽线生成节点，节点不是以松开鼠标的点为中心生成节点，而应该以节点的连接处生成节点
```

### V3.7.28 已完成功能，归档
| 功能 | 状态 |
|------|------|
| 黑屏问题修复 | ✅ |
| Toast 放顶部 | ✅ |
| 脚本输入框滚动 | ✅ |
| ESC 关闭 Lightbox | ✅ |

### 待修复 Bug (V3.7.29)，归档
| Bug | 描述 |
|-----|------|
| 双数号镜头无预览 | 双线程时偶数镜头预览不显示 |
| 第二次批量不运行 | 首次成功，后续批量失败 |
| 历史组间导航失败 | 上下键无法切换组别 |
| 预览跳过无图组 | 有间隔的组无法跳转预览 |

### 待开发功能 (V3.7.29)，归档
1. Toast 时间加长到 5 秒
2. 参数同步时显示 Toast
3. 拖拽线生成节点以连接处为中心

## 2026-01-09 08:29 新功能需求 (Step 5174)，归档

```
左侧生成历史也需要上下箭头跳转不同组别。需要esc关闭预览窗口（也需要应用于拓展面板的预览图片）这坨没加入需求文档？更新需求文档的时候把这条也加入，更新原始文档，备份源码了吗
下次构建版本号的时候每次都用新的版本号，这样便于统计迭代次数
```

## 2026-01-09 07:21 验收反馈 (Step 4868)，归档

```
验收：
1. 生图的提示用自动消失的popup不要弹窗，参数同步时候也一样；添加了任务6张2线程，只生成了两张，且右侧预览全部没有显示
2. 生成前验证 API Key，无则立即 failed；现在这个好了
3. 新建镜头；[Batch image] 已将 7 个任务添加到队列。当前并发设置: 2；之前运行的镜头已经生成但是没有预览的镜头么有识别（6个里面已经生成2个了，新增一个，又以7个任务发布了）
4. 笔刷ok，但是笔触希望还是圆形

新bug：任意一个分镜调整了模型，其他模型全部调整了（灾难）

#新功能：双击增加预览功能，右键图片增加预览功能（放在下载下方）#

补充1：第一个队列阻塞了第二个队列就无法启动了，这个线性逻辑也不好
补充2：我手动点击了一下2-1第一个任务，然后之前的2-3到2-6逐个生成了
补充3：拆分提示词的输入框里面有拖动条了但是鼠标滚轮没有办法滚动操作它
```

### V3.7.27 修复内容，归档

| Bug | 修复方案 |
|-----|---------|
| 模型联动 (灾难性) | LLM 拆分时为每个 shot 设置独立的 model, ratio, duration 属性 |
| 队列阻塞 | 60s 超时检测 + 每 5s 周期性检查，防止卡住的任务阻塞后续批次 |
| 脚本滚轮不响应 | 添加 onWheel stopPropagation + overflow-y-auto 到脚本和 LLM Prompt 输入框 |
| taskId 冲突 | Date.now()-random 确保唯一 |
| API 未配置 | 提前检测，立即 failed |
| alert 阻塞 | 替换为自动消失的 Toast 通知系统 |
| 双击预览 | 主图和 2x2 格子支持双击打开 Lightbox |
| 右键预览 | previewContextMenu 增加"预览原图"选项 |


## 补充关于下载功能的要求 06:39

### 批量下载按钮点击时候下拉框两个选项，一个是全部下载，另一个是选中下载
#### 全部下载：
    则全部图片按照 这个节点名字+未命名镜头+镜头序号+图片序号.jpg/png命名然后打包zip下载
#### 选中下载：
    1. 如果灰色复选框勾选，图片没有勾选，则下载这个复选框选中的四张图片
    2. 如果灰色复选框勾选，图片也勾选了一张图片，则下载这一张图片
    3. 如果灰色复选框没有勾选，图片勾选了，则下载这一张图片
#### 图片单个下载：
    比照左侧历史生成那边的图片一样右键点击图片跳出菜单单张下载图片/视频


## 2026-01-09 06:29 验收反馈 (最新)

```
验收：
1. 局部重绘验证成功
2. 明明三个卡片都没有勾选，图一，但是程序告知只有两个没有锁定？然后日志如下，但是生成历史没有跳出任务，日志下面一行：
[Batch image] 已将 2 个任务添加到队列。当前并发设置: 1 Tapnow Studio-V3.7.26.html:449:95742

补充，好在我的每一个测试任务都用数字编号了所以看出图中第三个任务是被认为锁定的任务，图一图二，第三个任务正在跑的状态（错误状态）模型选错了，模型是一个没有配置api的模型，但是既然报错了为啥点击了之后是运行的状态呢，有问题应该立即终止修改这里的bug。图三我新建了两个镜头，点击批量又没有反应了（这里应该回到补镜头的逻辑）修复这里的bug2
3. 批量生图点击了之后没有反馈，要有一个popup不要老是到控制台才能看见，最吊诡的是我这里添加了任务最测面板没反应，这个队列是去哪里了？是不是因为前面的队列卡死了还要排队所以没出来？bug3
3-新bug：图五
配置是批量生图文生图，6张2线程（2-1到2-6）。只有前两个任务被运行了，但是蓝色按钮只有第二个2-2这里在运转，结果2-2反而变成了2-1的输出。而资产上面的图片2-1和2-2都变成了2-2（图片是相同的）

新增需求：
0. 局部重绘增加粗度，现在是10-100px，我们加到150px，同时应对一下拖动断线的问题拖动稍微快一点就变成点点点了
1. 左侧生成历史也需要上下箭头跳转不同组别。需要esc关闭预览窗口（也需要应用于拓展面板的预览图片）
2. 拖拽节点窗口后顶部的按钮位置变了，图四，确保这个折叠按钮定位在这个圆圈的位置（折叠时定位在最右，展开时候和右边线保持一个拓展窗口的宽度）
3. 同时调整预览窗口的宽度，加宽33%左右和左边图片预览的默认宽度相同，图四
4. 拆分脚本的输入框输入太长无法滚屏，增加滚屏（鼠标中轴）

更新需求文档，更新原文需求文档，检查备份，开工
```

## 2026-01-09 05:19 验收反馈 (Step 4562)，归档

```
验收
1. 没有按照要求改，还是顶部空了一大堆
2. 按钮逻辑正确了
3. 让你想办法改啊，就放在底部算什么？

要求归档的文档没有归档啊，另外更新了需求库了吗，备份呢
```

---

## 2026-01-09 05:09 强烈反馈 (Step 4535)，归档

```
我发现最近你怎么越来越那啥了，怎么回事
第一个按钮灰色的恢复原来的文案，改为全选，取消，恢复tmd懂吗
第二个图片选择的按钮才是改为"重选/暂定"的
要不是我看着你的输出又要改得崩溃了
```

## 2026-01-09 04:59 布局修正 (Step 4528)，归档

```
我擦勒，哪里让你把生成类型·比率·分辨率 + 时间·模型（合并到一行）了？？？原来什么样子还是什么样子
第一行，提示词
第二行，空白
第三行，生成类型·比率·分辨率
第四行，时间·模型，用时
把多余的空间删除，卡片缩小
```

## 2026-01-09 04:50 批量需求补充 (Step 4481)，归档

```
验收：
1. 我就是要把工具条放到画框之外啊，你又改回去哪有什么用？
2. 历史提示词可以了，把黄色框字放到第一行红色位置，并删除空白的一行（把整个显示框缩小）
3. ok没问题，其实最简单的判断是文生还是图生的方式就是看端点，generation是文，图的话是combination，供参考。不知道其他模型是不是一样，所以现在的方式也可以
4. ok
5. ok
6. 完全错误：全选和暂定只针对蓝色的图片按钮，和灰色按钮锁定无关，灰色按钮照旧，灰色按钮只和批量生图逻辑相关。所以popup也要重新改

需求归档了吗，原文归档了吗：另外下方要求看下：

文档要求：

{1. 批量功能微调，如果灰色框框勾选的卡片不参与批量生成（图片/视频）也就是说勾选了预览输出并且灰框勾选可以向后输出的卡片/镜头认为是用户已经选定不需要做修改了，那么批量就直接批量剩余的镜头即可；
2. 另外默认批量的线程数调整到1，带记忆功能；第一轮的逻辑按照现在的逻辑也就是把所有没有生成的镜头生成完毕，第二轮生成弹窗告知用户 a. 继续批量生成会覆盖原有输出但是资产在左侧可以查看 b. 灰框勾选的图片（选中的输出卡片/镜头）不参与批量工作流，其余视频/图片会批量生图。让用户确认。之后再点击按钮则开始批量}

找上文的这段内容，这段文字没有原文归档，这里涉及到批量的逻辑，需要归档好好研究一下；我看你写的功能池太笼统了，就拿这个批量的逻辑，你写了“打勾的不变，没打勾的重新生成”，事实不是这样啊。钩都有两种呢。只在卡片组打勾下什么？只在图片组打勾选了一张图下什么？，图片也钩了，卡片组也勾了下载什么？怎么下载？打包耗时一张一张下载？你都没有明确，但是我的原文都说清了。务必存档，梳理清逻辑再开工。
```

## 2026-01-09 04:10 验收反馈

```
验收：
2. popup需要开发
3. x 提示词还是重复的图二，比如图上"牛奶透明质感"有两句，第一句就是不要的内容，下面所有内容向上抬一行，提示词下方可以空一行（提示词最多显示两行），然后是要分到底是文生图还是图生图，到底是文生视频还是图生视频，图二这里错了，明明是图生图，又携程文生图了，而且还是没有分辨率！！
6. x 我发现默认不勾选这个问题从创建智能分镜节点一开始就出现了，一开始就要不勾选！
7. x "文案不对啊，是"重选"对应取消，和"暂定"-对应全选；可以在popup上面进行说明"原来的评价一个没改

局部重绘x：点击之后图片上面啥都没有了，不管是新建的还是从资产迁移过去的，都没有工具条。也不能取消操作。

功能描述及新功能：
1. 批量的线程数没有正确使用。线程数的意义在于避免429或者被限制。现在我用2线程，直接反馈给我三张图片，这肯定是不对的。2个线程的意思是一次共同做的任务是2组图片/视频；而2组做完之后再做接下来的任务。而且线程之间也有时间延迟是1s。你是不是做成两组是一起同时下发任务，任务之间的间隔你给搞到1s去了？先修复这个基础逻辑，然后加上上面我说的不满意再重新抽卡的逻辑（全部镜头都生成了，但是对个别不满意，打勾的不变，没打勾的重新生成）
2. 需要显示时间，比照AI 生图模块，需要实时的时间显示和需求3一起处理，智能分镜主卡片右侧
3. 重新设计主卡片右侧按钮，给一些设计方案。承载功能：时间显示；删除按钮（尽量避免误操作）放在不常用地方，比如最上时间，然后删除？当中放生图按钮，下方放调整上下的按钮，但是按钮都变大方便按。我想的还是比较原始的，请结合需求给出建议（图一）
4. 智能分镜节点需要支持图片拖动放入卡片露出的对应节点中，可以是本地图片，可以是左侧资产图片

基础功能修复好之后的版本号可以接续迭代不要一直维持这个大号
```

## 2026-01-09 03:40 验收反馈

```
验收
1. 图标导入是放在之智能分镜命名上的吗，是的话验证成功；不是的话告诉我是啥？
2. 正确，参数同步的时候给一个popup
3.红圈处删除，说了好几次了，还没有删除。文→图 / 图→图，要看到底是文生图还是图生图不是写死的，还有不需要写几图我看得到。分辨率没有写；上卖弄一行删掉后把空概念缩小点，不需要那么空白。提示词顶多留两行给他足够了；顺序改下，先写文→图或者图→图或者文→视频或者图→视频，然后是比率，最后是分辨率，视频再加秒
4. 这个正确，那么1是啥
5. 继续开发
6. 可以
7. 文案不对啊，是"重选"对应取消，和"暂定"-对应全选；可以再popup上面进行说明
8. 继续开发

上一次的验收：
5. 说明文字：
程序拆分：: #1 #2 或换行
（按钮也该回去llm拆分）LLM拆分: 使用聊天窗口相同模型，调整模型可点击左下角打开聊天窗口，模型调整在窗口右上角
6. 自定义 prompt 按钮（画笔图标）要写LLM拆分Prompt：不要弹窗！给出一个和上方文本框类似的输入框直接放在右侧横条。点击之后展示文本框，把说明文字隐藏掉。

新增
1. 局部重绘的设置条遮挡到操作了，需要把设置条放到画框外面，图二。

关于1006的探索：
1. 使用生图发现大部分的1006出现在图生图，而且是在智能分镜里面导致的
49: 同样的模型和参数，我在AI生图里面使用前置节点生图是正常的，在智能分镜里出问题报错1006
```

## 2026-01-09 02:18 验收反馈

```
对了llm和右侧chat共用相同的配置需要文字露出说明一下就放在右边；程序拆分：支持****中略***分割；LLM拆分：说明.....再在右侧增加个自定义prompt的按钮可以弹窗修改prompt
```

## 历史参数显示需求明确

**目标格式**（4行，用户最终确认）：
```
提示词 (Line 1)
空白 (Line 2)
生成类型 · 比率 · 分辨率 · 视频秒数 (Line 3)
时间 · 模型 · 用时 (Line 4)
```

**参数行顺序**：
1. 生成类型（文→图 / 图→图 / 文→视频 / 图→视频）
2. 比率
3. 分辨率
4. （视频）时长秒数

**删除内容**：
- 重复的提示词行（图片上方的那行）
- "文→3图"这类数量标注

---

## 需求时间线汇总 (按时间倒序)

| 日期时间 | 版本 | 关键内容 |
|----------|------|----------|
| 2026-01-10 01:02 | V3.7.29 第七版 | 预览仍不回填，转圈不停止，需队列管理 |
| 2026-01-09 12:15 | V3.7.29 第七版 | 状态竞态修复 + 强制重试修复 |
| 2026-01-09 11:49 | V3.7.29 第六版 | setTimeout(0) + output_images 完整传递 |
| 2026-01-09 10:54 | V3.7.29 第三版 | 三选项弹窗 + 1+3布局右键 + 下载按钮 |
| 2026-01-09 08:xx | V3.7.29 第一版 | 模型联动修复 + Toast位置 + 右键预览 |
| 2026-01-09 06:29 | V3.7.26 | 批量逻辑bug，队列卡死，模型错误 |
| 2026-01-09 04:50 | V3.7.26 | 批量需求补充，下载功能详细要求 |
| 2026-01-09 04:10 | V3.7.26 | popup开发，提示词显示修复 |

### 2026-01-12 V3.7.33 反馈
错错错！！！
而且我看了user requirement raw，从2026-01-10 03:37 V3.7.30 验收反馈 (最新)往后的内容全部都不是原文！全部记录原文，把所有的01-10 03:37之后的原文记录补充完整！包括骂人的，包括这句！奶妈的！重新记录

changelog里面又是瞎搞，哪里来的3.8.1；还有真有脸写上智能分镜时间显示 (V2)生成结束后**不再清零**；特么的成功了没有，都没有经过验收的东西写上干嘛？

需求池就更别提了，里面做完的不划掉，原始需求的倒是不加入的。你是要上天啊？

ag_state也都说了每次输出中文写入到头条得，都被改掉了，搞了三个，还一个old，一个update，原始内容明确每一次操作必须做的事情呢，把ag_state重写！用中文重写，routine和操作规范不得删除！明确写在头条！routine是每次必须操作前检查备份，操作时严格明确操作范围，操作完更新需求池，更新原始用户需求文本，更新changelog，备份源代码，构建生成物！routine和操作规范不得删除！
## 归档候选（待二次确认删除）
已归档文件：`docs/archive/user_requirements_raw_archive_20260115-0626.md`

## 2026-01-13 22:26 36a/36c 验收反馈与本地缓存/保存调整需求，归档
```
验收：
1. 35版本的生成视频/图片节点的模型选择都要给到双层选择（这是我们的特色）改完35版本验收完成
2. 36a:“我怎么感觉这个本地缓存服务器和本地保存节点好像是一回事情？”这个问题你没有回答，现在回答我。
验收：保存按钮验收完毕，功能可行，保存节点的自动保存功能也正常
问题：
1/python的脚本会卡住？导致保存功能失败，history文件夹是缓存？
2/那么里面只保存了四张生成的第一张图片，其他三张没有保存；确保全部保存
3/缓存目录是否不一致？另外1768308020219-4rdaq6.jpg 这个文件是啥
4/手动保存的/自动保存的文件需要按照提示词重命名，如有项目标题则为 项目名-提示词-编号
5/配置已更新的toast不消失；图片和视频的保存路径正反斜杠统一吧，右侧加一个浏览按钮浏览地址
6/ 图2，原项目的本地缓存已连接是不受上方折叠按钮影响，只要连接就会亮起在外露出的，比照修改。并且蓝色提示也比较添加并检查是否如此。

服务器的日志（3/的补充）
[2026-01-13 20:40:47] 缓存文件已保存: 
C:\Users\Christopher/Downloads/TapnowStudio\history\537e284c907f4d4ab66b141e2d570d13~tplv-wopfjsm1ax-aigc_resize_0_0.jpg (893493 bytes)

浏览器的日志报错，是否目录不一致（3/的补充）
[API Select] Using Key ending in ...39a8 Tapnow Studio-V3.7.36c.html:454:96167
XHRHEAD
http://127.0.0.1:9527/file/.tapnow_cache/history/537e284c907f4d4ab66b141e2d570d13~tplv-wopfjsm1ax-aigc_resize_0_0.jpg
[HTTP/1 404 Not Found 3ms]

XHRHEAD
http://127.0.0.1:9527/file/.tapnow_cache/history/537e284c907f4d4ab66b141e2d570d13~tplv-wopfjsm1ax-aigc_resize_0_0.png
[HTTP/1 404 Not Found 1ms]

XHRHEAD
http://127.0.0.1:9527/file/.tapnow_cache/history/1768308020219-4rdaq6.jpg
[HTTP/1 404 Not Found 3ms]

XHRHEAD
http://127.0.0.1:9527/file/.tapnow_cache/history/1768308020219-4rdaq6.png
[HTTP/1 404 Not Found 2ms]

[AutoSave] 自动保存完成 12:41:15 PM

=================

36b 已经修改的功能目前验收正常，我们也和原项目一样把两端按钮独立开来。相关疑问：我们的全局ultra有什么变化，原来项目只有两挡呀。

36c 验收：标签参数正确，四图显示正确，模型显示正确，按钮也有了，
新增：后端缓存的图片也比照原项目标在批量素材管理里面标记后端缓存，原项目的批量素材样式中的1/2/3/4的左下角标增加上（图3），而且原项目在各自小图双击可以打开各自小图的预览我们加上，单击小图有灰一下然后点击右上角的预览按钮可以预览对应小图，只有点击下方提示词和参数的标签处才能选中整个卡片并勾选，我们比照修改。
```

## 2026-01-13 18:36 35 版本验收微调与 36a 黑屏修复，归档
```
那么35版本的修复呢？
36c的修复是否包含36a和36b

35的版本验收：
1. prompt角色展开验收完毕
2. 功能都有了，验收成功，需要微调一下，风格环节原项目是下拉框选择预设内容然后根据预设内容修改prompt，不需要预先填充，只需要用户选择即可；另外参考一下原来项目的提示词（下方）
3. 子菜单制作功能正常，需要微调，子菜单样式和我们双层模型类似，右侧增加菜单不要下方增加菜单，参考图1
看下是不是用src_backup_v3.7.35_desc_prompt_fix_20260113-0712来修改，修改后备份源码构建生成物

提示词过滤
{
  "model": "gemini-3-flash",
  "messages": [
    {
      "role": "system",
      "content": "你是一个提示词优化专家。请分析以下提示词，只保留关于人物外貌、服装、姿态等角色特征的描述，去除所有剧情、动作、对话和背景信息。输出应简洁，只包含角色特征描述，格式为\"全身视角，[人物特征描述]，站在纯白色背景前\"。必须确保背景始终是纯白色，不能有任何场景描述。"
    },
    {
      "role": "user",
      "content": "动漫风格，全身视角，名叫总工程师的不详岁左右男站在白色背景前，负责罗布泊东方核子中心加速器的具体运行。性格务实，更关注试验的实际操作和对社会的影响，在宇宙异象发生时表现出担忧。，正在用中文普通话面向镜头做自我介绍，说着：我是总工程师，加速器运行负责人，然后缓慢转一圈360度全方位展示身体"
    }
  ],
  "temperature": 0.3
}

场景增强提示词
{
  "model": "gemini-3-flash",
  "messages": [
    {
      "role": "system",
      "content": "你是一个场景描述优化专家。请分析以下提示词，只保留关于场景、环境、建筑、背景等场景特征的描述，去除所有人物、角色、字符、对话和动作描述。输出应简洁，只包含场景特征描述，不能包含任何人物或角色。"
    },
    {
      "role": "user",
      "content": "位于罗布泊沙漠，由一群优雅的白色建筑组成。地下深处建有周长150公里的巨大粒子加速器，是人类试图击破夸克的实验场。"
    }
  ],
  "temperature": 0.3 
}

4. 36a开始黑屏需要修复

ReferenceError: can't access lexical declaration 'Jd' before initialization
    fz file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:671
    z0 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:45
    Xy file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    Vy file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    s2 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    nd file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    Rf file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    By file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    H file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    X file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    EventHandlerNonNull* file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    <anonymous> file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
Tapnow Studio-V3.7.36a.html:454:96060
Uncaught ReferenceError: can't access lexical declaration 'Jd' before initialization
    fz file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:671
    z0 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:45
    Xy file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    Vy file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    s2 file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    nd file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    Rf file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    By file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:47
    H file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    X file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    EventHandlerNonNull* file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
    <anonymous> file:///D:/CodingPlayground/Tapnow/Tapnow Studio-V3.7.36a.html:32
Tapnow Studio-V3.7.36a.html:671:40664
```

## 2026-01-13 08:10 36c 批量素材管理修复需求，归档
```
前面全部做完之后确保备份后再做这个：

36c版本修复内容，图片一是我们35版本的批量素材管理，模型名称显示不正确。图片只显示一张。 而图二原始项目中显示四张，且右上角还有清理缓存按钮。
需求：1. 让我们模型也显示正确
2. 让我们的显示也是四张
3. 比照原始项目增加批量删除按钮
4. 把我们在生成历史里面的图片参数也同步过来 最终显示：类型，模型，比例/分辨率/（时长），时间，耗时；为了节约空间这里时间用24小时制不用写PMAM了，耗时部分的用时两个汉字也省略用分钟直接 0.5m 就是30s只保留一位小数。///文→图 jimeng-4.5 · 16:9/2K · 22:36 · 0.5m///  图→视 jimeng-v3.0 · 16:9/720/5s · 23:36 · 5.2m//最终的格式这样，模型最长12个字符，如果太长可以按照我这样缩写，鼠标悬停展示全名

备份代码，更新文档，需求池，原始需求池，生成构成物
```

## 2026-01-13 08:09 36b 本地缓存菜单与性能按钮对比，归档
```
36b版本是在36a的基础上补充生成历史这里的本地缓存功能折叠菜单+原版的自动缓存保存路径，png转jpg功能；保存节点的服务器地址修改，子文件夹修改，没有png转jpg功能。原版的bug需要修复，就是待保存文件在前方节点刷新后需要更新

另外详细分析下原版的闪电是否只控制历史这里的图片预览，对整体性能没有影响吧。
原版整体只有性能模式和非性能模式，我们这里有三档；原版两个按钮是分开控制的，我们是串联一起的。列表格对比我们的按钮和原版的按钮差异，我需要根据输出调整最终布局。
```

## 2026-01-13 07:12 角色与场景描述增强、菜单结构与缓存保存需求，归档
```
原版导入的提示词：动漫风格，全身视角，名叫丁仪的中年岁左右男站在白色背景前，物质无限可分学派的代表人物。身穿蓝色工作服，外表朴素如勤杂工，性格冷静且对科学探索充满乐观，认为击破夸克是物理学的新起点。，正在用中文普通话面向镜头做自我介绍，说着：我是丁仪，中国理论物理学家，然后缓慢转一圈360度全方位展示身体

我们版本的提示词：动漫风格，全身视角，名叫丁仪的25岁左右年轻男人站在白色背景前，杰出的中国理论物理学家，主张物质无限可分。他性格冷静、坚定，对科学探索充满理想主义，常身穿蓝色工作服，外表朴素，容易被误认为是勤杂工。，正在用中文普通话面向镜头做自我介绍，说着：我是丁仪，角色设定，然后缓慢转一圈360度全方位展示身体

1. 看到差别了吗，倒数第二句这里视频模式第二段我们的版本没有把角色设定展开。这里需要修改并展开具体角色设定；图片模式里面也是一样。而且在生成角色图片节点里多加了“然后缓慢转一圈360度全方位展示身体”这样一句话。

2. 图二，原版的场景描述和角色描述没有我们这么简陋，是有增强场景描述，过滤提示词的大模型能力的，同时可以选择LLM。还可以拖拽或者点击增加参考图。按照图二增加大模型双层选择，增加风格，增加参考图（多图）但是不要像他一样添加生图生视频等参数，这是下一个节点的工作。
另外现在切换到图片模式自动连接出来一个图片节点很好，我希望点击图片模式的时候判断有没有连接图片节点，没有的话就直接生成并连接。这个对视频节点也一样。比如默认生成的生成角色视频节点被我删除，或者被我删除连结了，那么这时候点击视频模式就应该像图片模式一样自动连接一个生角色/场景视频节点

3. 图三，菜单目录中其他新增条目全部作为提取角色和场景的子目录，提取角色和场景条目分为两段，前段点击是“角色与场景提取”节点，后段折叠符号悬浮或点击展开子目录图二

====以上修复为35版本====做好保存源代码，更新所有相关文档后继续在这个基础上制作下面修复

4. 修复节点缓存和保存功能
[v2_6_1_vs_v3_7_34_feature_compare.md](docs/v2_6_1_vs_v3_7_34_feature_compare.md) 
经过我的原版摸索操作，我怎么感觉这个本地缓存服务器和本地保存节点好像是一回事情？
[tapnow-local-server.py](本地连接器/tapnow-local-server.py) 本地缓存也是把文件下载到一个目录？
我使用作者的原版
本地缓存失败，但是批量保存成功，另外自动保存也是没有触发的。我们的35版本也是缓存失败，另外我们35版本的保存节点没有手动保存本地按钮；

=====36版本======上方36a，下方36b======每个版本保存源代码，构建html，更新文档
{没有服务器地址修改，没有子文件夹修改，没有原版的自动缓存保存路径，没有png转jpg功能。} 


[2026-01-13 00:24:10] HTTP: GET /ping HTTP/1.1
[2026-01-13 00:24:13] HTTP: HEAD /file/history/24e5e569f1204a61a0c60116e4e15c08~tplv-wopfjsm1ax-aigc_resize:0:0.jpg HTTP/1.1
[2026-01-13 00:24:13] HTTP: HEAD /file/history/24e5e569f1204a61a0c60116e4e15c08~tplv-wopfjsm1ax-aigc_resize:0:0.png HTTP/1.1
[2026-01-13 00:24:13] HTTP: HEAD /file/history/1768228743334.jpg HTTP/1.1
[2026-01-13 00:24:13] HTTP: HEAD /file/history/1768228743334.png HTTP/1.1
[2026-01-13 00:24:16] 保存缓存失败: [Errno 22] Invalid argument: 'C:\\Users\\Christopher/Downloads/TapnowStudio\\.tapnow_cache\\history\\24e5e569f1204a61a0c60116e4e15c08~tplv-wopfjsm1ax-aigc_resize:0:0.jpg'
[2026-01-13 00:24:16] HTTP: POST /save-cache HTTP/1.1

2026-01-13 00:32:03] HTTP: OPTIONS /save-batch HTTP/1.1
[2026-01-13 00:32:07] 批量保存: C:\Users\Christopher/Downloads/TapnowStudio\tapnow_1768235518903_0.jpg
[2026-01-13 00:32:07] 批量保存: C:\Users\Christopher/Downloads/TapnowStudio\tapnow_1768235520136_1.jpg
[2026-01-13 00:32:07] 批量保存: C:\Users\Christopher/Downloads/TapnowStudio\tapnow_1768235522636_2.jpg
[2026-01-13 00:32:07] 批量保存: C:\Users\Christopher/Downloads/TapnowStudio\tapnow_1768235523586_3.jpg
[2026-01-13 00:32:07] HTTP: POST /save-batch HTTP/1.1
```

## 2026-01-13 04:07 小说拆分链路与 CORS 说明，归档
```
1. 继续报错CORS，只在使用https://127.0.0.1的本地服务的时候报错改为http后正常生成但是有warning，用云端api也正常，没关系的话就这么放着
2. 上文的功能补充实现，记得备份，需求池，ag_state，原文需求，构建物

Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at https://127.0.0.1:8045/v1/chat/completions. (Reason: CORS request did not succeed). Status code: (null). 2
Extraction Failed TypeError: NetworkError when attempting to fetch resource. Tapnow Studio-V3.7.35.html:449:95811
[AutoSave] 自动保存完成 6:03:42 PM Tapnow Studio-V3.7.35.html:449:95918
Cross-Origin Request Warning: The Same Origin Policy will disallow reading the remote resource at http://127.0.0.1:8045/v1/chat/completions soon. (Reason: When the `Access-Control-Allow-Headers` is `*`, the `Authorization` header is not covered. To include the `Authorization` header, it must be explicitly listed in CORS header `Access-Control-Allow-Headers`).
[AutoSave] 自动保存完成 6:04:42 PM Tapnow Studio-V3.7.35.html:449:95918
```

## 2026-01-12 06:45 主项目合并与归档要求，归档

```
全部验收成功，把隔离项目的备份zip复制到主项目的backup中，33fix改为33fix1006passed.zip
把主项目源代码备份备注好，然后把隔离项目的最新源代码覆盖主项目源代码，版本号为34（看下是否修改代码），然后备份34代码标注里程碑，生成34的html
最后把所有原创的文档归档到主项目docs中
最后把所有原创的文档归档到主项目docs中意思是：如果有可以合并引用到需求池里的文件比照之前操作，如果不能的独立文件就在主项目doc下面新建归档文件夹放入
对了别忘了最后把主项目文档都更新一遍
```

## 2026-01-12 04:40 智能分镜计时器修复需求，更新到0.3刷新后归档

```
计时器在点击开始后正常计时，但是0.1秒这块刷新太慢，刷新稍微快些。
其二是要求时间在任务完成时停止一直显示使用的秒数。然后在下一次重新生成的时候从0开始计时
```

## 2026-01-11 12:00 模型选择一致性与 Jimeng 视频规范补充 (分支记录)，归档

```
我的需求包含选择正确的模型输出正确的模型内容，不是它是上层代理归一就不管了。尤其是我提问，那么就算是其他带来的问题也需要叙述。不可留空等我问询。

这里是jimeng-api网页逆向项目的文档，也就是我们用的上游代理，是包含fast模型的选择的，分析，酌情修改

Video Generation
POST /v1/videos/generations

Generate a video from a text prompt (Text-to-Video) or from start/end frame images (Image-to-Video). Supports three generation modes:

Text-to-Video: Pure text prompt without any images
Image-to-Video: Single image as the first frame
First-Last Frame: Two images as the first and last frames
Mode Detection: The system automatically determines the generation mode based on the presence of images:

No images → Text-to-Video mode
1 image → Image-to-Video mode (only first_frame_image is provided)
2 images → First-Last Frame mode (both first_frame_image and end_frame_image are provided)
Request Parameters:

model (string): The name of the video model to use.
prompt (string): The text description of the video content.
ratio (string, optional): Video aspect ratio, defaults to "1:1". Supported ratios: 1:1, 4:3, 3:4, 16:9, 9:16, 21:9. Note: In image-to-video mode (when images are provided), this parameter will be ignored, and the video aspect ratio will be determined by the input image's actual ratio.
resolution (string, optional): Video resolution, defaults to "720p". Supported resolutions: 720p, 1080p. Note: Only jimeng-video-3.0 and jimeng-video-3.0-fast support this parameter; other models ignore it.
duration (number, optional): Video duration in seconds. Supported values vary by model:
jimeng-video-veo3 / jimeng-video-veo3.1: 8 (fixed)
jimeng-video-sora2: 4 (default), 8, 12
jimeng-video-3.5-pro: 5 (default), 10, 12
Other models: 5 (default), 10
file_paths (array, optional): An array of image URLs to specify the start frame (1st element) and end frame (2nd element) of the video.
[file] (file, optional): Local image files uploaded via multipart/form-data (up to 2) to specify the start frame and end frame. The field name can be arbitrary, e.g., image1.
response_format (string, optional): Response format, supports url (default) or b64_json.
Image Input Description:

You can provide input images via file_paths (URL array) or by directly uploading files.
If both methods are provided, the system will prioritize the locally uploaded files.
Up to 2 images are supported, the 1st as the start frame, the 2nd as the end frame.
Important: Once image input is provided (image-to-video or first-last frame video), the ratio parameter will be ignored, and the video aspect ratio will be determined by the input image's actual ratio. The resolution parameter remains effective.
Supported Video Models:

jimeng-video-3.5-pro - Professional Edition v3.5, works on all sites (Default)
jimeng-video-veo3 - Veo3 model, Asia international sites only (HK/JP/SG), fixed 8s duration
jimeng-video-veo3.1 - Veo3.1 model, Asia international sites only (HK/JP/SG), fixed 8s duration
jimeng-video-sora2 - Sora2 model, Asia international sites only (HK/JP/SG)
jimeng-video-3.0-pro - Professional Edition, China and Asia international sites (HK/JP/SG)
jimeng-video-3.0 - Standard Edition, works on all sites
jimeng-video-3.0-fast - Fast Edition (China site only)
jimeng-video-2.0-pro - Professional Edition v2, China and Asia international sites (HK/JP/SG)
jimeng-video-2.0 - Standard Edition v2, China and Asia international sites (HK/JP/SG)
Note: US site only supports jimeng-video-3.5-pro and jimeng-video-3.0 models.
```

## 2026-01-11 22:45 V3.7.33 Hotfix 验收成功 🎉，归档

```
验收结果: ✅ API Model 输入框焦点丢失问题已修复！

修复内容：
- 问题：API 设置中修改模型 ID 时，由于 id 被用作 React key，导致组件重绘丢失焦点。
- 方案：引入稳定的 _uid 作为渲染 key。
```

## 2026-01-10 04:21 V3.7.30 验收成功 🎉，归档

```
验收结果: ✅ 预览回填成功！

修复内容：
- 移除 setTimeout(0) 包装，直接调用 setNodes
- 添加调试日志便于追踪问题

日志正常：
[V3.7.30 Debug] 检查分镜表任务映射: { mapSize: 2, hasTask: true }
[V3.7.30 Debug] 分镜表任务详情: { isImageMode: true }
[分镜表] 图片生成完成，回填图片: { imageCount: 4 }
```

### 新发现问题 (V3.8 待办)，归档

1. **锁定镜头仍触发任务**：灰色框锁定的镜头（outputEnabled=true）仍被加入批量队列
2. **键盘导航首次无效**：切换到新组后第一次按右键无反应，currentIndex 未正确重置
   - 日志显示 `currentIndex: 3, nextIndex: 0` 但实际应该是 `currentIndex: 0`
3. 移除调试日志（`[V3.7.30 Debug]`）


## 2026-01-10 03:37 V3.7.30 验收反馈，归档

```
验收：
日志有的，没有预览，转圈不停
正常的需求是转圈在任务返图的瞬间就直接停止，然后转圈也加一个timeout，最多60s不管有没有成功必须停止

日志：
[updateShot] 开始更新: 
Object { nodeId: "node - 1767910292315 ", shotId: 1767977456091.7048, updates: {…}, options: {} }
[updateShot] ✅ 更新镜头 1767977456091.7048: 
Object { updatedStatus: undefined, hasImages: false, imageCount: 0, firstImageUrl: "undefined..." }
```

### 问题分析，归档
- `updateShot` 被调用了，但 `updatedStatus: undefined`，`hasImages: false`
- 说明这个调用来自 UI 交互（如复选框点击），而不是生成完成回调
- 生成完成的回调可能没有正确触发

### V3.7.30 诊断修复，归档
1. 添加详细调试日志：`[V3.7.30 Debug] 检查分镜表任务映射`
2. 观察 `storyboardTaskMapRef` 是否正确记录了任务
3. 如果日志显示 `分镜表任务未找到或不是图片模式`，说明任务映射有问题

### 新增需求 (2026-01-10)
1. **积分预判可用性**：在调用 API 前先通过余额过滤账号
2. **黑名单自动重置**：每日 0 点自动清空黑名单
3. **转圈超时强制停止**：最多 60s 不管成功失败必须停止转圈


## 2026-01-10 01:02 V3.7.29 第七版验收反馈 (最新)，归档

```
V3.7.29 第七版修复完成 (状态覆盖与队列修复)

测试: 批量生成 6 张图（2线程），观察完成后是否还会变回 failed。
      尝试强制终止（输入1），观察后续任务是否能正常开始运行。

结果:
1. 完全不知道你要我检查什么，图一，我这里第一批的任务6（2）全部没有预览输出，
   而且最后两个任务一直在转圈
2. 强制终止后以6（3）运行第二批次，不会在第一轮三个任务后卡死了，会生完，
   但是依旧没有一个预览。

新增需求：队列没有显性的管理，没有办法终止，考虑队列的显性露出和管理设计
```

### V3.7.29 第七版 待修复问题

| 问题 | 描述 | 优先级 |
|------|------|--------|
| **预览不回填** | 批量生成后所有分镜卡片预览空白（生图成功但不显示） | P0 |
| **转圈不停止** | 任务完成后部分镜头仍在转圈 | P0 |
| **队列不透明** | 没有显性队列管理，无法手动终止 | P1 |

---

## 2026-01-09 11:49 V3.7.29 验收反馈 (Step 5800)，归档

```
验证：本次标号和让我测试的号码不对应
1. 这次6个生图，2线程。没有一个预览填充，也没有过程填充后消失的，啥都没有就是空白。
2. 而且播放按键从第三个镜头到第六个都是转圈圈
3. bug：另外我发现bug，四个转圈圈本就是bug，但是我用重新生成强制这四个暂停，但是添加到任务的只有2个。我看到的样子是图一，上面两个任务提交了，但是下面四个任务却是闲置状态，也没有排到任务（我这次线程选的是0）也就是说程序只让运行中的强制停止但是没有让停止的镜头运行任务（图二是再次运行看到前两个暂停处于闲置，下面的则在运行状态。）
4. 另外图片明明已经生成了但是状态还在转圈圈，请注意对于任务是否执行的判定。不会是以预览图的填充来判断的吧，应该看有没有error或者有没有返回图片信息（左侧的历史里面已经有资产生成了）这时候就应该停止任务了
```

### V3.7.29 第六版修复内容，归档
| Bug | 修复方案 |
|-----|---------|
| 异步回填缺失图片 | updateShot 传递 output_images（全部4张）而不只是 output_url |
| queueMicrotask 不可靠 | 改用 setTimeout(0)，更稳定 |
| 添加调试日志 | updateShot 内部添加日志确认执行 |

### 待验证，归档
- setTimeout(0) 是否解决状态更新问题
- 预览是否正确回填
- 转圈圈状态是否正确更新为 done

## 2026-01-09 10:54 V3.7.29 验收反馈 (Step 5676)，归档

```
验收：
1. 批量：预览的问题依旧，预览不行。三线程两个预览不行，双线程一个预览不行，预览不成功被视作没生成。但是批量的第二批次成功了。预览出问题。最后一次是6个任务2线程，这次只有2和5成功预览其余都失败（生图是成功的，都在资产里面）
2. 给一个放弃选项，图片二。也就是不操作。
3. 参数同步没问题 ✓
4. 右键预览在四格田字里面有，在1大图+3小图状态没有，下载按钮也没有
5. toast位置可以了 ✓
6. 模型联动目前没有看到了 ✓
```

### V3.7.29 第三版修复内容，归档
| Bug | 修复方案 |
|-----|---------|
| 卡住镜头弹窗 | 改用 prompt() 支持 终止/跳过/放弃 三选项 |
| 1+3布局右键 | 为大图和3个缩略图添加 onContextMenu |
| 右键下载按钮 | previewContextMenu 增加"下载"选项 |

### 关键待修复 Bug (V3.7.30)，归档
| Bug | 描述 |
|-----|------|
| 预览不回填 | 生图成功但分镜卡片预览空白，需要调试 storyboardTaskMapRef 回调 |

## 2026-01-09 10:00 V3.7.29 验收反馈 (Step 5531)，归档

```
验收反馈：
模型联动问题还没有好，又出现了模型调整一个其他联动的情况，但是这次不是整齐划一的，需要继续排查

批量生成bug很多
1. 批量的第一批都是可以加入队列的，第二个批量任务都是不行的，批量运行的时候比如三线程只有第三个镜头是灰色转圈在生图状态的，右侧的预览呢是不停切换的，从第一个镜头有预览到第三个镜头有，到第三个镜头没有变成第一个镜头，一个批次只有一个镜头有预览（三个任务同时，三个里面只有一个有预览）
2. 队列阻塞继续有问题
3. 上下可以了 ✓
4. 可以跳过了 ✓
5. toast 放到靠近屏幕中间来一点（下来一点）

右键预览 previewContextMenu 增加"预览原图"可没有成功，分镜卡片需要支持右键菜单
```

### V3.7.29 修复内容，归档
| Bug | 修复方案 |
|-----|---------|
| 模型联动（假） | 移除显示时的 localStorage fallback，只显示 shot.model |
| Toast 位置 | top-4 改为 top-20，向下移动 |
| 右键预览缺失 | 为分镜卡片 2x2 格子和单图添加 onContextMenu |

### 待修复 Bug (V3.7.30)，归档
| Bug | 描述 |
|-----|------|
| 批量第二次不运行 | 首次成功，后续批量失败，状态机问题 |
| 预览相互覆盖 | 多并发时只有一个镜头有预览 |
| 镜头状态不同步 | 三线程只有一个显示转圈 |

## 2026-01-09 08:29 新功能需求 (Step 5174)，归档

```
左侧生成历史也需要上下箭头跳转不同组别。需要esc关闭预览窗口（也需要应用于拓展面板的预览图片）这坨没加入需求文档？更新需求文档的时候把这条也加入，更新原始文档，备份源码了吗
下次构建版本号的时候每次都用新的版本号，这样便于统计迭代次数
```

## 2026-01-09 07:21 验收反馈 (Step 4868)，归档

```
验收：
1. 生图的提示用自动消失的popup不要弹窗，参数同步时候也一样；添加了任务6张2线程，只生成了两张，且右侧预览全部没有显示
2. 生成前验证 API Key，无则立即 failed；现在这个好了
3. 新建镜头；[Batch image] 已将 7 个任务添加到队列。当前并发设置: 2；之前运行的镜头已经生成但是没有预览的镜头么有识别（6个里面已经生成2个了，新增一个，又以7个任务发布了）
4. 笔刷ok，但是笔触希望还是圆形

新bug：任意一个分镜调整了模型，其他模型全部调整了（灾难）

#新功能：双击增加预览功能，右键图片增加预览功能（放在下载下方）#

补充1：第一个队列阻塞了第二个队列就无法启动了，这个线性逻辑也不好
补充2：我手动点击了一下2-1第一个任务，然后之前的2-3到2-6逐个生成了
补充3：拆分提示词的输入框里面有拖动条了但是鼠标滚轮没有办法滚动操作它
```

### V3.7.27 修复内容，归档

| Bug | 修复方案 |
|-----|---------|
| 模型联动 (灾难性) | LLM 拆分时为每个 shot 设置独立的 model, ratio, duration 属性 |
| 队列阻塞 | 60s 超时检测 + 每 5s 周期性检查，防止卡住的任务阻塞后续批次 |
| 脚本滚轮不响应 | 添加 onWheel stopPropagation + overflow-y-auto 到脚本和 LLM Prompt 输入框 |
| taskId 冲突 | Date.now()-random 确保唯一 |
| API 未配置 | 提前检测，立即 failed |
| alert 阻塞 | 替换为自动消失的 Toast 通知系统 |
| 双击预览 | 主图和 2x2 格子支持双击打开 Lightbox |
| 右键预览 | previewContextMenu 增加"预览原图"选项 |


## 2026-01-09 05:19 验收反馈 (Step 4562)，归档

```
验收
1. 没有按照要求改，还是顶部空了一大堆
2. 按钮逻辑正确了
3. 让你想办法改啊，就放在底部算什么？

要求归档的文档没有归档啊，另外更新了需求库了吗，备份呢
```

---

## 2026-01-09 05:09 强烈反馈 (Step 4535)，归档

```
我发现最近你怎么越来越那啥了，怎么回事
第一个按钮灰色的恢复原来的文案，改为全选，取消，恢复tmd懂吗
第二个图片选择的按钮才是改为"重选/暂定"的
要不是我看着你的输出又要改得崩溃了
```

## 2026-01-09 04:59 布局修正 (Step 4528)，归档

```
我擦勒，哪里让你把生成类型·比率·分辨率 + 时间·模型（合并到一行）了？？？原来什么样子还是什么样子
第一行，提示词
第二行，空白
第三行，生成类型·比率·分辨率
第四行，时间·模型，用时
把多余的空间删除，卡片缩小
```

## 2026-01-09 04:50 批量需求补充 (Step 4481)，归档

```
验收：
1. 我就是要把工具条放到画框之外啊，你又改回去哪有什么用？
2. 历史提示词可以了，把黄色框字放到第一行红色位置，并删除空白的一行（把整个显示框缩小）
3. ok没问题，其实最简单的判断是文生还是图生的方式就是看端点，generation是文，图的话是combination，供参考。不知道其他模型是不是一样，所以现在的方式也可以
4. ok
5. ok
6. 完全错误：全选和暂定只针对蓝色的图片按钮，和灰色按钮锁定无关，灰色按钮照旧，灰色按钮只和批量生图逻辑相关。所以popup也要重新改

需求归档了吗，原文归档了吗：另外下方要求看下：

文档要求：

{1. 批量功能微调，如果灰色框框勾选的卡片不参与批量生成（图片/视频）也就是说勾选了预览输出并且灰框勾选可以向后输出的卡片/镜头认为是用户已经选定不需要做修改了，那么批量就直接批量剩余的镜头即可；
2. 另外默认批量的线程数调整到1，带记忆功能；第一轮的逻辑按照现在的逻辑也就是把所有没有生成的镜头生成完毕，第二轮生成弹窗告知用户 a. 继续批量生成会覆盖原有输出但是资产在左侧可以查看 b. 灰框勾选的图片（选中的输出卡片/镜头）不参与批量工作流，其余视频/图片会批量生图。让用户确认。之后再点击按钮则开始批量}

找上文的这段内容，这段文字没有原文归档，这里涉及到批量的逻辑，需要归档好好研究一下；我看你写的功能池太笼统了，就拿这个批量的逻辑，你写了“打勾的不变，没打勾的重新生成”，事实不是这样啊。钩都有两种呢。只在卡片组打勾下什么？只在图片组打勾选了一张图下什么？，图片也钩了，卡片组也勾了下载什么？怎么下载？打包耗时一张一张下载？你都没有明确，但是我的原文都说清了。务必存档，梳理清逻辑再开工。
```
# 2026-01-30 01:10 rc-3 / rc-4 需求补充（原话归档）

```
rc-3 
1. 完成jimeng-sora2的改写，按照上方的规划“最重点修复：Jimeng 文生视频失败 / Sora2 图生视频失败（3.8.3-rc2）”修复措施执行
2. 模型库折叠状态做到能够保存
3. 删除flux / modelscope / vibecoding 作为默认模型
4. 验证失败，历史缓存还是重新下载了（并新增：启用缓存是否重新下载作为配置项，默认 false）
5. 保存资产保存的文档只有27kb，资产保存应该是错误的；修复
输出rc-3的html

rc-4
按照模型库新规划实现
```

---

# 2026-01-30 06:40 rc-3 黑屏问题补充（原话归档）

```
rc3依旧黑屏
ReferenceError: can't access lexical declaration 'td' before initialization
```

---

# 2026-02-01 生成物请求（原话归档）

```
先就在这个版本上生成html，我先看看吧
```
