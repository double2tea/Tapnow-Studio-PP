# Tapnow Studio 功能池与待办事项

> **最后更新**: 2026-02-06 07:58
> **当前版本**: V3.8.5
> 
> ⚠️ **重要规则**: 本文档只可添加，不可删除。完成后可标记 ~~划线~~，归档后用户确认才能移除。

---

> **分支修复更新**: 2026-01-12
> **分支版本**: V3.7.33fix / V3.7.33fp (已合并到 V3.7.34)

---

## 📌 流程约束

- 每次结束必须运行 `scripts/finish_task.ps1` 并更新文档（遵循 `codex.md`）

## 🔴 待修复 Bug (高优先级)

| Bug | 描述 | 优先级 | 来源 |
|-----|------|--------|------|
| **批量下载卡死** | 批量下载进度完成后长时间无下载按钮/无响应 | P1 | 2026-02-05 |
| **分镜批量无返图** | 智能分镜批量生成无返图（jimeng-api/antigravity），超时后才跳批次（仍复现：2026-02-06 反馈；出现“无法 timeout/无法返图”回退版本再修；shotId 匹配已收敛为更严格 token/数值比较） | P0 | 2026-02-06 |
| ~~**项目打包保存失败**~~ | ~~保存资产包提示 storage quota（暂时验收：2026-02-06 rc-5）~~ | P1 | 2026-02-06 |
| **LocalImageManager 保存报错** | IndexedDB 事务报错：The database connection is closing（新增：2026-02-06） | P1 | 2026-02-06 |
| ~~**缓存代理 403 刷屏**~~ | ~~开启本地缓存后，代理拉取 Comfy 输出持续 403 刷屏（已验收：2026-02-06）~~ | P0 | 2026-02-05 |
| ~~**Base64/Invalid URL 仍复现**~~ | ~~history/lightbox 仍出现 data:image... ERR_INVALID_URL（antigravity base64 已验收：2026-02-06）~~ | P0 | 2026-02-05 |
| ~~**自定义参数下拉缩回**~~ | ~~自定义参数下拉框点击后自动缩回，无法选择（已验收：2026-02-06）~~ | P1 | 2026-02-06 |
| **Lightbox 跳跃复现** | 刷新后正常，滚动/污染后开始跳跃（疑似失败/裂图历史项影响，持续排查） | P1 | 2026-02-06 |
| **网格点显隐** | 颗粒效果可接受；光晕缩小 30%，浅色点 RGB(212,212,216)，黑色点 RGB(36,36,39) | P2 | 2026-02-06 |
| **下载进度显示** | 2 个任务不应显示 66%/2/3；完成直接 100%，不将保存当占位 | P2 | 2026-02-06 |
| ~~**历史保存上限配置**~~ | ~~历史上限翻倍并可配置（已暂时验收：2026-02-06 rc-5）~~ | P2 | 2026-02-06 |
| **历史上限 90% 提醒** | 未超 90% 时需立刻消除 toast（2026-02-06 rc-4 继续反馈） | P2 | 2026-02-06 |
| **历史上限输入延迟** | 输入上限值需 1s 防抖，错误提示持续 5 分钟，输入正确需立即消除 | P2 | 2026-02-06 |
| **历史面板吸顶** | “本地缓存设置/队列”展开后滚动仍固定顶部 | P2 | 2026-02-06 |
| **历史面板计数/进度条** | 进度条置于缓存提示条上方整行；显示格式仅 “xx/XX%”；完成后保留 10 秒 | P2 | 2026-02-06 |
| **智能看板新增锁定** | 新增镜头默认锁定勾选需取消 | P2 | 2026-02-06 |
| **模型显示缺少 Provider** | 图片生成处未显示“供应商 / 模型ID”（已修复待验证） | P2 | 2026-02-02 |
| **BizyAir 空参数失败** | BizyAir 工作流 input_values 空参产生 "null" 字符串导致失败（已修复待验证） | P1 | 2026-02-02 |
| **Jimeng 文生/图生视频失败** | jimeng video 3 文生失败、jimeng sora2 图生失败（对比 3.8.0 差异修复） | P0 | 2026-01-29 |
| **黑屏（模型库折叠状态 TDZ）** | 模型库折叠状态在初始化前被引用导致黑屏 | P0 | 2026-01-30 |
| **历史键盘跳组** | 生成历史上下键切换会跳过大量组别 | P1 | 2026-01-30 |
| **灯箱预览切换异常** | 预览切换出现 1/3、2/4 或重复图 | P1 | 2026-01-30 |
| **灯箱历史导航报错** | Lightbox 历史上下切换触发 ReferenceError: findHistoryNavIndex is not defined（已修复待验证） | P1 | 2026-02-01 |
| **资产导入刷新裂图** | 导入资产后刷新出现 blob:null/图片裂图，需持久化与原始 URL 兜底（修复中） | P0 | 2026-02-01 |
| **导入刷新空白** | 导入完成后刷新页面节点全空白，需要立即持久化与恢复 | P0 | 2026-02-02 |
| **历史刷新空白** | 刷新后生成历史为空白，画布内容仍在 | P0 | 2026-02-02 |
| **历史/批量素材 blob:null** | 生成历史/批量素材预览加载 blob:null，需 fallback 有效 URL | P0 | 2026-02-02 |
| **历史无法打开** | 历史卡片可见但无法打开预览，图片异常 | P0 | 2026-02-02 |
| **资产包刷新图/视频失效** | 导入资产包后刷新历史图片/视频不显示（asset:// 映射丢失/Blob 失效） | P0 | 2026-02-02 |
| **画布资产显示失败** | 画布节点图片/视频无法显示（asset bundle / img_id 解析缺失） | P0 | 2026-02-02 |
| **缓存关闭仍读取** | 关闭本地缓存仍读取本地缓存 URL | P0 | 2026-02-02 |
| **新建清空项目入口** | 项目名旁新增“+”新建清空入口，避免旧资产污染（已补入口待验证） | P1 | 2026-02-01 |
| **新建空项目黑屏** | 新建空项目触发黑屏（view 为空） | P0 | 2026-02-02 |
| **黑屏 TDZ 报错** | 构建后仍出现 lexical declaration before initialization（需运行时烟测阻断） | P0 | 2026-02-02 |
| **缓存启用重下载开关** | 启用缓存是否重新下载作为配置项（默认 false） | P1 | 2026-01-30 |
| ~~**项目保存资产过小**~~ | ~~保存项目文件未包含历史资源（文件仅几十 KB）~~ | P1 | 2026-01-30 |
| ~~**模型库折叠状态保存**~~ | ~~导出/导入与本地持久化需保留折叠状态~~ | P1 | 2026-01-30 |
| ~~**默认模型清理**~~ | ~~移除 flux / modelscope / vibecoding 作为默认模型~~ | P2 | 2026-01-30 |

## 规划与方案
| 需求 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| **多图并发策略** | ModelScope/NanoBanana/Gemini-3-Pro-Image 多图并发接入与测试方案（批量并发 + API 多图） | P1 | 规划中 |
| **资产打包导出** | 导出 ZIP 资产包（含图片/视频）并支持拖拽导入恢复 | P1 | 规划中 |
| **黑屏防护与自动检测** | 启动护栏 + 自动化黑屏检测脚本 | P0 | 规划中 |

## 3.8.4 主要落实（新增）
| 需求 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| **多并发绘图** | 多图并发策略落地（批量并发 + API 多图可选） | P1 | 待落实 |
| **本地 ComfyUI + RunningHub 接入** | Local Middleware 与 RunningHub 统一接入，复用 asyncConfig（服务端已落地 + 测试文档已输出，前端待联调） | P1 | 进行中 |
| **工作流模板助手** | workflows 目录批量重命名 template.json + 生成 meta.json | P2 | 已落实 |

## 请求模板规划 (模型库)
| 需求 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| **模型库请求模板** | 模型库可定制 endpoint/headers/body/bodyType（核心已落地，待补齐 query/files/timeout/responseParser/Provider override） | P1 | 部分落地 |
| **请求预览与覆盖** | 最终请求预览 + 用户修改覆盖（核心已落地，待补齐 query/files/timeout/responseParser） | P1 | 部分落地 |
| ~~**模型库提示名未持久化**~~ | ~~默认参数提示名状态导出/导入丢失（需保存 ratio/resolution/duration/videoResolution）~~ | P1 | 2026-01-27 |
| ~~**生成历史提示名显示**~~ | ~~启用提示名后历史仅显示提示名（含自定义参数）~~ | P2 | 2026-01-27 |
| **自动缓存/刷新失效** | 刷新缓存未触发重新缓存，自动缓存未生效（已调整刷新逻辑，待验证） | P0 | 2026-01-27 |
| ~~**ModelScope 引用报错**~~ | ~~ModelScope 图片作参考图给 Jimeng 报 permission denied(3018)~~ | P0 | 2026-01-27 |
| ~~**黑屏（summary 未定义）**~~ | ~~刷新缓存日志导致 ReferenceError: summary is not defined~~ | P0 | 2026-01-27 |
| ~~**Base64 初次载入报错**~~ | ~~初次载入画布报 Invalid base64 payload~~ | P1 | 2026-01-27 |
| ~~**模型库备注未映射**~~ | ~~分辨率/比例/时长备注未在前端选项显示（需统一映射规则）~~ | P1 | 2026-01-27 |
| ~~**代理图片跨域**~~ | ~~代理来源图片作为参考图/保存到本地仍触发 CORS~~ | P0 | 2026-01-27 |
| **保存节点代理 CORS** | 保存到本地节点遇到代理图片仍报 CORS/无可保存文件 | P0 | 2026-01-28 |
| **历史拖拽未用本地缓存** | 生成历史拖拽到画布仍用原链接；已调整拖拽解析本地优先，待验证 | P0 | 2026-01-28 |
| **视频生成 URL 无效** | 视频生成请求 URL 含空格导致 fetch invalid URL，文生/图生视频失败 | P0 | 2026-01-28 |
| ~~**自动缓存未触发**~~ | ~~本地缓存开关开启后未自动写入，需确保走代理与自动触发链路~~ | P0 | 2026-01-27 |
| ~~**队列不透明**~~ | ~~没有显性队列管理，无法手动终止~~ | P0 | V3.7.29 |
| ~~**分镜弹窗遮挡**~~ | ~~下载/队列下拉被节点裁切~~ | P0 | 2026-01-16 |
| ~~**历史预览小图/报错**~~ | ~~历史/批量素材预览出现小图、切换卡顿与报错，已修复待验证~~ | P0 | 2026-01-16 |
| ~~**历史默认性能模式**~~ | ~~默认不应开启任何性能模式~~ | P1 | 2026-01-16 |
| ~~**历史标题两行**~~ | ~~生成历史标题两行显示、按钮更紧凑~~ | P2 | 2026-01-16 |
| ~~**分镜空白点击新增**~~ | ~~分镜为空时点击空白区域可新建镜头~~ | P1 | 2026-01-16 |
| ~~**分镜右侧按钮居中**~~ | ~~右侧按钮列继续右移居中~~ | P2 | 2026-01-16 |
| ~~**重建缩略图按钮可见**~~ | ~~历史条目“重建缩略图”入口更醒目~~ | P2 | 2026-01-16 |
| ~~**历史缩略图批量重建**~~ | ~~本地缓存面板新增“全部重建历史缩略图”按钮~~ | P2 | 2026-01-16 |
| ~~**分镜多图参考上限+1**~~ | ~~图片模式多图参考位支持额外 1 张~~ | P2 | 2026-01-16 |
| ~~**历史模型名显示为 Provider**~~ | ~~历史卡片显示 Provider 而非模型名~~ | P2 | 2026-01-16 |
| ~~**智能发送子菜单悬停展开**~~ | ~~悬停折叠按钮自动展开（已修复待验证）~~ | P2 | 2026-01-16 |
| ~~**智能发送菜单宽度自适应**~~ | ~~菜单宽度按最长文案收缩（已修复待验证）~~| P3 | 2026-01-16 |
| ~~**智能发送节点识别不足**~~ | ~~视频拆解/AI绘图/AI视频/图像对比/聊天识别与自动接入（已修复待验证）~~ | P1 | 2026-01-16 |
| ~~**智能发送子菜单关闭延迟**~~ | ~~子菜单离开后应立即关闭（理解偏差）~~ | P3 | 2026-01-17 |
| ~~**智能发送子菜单延迟关闭**~~ | ~~子菜单离开后延迟 1 秒关闭（已修复待验证）~~ | P3 | 2026-01-17 |
| ~~**智能发送子菜单顺序**~~ | ~~子菜单顺序调整为 聊天/预览/画布（已修复待验证）~~ | P3 | 2026-01-17 |
| ~~**拖放自动连线扩展**~~ | ~~拖放到图像对比/AI绘图/AI视频自动补输入节点并连线（已修复待验证）~~ | P1 | 2026-01-17 |
| ~~**聊天拖放附件**~~ | ~~拖放图片到聊天面板即添加为附件（已修复待验证）~~ | P2 | 2026-01-17 |
| ~~**ModelScope CORS**~~ | ~~Z-Image 直连官方域名时 CORS 被阻断，已支持本地代理 `/proxy`（待验证）~~ | P1 | 2026-01-17 |
| ~~**历史缺图占位样式**~~ | ~~MJ 四宫格缺图显示“图片1/2/3/4”居中 + 亮色浅灰底（已修复待验证）~~ | P2 | 2026-01-17 |
| **本地缓存路径判定** | save_path 相同则走 `.tapnow_cache`，自定义路径走 `history`（已修复待验证） | P1 | 2026-01-18 |
| ~~**缓存路径写回/rel_path**~~ | ~~浏览路径未生效与 `/file/` 访问失败，修复 raw 路径判定与 rel_path 基准（待验证）~~ | P1 | 2026-01-24 |
| ~~**本地代理开关**~~ | ~~增加“启用本地代理”开关，外部 API 走本地 `/proxy`（已修复待验证）~~ | P1 | 2026-01-18 |
| ~~**Gemini 回包解析失败**~~ | ~~Gemini 3 Pro Image Preview 能发不能收，回包未解析出图片（已修复待验证）~~ | P0 | 2026-01-19 |
| ~~**Z-Image 缓存跨域**~~ | ~~Z-Image 图片跨域缓存失败，需要本地代理转存（已修复待验证）~~ | P1 | 2026-01-19 |
| ~~**模型列表新增异常**~~ | ~~新增模型后显示不全，模型 ID 输入仅能录入单字符（已修复待验证）~~ | P1 | 2026-01-19 |
| ~~**模型库字段标注**~~ | ~~显示名/系统模型 ID/接口类型需明确区分（已修复待验证）~~ | P2 | 2026-01-19 |
| ~~**模型库参数完善**~~ | ~~图片比例/分辨率、视频时长/分辨率配置需补齐（已修复待验证）~~ | P2 | 2026-01-19 |
| ~~**API 配置折叠结构**~~ | ~~除 API 备份/运行状态外其余配置折叠收纳（已修复待验证）~~ | P2 | 2026-01-19 |
| ~~**Gemini 图片显示异常**~~ | ~~Gemini 回包图片可打开但卡片预览空白，需要本地代理/缓存修复（已修复待验证）~~ | P0 | 2026-01-19 |
| ~~**接口与模型列表常驻**~~ | ~~接口与模型列表不再折叠，直接展示（已修复待验证）~~ | P2 | 2026-01-19 |
| ~~**模型库条目折叠**~~ | ~~模型库条目支持单项折叠与全局折叠/展开（已修复待验证）~~ | P2 | 2026-01-19 |
| ~~**视频模型比例参数**~~ | ~~模型库视频模型新增比例配置（已修复待验证）~~| P2 | 2026-01-19 |
| ~~**历史滚动条亮色**~~ | ~~生成历史面板滚动条滑块在亮色模式改浅灰（已修复待验证）~~ | P2 | 2026-01-19 |
| ~~**历史缩略图亮色底板**~~ | ~~历史缩略图底板亮色改浅灰，提示文字深灰居中且指定字体（已修复待验证）~~ | P2 | 2026-01-19 |
| ~~**主题命名统一**~~ | ~~亮光/日光/暗光名称与当前主题匹配（已修复待验证）~~ | P2 | 2026-01-20 |
| ~~**Solarized 配色层级**~~ | ~~深色1/2 + 浅色1/2 映射，节点底色与灰区同步（已修复待验证）~~ | P2 | 2026-01-20 |
| ~~**Solarized 暖色细节**~~ | ~~聊天/设置按钮色值、画布空白与边框、资产说明文字黑色（已修复待验证）~~ | P2 | 2026-01-20 |
| ~~**Solarized 菜单与按钮**~~ | ~~右上角按钮 97,97,97；设置菜单背景 238,232,213；节点内层底色校准（已修复待验证）~~ | P2 | 2026-01-20 |
| ~~**Solarized 节点与历史**~~ | ~~节点边框/内层色值、历史卡片说明板块与间隙底色回归（已修复待验证）~~ | P2 | 2026-01-21 |
| ~~**智能分镜节点色块**~~ | ~~智能分镜节点上下色块统一浅色，边框保持深黄（已修复待验证）~~ | P2 | 2026-01-21 |
| ~~**API 模型条目浅色**~~ | ~~API 配置模型条目与模型库条目色块改浅色、边框保持深黄（已修复待验证）~~ | P2 | 2026-01-21 |
| ~~**队列按钮空白**~~ | ~~点击队列按钮页面空白，队列分组数据缺失（已修复待验证）~~ | P0 | 2026-01-21 |
| ~~**Solarized 节点深浅层级**~~ | ~~节点边框加深、智能分镜头尾深黄/内部浅黄、小说节点内层浅黄（已修复待验证）~~ | P2 | 2026-01-21 |
| ~~**Solarized 蓝绿按钮深灰**~~ | ~~蓝色/绿色按钮统一深灰（已修复待验证）~~ | P2 | 2026-01-21 |
| ~~**模型库默认折叠**~~ | ~~模型库条目默认折叠，类型标签显示在名称旁（已修复待验证）~~ | P2 | 2026-01-21 |
| ~~**模型库自定义参数**~~ | ~~自定义参数覆盖/预览 + ChatImage 类型 + 参数同步（已修复待验证）~~ | P1 | 2026-01-21 |
| ~~**模型库引用隔离**~~ | ~~未引用模型库的同名模型不受影响（已修复待验证）~~ | P1 | 2026-01-21 |
| ~~**视频模型首尾帧/HD**~~ | ~~模型库/AI视频/分镜增加首尾帧与HD开关联动（已修复待验证）~~ | P1 | 2026-01-20 |
| **首尾帧连接点对齐** | 首/尾帧输入点与连线对齐（已修复待验证） | P2 | 2026-01-20 |
| ~~**自动保存配额溢出**~~ | ~~AutoSave 写入 localStorage 超限导致保存失败（已修复待验证）~~ | P0 | 2026-01-20 |
| ~~**本地缓存提示条开关**~~ | ~~历史面板提示条需要关闭按钮与设置开关~~| P2 | 2026-01-20 |
| ~~**本地缓存提示条形态**~~ | ~~顶部通知条样式与开关语义纠偏、离线红条自动隐藏（已修复待验证）~~| P2 | 2026-01-21 |
| ~~**新生图未写入缓存**~~ | ~~新生成图片未落本地缓存~~ | P1 | 2026-01-20 |
| **缓存目录判定** | history vs .tapnow_cache 路径判定混乱 | P1 | 2026-01-20 |
| **Jimeng 蒙版/1002** | 图生图蒙版不生效、1002/1000 错误排查 | P0 | 2026-01-20 |
| ~~**Z-Image/Qwen CORS**~~ | ~~图生图引用远程图片 CORS 阻断~~ | P1 | 2026-01-20 |
| **聊天生图资产回填** | Chat 生成图片需要进入历史/资产 | P2 | 2026-01-20 |
| ~~**视频/分镜参数同步**~~ | ~~模型库参数未同步到 AI 视频与智能分镜~~ | P1 | 2026-01-20 |
| ~~**画布网格点缺失**~~ | ~~网格点不随缩放/不够明显，需按原版随缩放与平移联动~~ | P2 | 2026-01-22 |
| ~~**Solarized 节点外框/内层分层**~~ | ~~节点外框深黄、内层浅黄，模型选择/参数框用浅黄（已修复待验证）~~ | P2 | 2026-01-22 |
| ~~**模型库参数污染**~~ | ~~未引用模型库的同名模型仍被库参数污染（已验证）~~ | P0 | 2026-01-22 |
| ~~**模型库同名模型覆盖**~~ | ~~同名模型库条目无法并存，系统仅识别最后创建项（已验证）~~ | P0 | 2026-01-22 |
| ~~**模型名增殖**~~ | ~~模型名称悬停/移动时重复追加显示（已验证）~~ | P2 | 2026-01-22 |
| ~~**本地缓存错图**~~ | ~~启用缓存后历史图片被旧缓存替换，history/.tapnow_cache 混用（已修复待验证）~~ | P0 | 2026-01-22 |
| ~~**本地缓存报错刷屏**~~ | ~~Base64/代理缓存拉取失败导致控制台高频报错（已修复待验证）~~ | P0 | 2026-01-22 |
| ~~**缓存保存路径浏览失效**~~ | ~~浏览选择图片/视频保存路径后未生效，输入框需联动更新（已修复待验证）~~ | P1 | 2026-01-22 |
| ~~**缩略图重建报错**~~ | ~~data:image... ERR_INVALID_URL + 部分远端 404（已修复待验证）~~ | P1 | 2026-01-22 |
| ~~**历史存储配额超限**~~ | ~~tapnow_history 超出 localStorage 配额导致保存失败（已缓解待验证）~~ | P1 | 2026-01-22 |
| ~~**模型库标签对齐/样式**~~ | ~~模型库类型标签右对齐，模型数标签样式需对齐（已验证）~~ | P3 | 2026-01-22 |
| ~~**开关关闭态对比**~~ | ~~黄色主题关闭态开关对比度不足~~ | P3 | 2026-01-22 |
| ~~**预览窗口浅黄底色**~~ | ~~预览窗口图片展示区改浅黄，选择图片按钮深灰，分镜预览底色交替（已修复待验证）~~ | P2 | 2026-01-23 |
| ~~**Solarized 选项按钮去灰**~~ | ~~AI 绘图/视频/分镜底部选项按钮改为黄色系（已修复待验证）~~ | P2 | 2026-01-23 |
| ~~**黑屏报错 $s**~~ | ~~首屏报错 Cannot access '$s' before initialization，页面黑屏（已修复待验证）~~ | P0 | 2026-01-23 |
| ~~**模型库参数扩展**~~ | ~~参数值上限 30、备注启用复选框、预览 JSON 编辑 + 修改覆盖（已修复待验证）~~ | P1 | 2026-01-23 |
| ~~**参数值重命名显示**~~ | ~~参数值可配置显示名（如 `1024x1024(1:1)`），仅影响展示（待验证）~~ | P2 | 2026-01-24 |
| ~~**模型名显示限制**~~ | ~~历史卡片模型名限制 15 字节，悬浮提示改为 provider（已修复待验证）~~ | P2 | 2026-01-23 |
| ~~**缓存代理策略**~~ | ~~缓存拉取仅在 provider 启用代理时走 /proxy（已修复待验证）~~ | P1 | 2026-01-23 |
| ~~**Base64/ERR_INVALID_URL**~~ | ~~data URL 规范化 + data URL 缓存拉取修复（已修复待验证）~~ | P0 | 2026-01-23 |
| ~~**浏览选择路径生效**~~ | ~~选择保存路径后写入并重建缓存生效（已修复待验证）~~ | P1 | 2026-01-23 |
| ~~**AutoSave 存储优先**~~ | ~~自动保存优先 IndexedDB，避免 localStorage 配额溢出（已修复待验证）~~ | P0 | 2026-01-23 |
| ~~**缓存问题梳理文档**~~ | ~~缓存/代理/Base64/保存路径问题梳理输出 MD（已更新待复查）~~ | P2 | 2026-01-23 |
| ~~**本地保存/下载代理**~~ | ~~保存到本地/单项/批量/预览下载按 provider 代理开关走 /proxy（已修复待验证）~~ | P1 | 2026-01-26 |
| ~~**自动缓存触发**~~ | ~~新路径启用后自动缓存重触发（已修复待验证）~~ | P1 | 2026-01-26 |
| ~~**默认分辨率显示名**~~ | ~~分辨率等默认值支持自定义显示名（仅展示）~~ | P2 | 2026-01-26 |
| ~~**比例/时长提示命名**~~ | ~~图片/视频比例与视频时长支持提示命名，提示区可折叠（已修复待验证）~~ | P2 | 2026-01-27 |
| ~~**统一资源获取渠道**~~ | ~~缩略图重建/下载/引用走统一获取通道（代理/本地/直连一致）（已修复待验证）~~ | P0 | 2026-01-28 |

---

## 优先级重排（2026-01-15）
- ~~**P0**：队列可视化/手动终止；批量覆盖提示与线程逻辑完善（详见 `docs/batch_logic_spec.md`）~~
- ~~**P1**：下载功能；UI 布局需求（折叠按钮定位/预览窗口加宽）；局部重绘笔触改圆形；智能分镜主卡片按钮；智能分镜拖放~~
- **P2**：小说拆分整合智能分镜；视频输入首尾帧/多参考图导入；历史提示词发送
- **P3**：角色/环境库扩展与创建角色节点串联；自定义节点能力；API 余额预判/黑名单重置/超时停止；模块拆分与节点置顶等长期项


## ?? 工程化 / 工作流改进 (2026-01-18)

| 事项 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| ~~**阶段二脚本化**~~ | ~~增加 `scripts/finish_task.ps1` / `scripts/preflight.ps1` 以支撑收尾自动化~~ | P1 | 已实现 (待验证) |
| ~~**主题对比构建**~~ | ~~从最早 Solarized 配色备份导出 `test.html` 用于对比~~ | P3 | 已完成 (待对比) |
| ~~**提交 Hook 强制**~~ | ~~`.githooks/pre-commit` 强制检查 finish_task 运行~~ | P1 | 已实现 (待验证) |
| ~~**AG_STATE 占位符**~~ | ~~自动状态块占位符，脚本写入~~ | P2 | 已实现 (待验证) |
| **轻量看板** | `kanban.json` 作为脚本可读写看板 | P2 | 已实现 (待验证) |
| ~~**短期记忆规则**~~ | ~~每次对话需读取 AG_STATE 短期记忆并执行备份/文档/finish_task~~ | P0 | 执行中 |
| ~~**构建产物保留**~~ | ~~build 不清空 dist，补回 rc4 构建物并保留历史版本~~ | P1 | 已实现 (待验证) |

## 🟠 未来功能需求 (按来源时间排序)

### 原始需求补录 (2026-01-14)
| 需求 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| **历史提示词发送** | 右键菜单将历史提示词发送到激活节点/镜头/脚本；无激活则复制到剪贴板 | P2 | 待开发 (P2) |
| **视频输入首尾帧/多参考图导入** | 视频输入支持首尾帧与多参考图导入，导入落位随激活卡片/首尾帧选项 | P2 | 待开发 (P2) |
| **小说拆分整合智能分镜** | 字数统计一致；按钮命名调整（LLM拆脚本/LLM拆小说/LLM自定义）；说明文案与提示词编辑内嵌 | P2 | 待规划 (P2) |
| **角色/环境库扩展** | 新增通用角色库/环境库（图片为主），创建角色节点支持创建图片，左侧库 UI 设计 | P3 | 待规划 (P3) |
| **创建角色节点串联** | 创建角色节点可与 AI 视频节点及智能分镜串联 | P3 | 待评估 (P3) |

### 历史拖拽与发送菜单整合 (2026-01-16)
| 需求 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| ~~**历史拖拽扩展**~~ | ~~历史资产可拖拽到图片输入/视频输入/关键帧/预览；拖到画布空白则生成对应输入节点~~ | P2 | 已实现 (待验证) |
| ~~**发送到菜单整合**~~ | ~~历史右键统一“发送到”菜单，智能识别目标（激活节点/分镜/预览/画布/聊天）~~ | P2 | 已实现 (待验证) |

### 新增 API 接入规划 (2026-01-17)
| 需求 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| ~~**ModelScope Z-Image 接入**~~ | ~~新增 Z-Image 图像生成接入（异步 + 任务轮询）~~ | P1 | 已实现 (待验证) |
| ~~**Gemini 3 Pro Image Preview 接入**~~ | ~~新增 `gemini-3-pro-image-preview` 图像生成接入~~ | P1 | 已实现 (待验证) |
| **Sora2 接入** | Yunwu/Vibecoding NewAPI Sora2 视频接入（文档已提供） | P2 | 待接入 (rc4) |
| **直链 CORS 检测** | 检查 vibecodingapi.ai 与 yunwu.ai 直链 CORS 结果 | P2 | 待确认 |

> 详情参见 `docs/modelscope_zimage_knowhow.md`

### API 配置与模型列表 UI 规划 (2026-01-17)
| 需求 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| **API 配置分层 UI** | 基于现有 API 设置面板，加入“基础配置/模型列表/高级代理”的分层入口 | P2 | 待规划 |
| **模型分组视图** | 复用当前 Provider 折叠结构，补充“常用模型/实验模型”标签 | P3 | 待规划 |

### API 配置与模型库 UI 落地 (2026-01-19)
| 需求 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| ~~**模型库标签页**~~ | ~~新增“模型库”用于维护模型名/显示名/能力/限制~~ | P1 | 已实现 (待验证) |
| ~~**Provider 级配置**~~ | ~~Provider 级配置接口类型/本地代理/异步模式~~ | P1 | 已实现 (待验证) |
| ~~**模型库引用**~~ | ~~Provider 模型可下拉选择引用模型库模型~~ | P1 | 已实现 (待验证) |
| ~~**设置折叠菜单**~~ | ~~除 API 备份/运行状态区外其余内容折叠~~ | P2 | 已实现 (待验证) |

### 主题与项目保存 (2026-01-19)
| 需求 | 描述 | 优先级 | 状态 |
|------|------|--------|------|
| ~~**主题随项目保存**~~ | ~~项目保存/加载包含主题（暗色/亮色/Solarized Light）~~ | P1 | 已实现 (待验证) |
| ~~**模型库随项目保存**~~ | ~~项目保存/加载包含模型库配置~~ | P1 | 已实现 (待验证) |
| ~~**Solarized Light 主题**~~ | ~~新增黄色基调 Solarized Light 主题配色~~ | P2 | 已实现 (待验证) |

### Antigravity 生图接入规划 (2026-01-11)
| 需求 | 描述 | 状态 |
|------|------|------|
| **Antigravity 图像参数适配** | Antigravity-Manager 接入与参数映射规划，详情参见 `docs/antigravity_image_plan.md` | 待评估 (P3) |
| **Antigravity Chat 生图接入** | Chat/Images 双路径 + size/quality 映射规划，详见 `docs/improve/antigravity_v3.8.2_plan.md` | 规划中 (3.8.2) |

### 智能分镜模块拆分方案 (2026-01-10)
| 需求 | 描述 | 状态 |
|------|------|------|
| **图/视频分镜隔离** | 分镜数据拆分与耦合点分析，详情参见 `docs/storyboard_module_plans.md` | 待评估 (P3) |

### 节点层级置顶方案 (2026-01-10)
| 需求 | 描述 | 状态 |
|------|------|------|
| **当前操作节点置顶显示** | 只读方案，详见 `docs/node_layering_topmost_plan.md` | 待评估 (P3) |


### 下载功能 (2026-01-09 06:39)
| 需求 | 描述 | 状态 |
|------|------|------|
| ~~**批量下载按钮**~~ | ~~下拉框两个选项：全部下载 / 选中下载~~ | 已实现 (待验证) |
| ~~**全部下载**~~ | ~~按 节点名+镜头序号+图片序号.jpg 命名，打包 zip 下载~~ | 已实现 (待验证) |
| ~~**选中下载逻辑**~~ | ~~灰框勾选+图片未勾选=下载4张；灰框+图片勾选=下载1张；仅图片勾选=下载1张~~ | 已验证 |
| ~~**单张右键下载**~~ | ~~右键点击图片跳出菜单单张下载~~ | ✅ V3.7.29 |

### UI 布局需求 (2026-01-09 06:29)
| 需求 | 描述 | 状态 |
|------|------|------|
| ~~**折叠按钮定位**~~ | ~~折叠时定位在最右，展开时和右边线保持一个拓展窗口的宽度~~ | 已实现 (待验证) |
| ~~**预览窗口加宽**~~ | ~~加宽33%左右，和左边图片预览的默认宽度相同~~ | 已实现 (待验证) |
| ~~**拆分脚本滚屏**~~ | ~~输入框输入太长无法滚屏，增加鼠标滚轮滚动~~ | ✅ V3.7.27 |

### 局部重绘需求 (2026-01-09 06:29)
| 需求 | 描述 | 状态 |
|------|------|------|
| ~~**笔刷粗度增加**~~ | ~~从 10-100px 加到 150px~~ | ✅ V3.7.27 |
| ~~**笔触改圆形**~~ | ~~笔触希望是圆形而不是方形~~ | 已实现 (待验证) |
| ~~**拖动断线问题**~~ | ~~快速拖动变成点点点~~ | ✅ V3.7.27 |
| ~~**工具条不显示**~~ | ~~局部重绘操作条不见~~ | 已修复 (待验证) |

### 智能分镜主卡片需求 (2026-01-09 04:10)
| 需求 | 描述 | 状态 |
|------|------|------|
| ~~**重新设计右侧按钮**~~ | ~~承载功能：时间显示、删除按钮、生图按钮、上下调整按钮~~ | 已实现 (待验证) |
| ~~**时间显示**~~ | ~~比照AI生图模块，需要实时时间显示~~ | ✅ V3.7.33 |
| ~~**删除按钮避免误操作**~~ | ~~放在不常用地方~~ | 已实现 (待验证) |
| ~~**图标居中与放大**~~ | ~~右侧按钮居中对齐并适度放大~~ | 已修复 (待验证) |
| ~~**右侧空隙收紧**~~ | ~~右侧按钮区宽度收紧，分隔栏整体右移~~ | 已修复 (待验证) |

### 智能分镜拖放需求 (2026-01-09 04:10)
| 需求 | 描述 | 状态 |
|------|------|------|
| ~~**图片拖入分镜**~~ | ~~支持本地图片、左侧资产图片、画布图片拖入卡片~~ | 已实现 (待验证) |

### 拖拽线生成节点需求 (2026-01-09 09:26)
| 需求 | 描述 | 状态 |
|------|------|------|
| **连接处生成节点** | 以节点的连接处生成节点，而不是以鼠标松开点为中心 | 待开发 (P2) |

### 批量生成逻辑需求 (2026-01-09 04:50)
| 需求 | 描述 | 状态 |
|------|------|------|
| ~~**灰框勾选不参与批量**~~ | ~~勾选了预览输出（灰框）的卡片不参与批量生成~~ | ✅ 已修复 |
| ~~**默认线程数1**~~ | ~~默认批量线程数调整到1，带记忆功能~~ | ✅ |
| ~~**覆盖提示**~~ | ~~"继续批量生成会覆盖原有输出但是资产在左侧可以查看"~~ | 已实现 (待验证) |

> 详情参见 `docs/batch_logic_spec.md`

### 右键菜单需求 (2026-01-10)
| 需求 | 描述 | 状态 |
|------|------|------|
| ~~**智能分镜输出预览右键**~~ | ~~下载放第一，预览放第二~~ | 待开发 (P2) |

### API 相关需求 (2026-01-10)
| 需求 | 描述 | 状态 |
|------|------|------|
| **积分预判可用性** | 调用前通过余额过滤账号 | 待开发 (P3) |
| **黑名单自动重置** | 每日0点自动清空黑名单 | 待开发 (P3) |
| **转圈超时强制停止** | 最多60s不管成功失败必须停止 | 待开发 (P3) |

### 自定义节点能力 (2026-01-10)
| 需求 | 描述 | 状态 |
|------|------|------|
| **自定义节点注册与渲染** | 在现有架构内支持编译期注册的自定义节点能力，详情参见 `docs/custom_node_plan.md` | 待规划 (P3) |

### 1006 错误探索 (2026-01-09 03:40)
| 发现 | 描述 |
|------|------|
| **a** | 使用生图发现大部分的1006出现在图生图，而且是在智能分镜里面导致的 |
| **b** | 同样的模型和参数，在AI生图里使用前置节点生图正常，在智能分镜里报错1006 |

备注：已基本完成，后续以监控/回归为主。

> 详情参见 `docs/jimeng_proxy_analysis.md`

---

## 📋 V3.8 待办事项

1. ~~**修复锁定镜头仍触发任务**（已完成，见 V3.7.30 归档）~~
2. ~~**修复键盘导航首次无效**（已完成，见 V3.7.30 归档）~~
3. ~~**移除调试日志**（已完成，见 V3.7.30 归档）~~
4. ~~**队列可视化/手动终止（P0）**（待验证，新增全局队列与单项删除）~~
5. ~~**批量覆盖提示与线程逻辑完善（P0）**（覆盖提示已完成，线程逻辑待优化）~~
6. ~~**批量下载（全部/选中/命名 ZIP）（P1）**（待验证）~~
7. ~~**折叠按钮定位（P1）**（待验证）~~
8. ~~**预览窗口加宽（P1）**（待验证）~~
9. ~~**笔触改圆形（P1）**（待验证）~~
10. ~~**智能分镜主卡片右侧按钮与删除防误触（P1）**（待验证）~~
11. ~~**智能分镜拖放图片入分镜（P1）**（待验证）~~
12. **小说拆分整合智能分镜（P2，转下版）**
13. **视频输入首尾帧/多参考图导入（P2，转下版）**
14. **历史提示词发送（P2，转下版）**
15. **角色/环境库扩展与创建角色节点串联（P3，转下版）**
16. ~~**全局队列下拉面板（P1）**（已修复，待验证）~~
17. ~~**队列模式开关（P2）**（已修复，待验证）~~
18. ~~**历史预览小图/报错（P0）**（已修复，待验证）~~
19. ~~**性能模式默认关闭（P1）**（已修复，待验证）~~
20. ~~**历史缩略图重建按钮（P2）**（已修复，待验证）~~
21. ~~**历史标题两行（P2）**（已修复，待验证）~~
22. ~~**分镜空白点击新增（P1）**（已修复，待验证）~~

> 详见 `docs/v3_8_plan.md`

---

## 🟢 已完成功能归档


## V3.7.36c 修复完成 (批量素材管理修复 C)

| 问题/功能 | 合并内容 | 状态 |
|------|----------|------|
| **模型名称显示错误** | 批量素材卡片显示正确模型名并支持悬浮全名 | 已修复 |
| **多图预览** | 四图网格展示（MJ/多图输出） | 已修复 |
| **清理缓存按钮** | 批量清理本地缓存文件 | 已修复 |
| **参数信息同步** | 显示类型/模型/比例/分辨率/时长/时间/耗时（24h + 分钟制） | 已修复 |
| **视频时长记录** | 生成历史写入视频时长用于展示 | 已修复 |

## V3.7.36c 验收微调 (角色/场景描述与菜单样式)

| 问题/功能 | 合并内容 | 状态 |
|------|----------|------|
| **风格预设下拉** | 风格改为预设选择并自动更新提示词前缀 | 已修复 |
| **提示词过滤/场景优化** | 按原版系统提示词规范优化过滤逻辑 | 已修复 |
| **右键菜单子目录样式** | 子菜单右侧展开，样式对齐双层模型选择 | 已修复 |
| **36a 黑屏错误** | 修复 TDZ 顺序导致的初始化异常 | 已修复 |

## V3.7.36c 验收补丁 (缓存/保存与批量素材交互)

| 问题/功能 | 合并内容 | 状态 |
|------|----------|------|
| **生成节点模型双层选择** | 生成角色/场景图片与视频节点改为双层选择 | 已验证 |
| **保存文件命名** | 保存文件按“项目名-提示词-编号”命名 | 已验证 |
| **保存去重** | 本地保存同图去重，按子文件夹隔离查重 | 已验证 |
| **保存全部多图** | 多图缓存强制唯一 ID，避免只存首图 | 已验证 |
| **缓存目录判定** | 移除 .tapnow_cache 兼容，统一 history | 已验证 |
| **路径与浏览按钮** | 保存路径统一斜杠 + 增加浏览按钮 | 已验证 |
| **连接提示常显** | 本地缓存连接提示常驻且蓝色提示 | 已验证 |
| **批量素材交互** | 小图编号、后端缓存标记、双击预览/单击选中 | 已验证 |
| **按钮解耦** | 顶部性能模式与历史闪电按钮互不联动 | 已验证 |
| **下拉对齐** | 下拉菜单上对齐、上拉菜单下对齐，避免文字跳动 | 已验证 |
| **缓存去重** | 相同图片 URL 复用缓存避免重复下载 | 已验证 |
| **本地缓存回退** | 预览链路 localCache > thumbnail > original，Lightbox/历史兜底 | 已验证 |
| **本地缓存校验** | 本地文件缺失时清理“本地”标记与缓存映射 | 已验证 |
| **角色图片提示词** | 角色图片模式移除“说话”描述 | 已验证 |
| **角色/场景视频分辨率** | 增加分辨率选择（720/1080/不选） | 已验证 |
| **角色/场景视频时长** | Jimeng 时长强制 5/10s，避免 15s 报错 | 已验证 |

## V3.7.36b 修复完成 (本地缓存/保存修复 B)

| 问题/功能 | 合并内容 | 状态 |
|------|----------|------|
| **历史面板本地缓存菜单** | 新增折叠设置面板与连接状态提示 | 已修复 |
| **缓存路径配置** | 支持图片/视频保存路径写回本地服务 | 已修复 |
| **PNG 转 JPG 开关** | 历史缓存支持 PNG->JPG 切换（需 PIL） | 已修复 |
| **缓存刷新** | 一键清理缓存标记，重新写入本地路径 | 已修复 |
| **保存节点服务器地址** | 保存节点支持独立服务地址与测试 | 已修复 |

## V3.7.36a 修复完成 (本地缓存/保存修复 A)

| 问题/功能 | 合并内容 | 状态 |
|------|----------|------|
| **本地缓存失败** | 缓存文件名非法字符清理，避免 Windows 路径报错 | 已修复 |
| **缓存后缀错误** | 按真实资源类型识别扩展名（图片/视频） | 已修复 |
| **保存到本地节点** | 增加待保存预览 + 手动保存按钮 | 已修复 |
| **自动保存失效** | 自动保存改用 `/save-batch`，可正常写入 | 已修复 |
| **待保存刷新** | 上游更新时待保存列表实时刷新 | 已修复 |

## V3.7.35 合并完成 (V2.6.1 功能回补)

| 问题/功能 | 合并内容 | 状态 |
|------|----------|------|
| **本地缓存服务器** | 连接检测、历史/角色库自动缓存、本地缓存优先加载 | 已合并 |
| **保存到本地节点** | local-save 节点可用 + 自动保存流程恢复 | 已合并 |
| **小说输入与角色场景提取** | novel-input / extract-characters-scenes 节点挂接到右键菜单 | 已合并 |
| **小说拆分体验修复** | 一键提取、自动连线、模型记忆、进度条与 401 提示 | 已修复 |
| **小说拆分自动链路** | 提取后自动生成角色/场景描述 + 视频生成 + 创建节点，描述切图自动生成图片节点 | 待验证 |
| **角色/场景描述节点增强** | 双层大模型选择 + 风格输入 + 多图参考 + 增强/过滤提示词 | 已合并 |
| **角色提示词修正** | 去除“角色设定/25岁”默认项，图片提示词不带 360 | 已合并 |
| **模式切换补链路** | 描述节点切换视频/图片模式时自动补齐生成节点 | 已合并 |
| **右键菜单子目录** | “提取角色和场景”作为父级，相关节点收拢 | 已合并 |
| **工作流局部导出/导入** | 选中节点保存工作流 + 导入工作流追加画布 | 已合并 |
| **性能模式缩略图** | 历史面板缩略图生成 + 本地缓存优先 | 已合并 |

## V3.7.34 修复完成 (主线合并)

| 问题 | 修复方案 | 状态 |
|------|----------|------|
| **AI 生图节点返图缺失** | 同步返回路径不再依赖分镜任务映射 | 已合并 |
| **图片默认 2K** | 图片节点与分镜图片默认分辨率改为 2K | 已合并 |
| **视频默认 720p** | 视频节点/分镜视频分辨率规范化到 720p | 已合并 |
| **图/视频分辨率隔离** | 非法分辨率自动规范化，避免互相污染 | 已合并 |
| **Jimeng 视频首尾帧** | multipart 仅传两张图（`image_file_1/2`） | 已合并 |
| **Jimeng 视频分辨率规范** | 统一 720p/1080p 小写映射 | 已合并 |

> 历史分支记录参见 `docs/archive/merge_memo_v3.7.31p.md` 与 `docs/archive/verification_report_fix1006_v2.md`

## ✅ V3.7.33fp 修复完成 (隔离分支)

| 问题 | 修复方案 | 状态 |
|------|----------|------|
| **图片默认 2K** | 图片节点与分镜图片默认分辨率改为 2K | ✅ 已修复 (分支) |
| **视频默认 720p** | 视频节点/分镜视频分辨率规范化到 720p | ✅ 已修复 (分支) |
| **图/视频分辨率隔离** | 非法分辨率自动规范化，避免互相污染 | ✅ 已修复 (分支) |
| **Jimeng 视频首尾帧** | multipart 仅传两张图（`image_file_1/2`） | ✅ 已修复 (分支) |
| **Jimeng 视频分辨率规范** | 统一 720p/1080p 小写映射 | ✅ 已修复 (分支) |

## ✅ V3.7.33fix 修复完成 (隔离分支)

| 问题 | 修复方案 | 状态 |
|------|----------|------|
| **AI 生图节点返图缺失** | 同步返回路径不再依赖分镜任务映射 | ✅ 已修复 (分支) |

## ✅ V3.7.31p 修复完成 (隔离分支)

| 问题 | 修复方案 | 状态 |
|------|----------|------|
| **Jimeng 视频首尾帧** | multipart 仅传两张图（`image_file_1/2`） | ✅ 已修复 (分支) |
| **视频分辨率污染** | 视频请求强制 720p/1080p | ✅ 已修复 (分支) |
| **Gemini 3 Pro** | preview -> pro 迁移 | ✅ 已修复 (分支) |

## ✅ V3.7.33 修复成功

| 问题 | 修复方案 | 状态 |
|------|----------|------|
| **API Model 输入框焦点丢失** | 引入 stable `_uid` 作为 key，替代可变的 `id` | ✅ 已修复 |
| ~~**智能分镜时间显示 (V2)**~~ | ~~(部分修复) 蓝色主题 + 时钟图标。0.0s Bug 修复中 v3.7.34~~ | ✅ V3.7.33 |
| **智能分镜计时器刷新与停表** | 计时刷新改为 100ms，完成/失败停表并保留耗时，重新生成从 0 开始 | ✅ V3.7.33 |

### V3.7.33
| 功能 | 修复方案 |
|------|----------|
| **分镜计时器刷新与停表** | 计时刷新改为 100ms，完成/失败停表并保留耗时，重新生成从 0 开始 |

### V3.7.30
| 功能 | 修复方案 |
|------|----------|
| **预览不回填** | 移除 `setTimeout(0)` 包装，直接调用 `setNodes` |
| **转圈不停止** | 同上 |
| **锁定镜头仍触发任务** | 批量生成逻辑过滤 outputEnabled |
| **键盘导航首次无效** | 切换组重置 currentIndex |
| **灰框勾选不参与批量** | 修复过滤条件 |
| **调试日志** | 已移除 `[V3.7.30 Debug]` 标识 |

### V3.7.29
| 功能 | 修复方案 |
|------|----------|
| 状态竞态覆盖 | `onlyIfStatus: 'generating'` 条件更新 |
| 强制重试遗漏 | 同步重置状态为 `pending` |
| 模型联动假象 | 移除 localStorage fallback |
| Toast 位置 | top-4 改为 top-20 |
| 分镜卡片右键 | 2x2格子/1+3布局/单图都支持右键菜单 |
| 右键下载按钮 | previewContextMenu 增加"下载"选项 |
| 卡住镜头三选项 | prompt 支持 终止/跳过/放弃 |
| 异步回填完整 | 传递 output_images 全部4张 |

### V3.7.28
| 功能 | 状态 |
|------|------|
| 黑屏问题修复 | ✅ |
| Toast 放顶部 | ✅ |
| 脚本输入框滚动 | ✅ |
### 键盘导航需求 (2026-01-09 06:29)
| 需求 | 描述 | 状态 |
|------|------|------|
| **历史面板上下键** | 左侧生成历史需要上下箭头跳转不同组别 | ✅ V3.7.28 |
| ~~**ESC关闭预览**~~ | ~~ESC 关闭预览窗口和拓展面板预览~~ | ✅ V3.7.28 |
| **预览跳过无图组** | 有间隔的组需要能跳转预览 | ✅ V3.7.28 |


### V3.7.27
| 功能 | 修复方案 |
|------|----------|
| 模型联动 (灾难性) | 每个 shot 设置独立的 model 属性 |
| 队列阻塞 | 60s 超时检测 + 每 5s 周期性检查 |
| 脚本滚轮不响应 | onWheel stopPropagation |
| taskId 冲突 | Date.now()-random 唯一 |
| API 未配置 | 提前检测，立即 failed |
| alert 阻塞 | 自动消失的 Toast 通知 |
| 双击预览 | 主图和 2x2 格子支持双击 Lightbox |
| 右键预览 | previewContextMenu 增加"预览原图" |

---

## 📋 版本时间线

| 时间 | 版本 | 主要内容 |
|------|------|----------|
| 2026-01-10 04:21 | V3.7.30 | ✅ 预览回填修复成功 |
| 2026-01-10 01:02 | V3.7.29 第七版 | 状态竞态修复 + 强制重试修复 |
| 2026-01-09 12:15 | V3.7.29 第六版 | setTimeout(0) + output_images 完整传递 |
| 2026-01-09 10:54 | V3.7.29 第三版 | 三选项弹窗 + 1+3布局右键 + 下载按钮 |
| 2026-01-09 09:26 | V3.7.28 | 黑屏修复 + Toast + ESC |
| 2026-01-09 07:21 | V3.7.27 | 模型独立 + 队列超时 + Toast |





## 2026-02-01 补充说明
- 黑屏防护：启动护栏 + ErrorBoundary + 全局错误捕获已落地（自动检测脚本已提供轻量版）。
- 项目保存资产包：开关生效 + 保存进度提示（待验证）。
- Jimeng Sora2：模型库配置指引见 docs/improve/jimeng_sora2_model_library_guide.md。
